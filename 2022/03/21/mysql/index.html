<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="MySql, Java，深度学习">
    <meta name="description" content="技术博客网站">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>MySql | 晓晓屋</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="晓晓屋" type="application/atom+xml">

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">晓晓屋</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">晓晓屋</div>
        <div class="logo-desc">
            
            技术博客网站
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/HuXiaozz" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/HuXiaozz" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/10.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">MySql</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/MySQL/">
                                <span class="chip bg-color">MySQL</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2022-03-21
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2022-03-24
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    101 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="基础版"><a href="#基础版" class="headerlink" title="基础版"></a>基础版</h2><p>DDL：创建和删除表</p>
<p>DML：增删改查</p>
<p>DCL：事务权限相关</p>
<p>​            事务：TCL</p>
<p>​            </p>
<h3 id="创建和管理表"><a href="#创建和管理表" class="headerlink" title="创建和管理表"></a>创建和管理表</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">

<span class="token keyword">SELECT</span> <span class="token operator">*</span> 
<span class="token keyword">FROM</span> <span class="token punctuation">`</span><span class="token keyword">order</span><span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token comment">#1. 创建和管理数据库</span>

<span class="token comment">#1.1 如何创建数据库</span>
<span class="token comment">#方式1：</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> mytest1<span class="token punctuation">;</span>  <span class="token comment"># 创建的此数据库使用的是默认的字符集</span>

<span class="token comment">#查看创建数据库的结构</span>
<span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> mytest1<span class="token punctuation">;</span>

<span class="token comment">#方式2：显式了指名了要创建的数据库的字符集</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> mytest2 <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token string">'gbk'</span><span class="token punctuation">;</span>

<span class="token comment">#</span>
<span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> mytest2<span class="token punctuation">;</span>

<span class="token comment">#方式3（推荐）：如果要创建的数据库已经存在，则创建不成功，但不会报错。</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> mytest2 <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token string">'utf8'</span><span class="token punctuation">;</span>

<span class="token comment">#如果要创建的数据库不存在，则创建成功</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> mytest3 <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token string">'utf8'</span><span class="token punctuation">;</span>

<span class="token keyword">SHOW</span> <span class="token keyword">DATABASES</span><span class="token punctuation">;</span>

<span class="token comment">#1.2 管理数据库</span>
<span class="token comment">#查看当前连接中的数据库都有哪些</span>
<span class="token keyword">SHOW</span> <span class="token keyword">DATABASES</span><span class="token punctuation">;</span>

<span class="token comment">#切换数据库</span>
<span class="token keyword">USE</span> atguigudb<span class="token punctuation">;</span>

<span class="token comment">#查看当前数据库中保存的数据表</span>
<span class="token keyword">SHOW</span> <span class="token keyword">TABLES</span><span class="token punctuation">;</span>

<span class="token comment">#查看当前使用的数据库</span>
<span class="token keyword">SELECT</span> <span class="token keyword">DATABASE</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> DUAL<span class="token punctuation">;</span>

<span class="token comment">#查看指定数据库下保存的数据表</span>
<span class="token keyword">SHOW</span> <span class="token keyword">TABLES</span> <span class="token keyword">FROM</span> mysql<span class="token punctuation">;</span>

<span class="token comment">#1.3 修改数据库</span>
<span class="token comment">#更改数据库字符集</span>
<span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> mytest2<span class="token punctuation">;</span>

<span class="token keyword">ALTER</span> <span class="token keyword">DATABASE</span> mytest2 <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token string">'utf8'</span><span class="token punctuation">;</span>

<span class="token comment">#1.4 删除数据库</span>
<span class="token comment">#方式1：如果要删除的数据库存在，则删除成功。如果不存在，则报错</span>
<span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> mytest1<span class="token punctuation">;</span>

<span class="token keyword">SHOW</span> <span class="token keyword">DATABASES</span><span class="token punctuation">;</span>

<span class="token comment">#方式2：推荐。 如果要删除的数据库存在，则删除成功。如果不存在，则默默结束，不会报错。</span>
<span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> mytest1<span class="token punctuation">;</span>

<span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> mytest2<span class="token punctuation">;</span>

<span class="token comment">#2. 如何创建数据表</span>
<span class="token keyword">USE</span> atguigudb<span class="token punctuation">;</span>

<span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> atguigudb<span class="token punctuation">;</span> <span class="token comment">#默认使用的是utf8</span>

<span class="token keyword">SHOW</span> <span class="token keyword">TABLES</span><span class="token punctuation">;</span>

<span class="token comment">#方式1："白手起家"的方式</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> myemp1<span class="token punctuation">(</span>   <span class="token comment">#需要用户具备创建表的权限。</span>
id <span class="token keyword">INT</span><span class="token punctuation">,</span>
emp_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">#使用VARCHAR来定义字符串，必须在使用VARCHAR时指明其长度。</span>
hire_date <span class="token keyword">DATE</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">#查看表结构</span>
<span class="token keyword">DESC</span> myemp1<span class="token punctuation">;</span>
<span class="token comment">#查看创建表的语句结构</span>
<span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> myemp1<span class="token punctuation">;</span> <span class="token comment">#如果创建表时没有指明使用的字符集，则默认使用表所在的数据库的字符集。</span>
<span class="token comment">#查看表数据</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> myemp1<span class="token punctuation">;</span>

<span class="token comment">#方式2：基于现有的表，同时导入数据</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> myemp2
<span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>salary
<span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>

<span class="token keyword">DESC</span> myemp2<span class="token punctuation">;</span>
<span class="token keyword">DESC</span> employees<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> myemp2<span class="token punctuation">;</span>

<span class="token comment">#说明1：查询语句中字段的别名，可以作为新创建的表的字段的名称。</span>
<span class="token comment">#说明2：此时的查询语句可以结构比较丰富，使用前面章节讲过的各种SELECT</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> myemp3
<span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> e<span class="token punctuation">.</span>employee_id emp_id<span class="token punctuation">,</span>e<span class="token punctuation">.</span>last_name lname<span class="token punctuation">,</span>d<span class="token punctuation">.</span>department_name
<span class="token keyword">FROM</span> employees e <span class="token keyword">JOIN</span> departments d
<span class="token keyword">ON</span> e<span class="token punctuation">.</span>department_id <span class="token operator">=</span> d<span class="token punctuation">.</span>department_id<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> myemp3<span class="token punctuation">;</span>

<span class="token keyword">DESC</span> myemp3<span class="token punctuation">;</span>

<span class="token comment">#练习1：创建一个表employees_copy，实现对employees表的复制，包括表数据</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> employees_copy
<span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees_copy<span class="token punctuation">;</span>

<span class="token comment">#练习2：创建一个表employees_blank，实现对employees表的复制，不包括表数据</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> employees_blank
<span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> employees
<span class="token comment">#where department_id &gt; 10000;</span>
<span class="token keyword">WHERE</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">#山无陵，天地合，乃敢与君绝。</span>


<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees_blank<span class="token punctuation">;</span>

<span class="token comment">#3. 修改表  --&gt; ALTER TABLE </span>
<span class="token keyword">DESC</span> myemp1<span class="token punctuation">;</span>

<span class="token comment"># 3.1 添加一个字段</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> myemp1
<span class="token keyword">ADD</span> salary <span class="token keyword">DOUBLE</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">#默认添加到表中的最后一个字段的位置</span>

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> myemp1
<span class="token keyword">ADD</span> phone_number <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">FIRST</span><span class="token punctuation">;</span>

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> myemp1
<span class="token keyword">ADD</span> email <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span> <span class="token keyword">AFTER</span> emp_name<span class="token punctuation">;</span>

<span class="token comment"># 3.2 修改一个字段：数据类型、长度、默认值（略）</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> myemp1
<span class="token keyword">MODIFY</span> emp_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> myemp1
<span class="token keyword">MODIFY</span> emp_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">35</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">'aaa'</span><span class="token punctuation">;</span>

<span class="token comment"># 3.3 重命名一个字段</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> myemp1
CHANGE salary monthly_salary <span class="token keyword">DOUBLE</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> myemp1
CHANGE email my_email <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 3.4 删除一个字段</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> myemp1
<span class="token keyword">DROP</span> <span class="token keyword">COLUMN</span> my_email<span class="token punctuation">;</span>

<span class="token comment">#4. 重命名表</span>
<span class="token comment">#方式1：</span>
<span class="token keyword">RENAME</span> <span class="token keyword">TABLE</span> myemp1
<span class="token keyword">TO</span> myemp11<span class="token punctuation">;</span>

<span class="token keyword">DESC</span> myemp11<span class="token punctuation">;</span>

<span class="token comment">#方式2：</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> myemp2
<span class="token keyword">RENAME</span> <span class="token keyword">TO</span> myemp12<span class="token punctuation">;</span>

<span class="token keyword">DESC</span> myemp12<span class="token punctuation">;</span>

<span class="token comment">#5. 删除表</span>
<span class="token comment">#不光将表结构删除掉，同时表中的数据也删除掉，释放表空间</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> myemp2<span class="token punctuation">;</span>

<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> myemp12<span class="token punctuation">;</span>

<span class="token comment">#6. 清空表</span>

<span class="token comment">#清空表，表示清空表中的所有数据，但是表结构保留。</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees_copy<span class="token punctuation">;</span>

<span class="token keyword">TRUNCATE</span> <span class="token keyword">TABLE</span> employees_copy<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees_copy<span class="token punctuation">;</span>

<span class="token keyword">DESC</span> employees_copy<span class="token punctuation">;</span>

<span class="token comment">#7. DCL 中 COMMIT 和 ROLLBACK</span>
<span class="token comment"># COMMIT:提交数据。一旦执行COMMIT，则数据就被永久的保存在了数据库中，意味着数据不可以回滚。</span>
<span class="token comment"># ROLLBACK:回滚数据。一旦执行ROLLBACK,则可以实现数据的回滚。回滚到最近的一次COMMIT之后。</span>

<span class="token comment">#8. 对比 TRUNCATE TABLE 和 DELETE FROM </span>
<span class="token comment"># 相同点：都可以实现对表中所有数据的删除，同时保留表结构。</span>
<span class="token comment"># 不同点：</span>
<span class="token comment">#	TRUNCATE TABLE：一旦执行此操作，表数据全部清除。同时，数据是不可以回滚的。</span>
<span class="token comment">#	DELETE FROM：一旦执行此操作，表数据可以全部清除（不带WHERE）。同时，数据是可以实现回滚的。</span>

<span class="token comment">/*
9. DDL 和 DML 的说明
  ① DDL的操作一旦执行，就不可回滚。指令SET autocommit = FALSE对DDL操作失效。(因为在执行完DDL
    操作之后，一定会执行一次COMMIT。而此COMMIT操作不受SET autocommit = FALSE影响的。)
  
  ② DML的操作默认情况，一旦执行，也是不可回滚的。但是，如果在执行DML之前，执行了 
    SET autocommit = FALSE，则执行的DML操作就可以实现回滚。

*/</span>
<span class="token comment"># 演示：DELETE FROM </span>
<span class="token comment">#1)</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
<span class="token comment">#2)</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> myemp3<span class="token punctuation">;</span>
<span class="token comment">#3)</span>
<span class="token keyword">SET</span> autocommit <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">;</span>
<span class="token comment">#4)</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> myemp3<span class="token punctuation">;</span>
<span class="token comment">#5)</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> myemp3<span class="token punctuation">;</span>
<span class="token comment">#6)</span>
<span class="token keyword">ROLLBACK</span><span class="token punctuation">;</span>
<span class="token comment">#7)</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> myemp3<span class="token punctuation">;</span>

<span class="token comment"># 演示：TRUNCATE TABLE</span>
<span class="token comment">#1)</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
<span class="token comment">#2)</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> myemp3<span class="token punctuation">;</span>
<span class="token comment">#3)</span>
<span class="token keyword">SET</span> autocommit <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">;</span>
<span class="token comment">#4)</span>
<span class="token keyword">TRUNCATE</span> <span class="token keyword">TABLE</span> myemp3<span class="token punctuation">;</span>
<span class="token comment">#5)</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> myemp3<span class="token punctuation">;</span>
<span class="token comment">#6)</span>
<span class="token keyword">ROLLBACK</span><span class="token punctuation">;</span>
<span class="token comment">#7)</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> myemp3<span class="token punctuation">;</span>

<span class="token comment">#######################</span>
<span class="token comment">#9.测试MySQL8.0的新特性：DDL的原子化,要么执行成功，要么回滚。</span>
<span class="token comment">#以下命令book2表不存在，在8.0之前执行会删除book1表，在8.0执行会回滚book1</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> mytest<span class="token punctuation">;</span>

<span class="token keyword">USE</span> mytest<span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> book1<span class="token punctuation">(</span>
book_id <span class="token keyword">INT</span> <span class="token punctuation">,</span>rr
book_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SHOW</span> <span class="token keyword">TABLES</span><span class="token punctuation">;</span>

<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> book1<span class="token punctuation">,</span>book2<span class="token punctuation">;</span>

<span class="token keyword">SHOW</span> <span class="token keyword">TABLES</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="数据处理之增删改"><a href="#数据处理之增删改" class="headerlink" title="数据处理之增删改"></a>数据处理之增删改</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">

<span class="token comment">#0. 储备工作</span>
<span class="token keyword">USE</span> atguigudb<span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> emp1<span class="token punctuation">(</span>
id <span class="token keyword">INT</span><span class="token punctuation">,</span>
<span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
hire_date <span class="token keyword">DATE</span><span class="token punctuation">,</span>
salary <span class="token keyword">DOUBLE</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DESC</span> emp1<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> emp1<span class="token punctuation">;</span>

<span class="token comment">#1. 添加数据</span>

<span class="token comment">#方式1：一条一条的添加数据</span>

<span class="token comment"># ① 没有指明添加的字段</span>
<span class="token comment">#正确的</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> emp1
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'Tom'</span><span class="token punctuation">,</span><span class="token string">'2000-12-21'</span><span class="token punctuation">,</span><span class="token number">3400</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">#注意：一定要按照声明的字段的先后顺序添加</span>
<span class="token comment">#错误的</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> emp1
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3400</span><span class="token punctuation">,</span><span class="token string">'2000-12-21'</span><span class="token punctuation">,</span><span class="token string">'Jerry'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># ② 指明要添加的字段 （推荐）</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> emp1<span class="token punctuation">(</span>id<span class="token punctuation">,</span>hire_date<span class="token punctuation">,</span>salary<span class="token punctuation">,</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'1999-09-09'</span><span class="token punctuation">,</span><span class="token number">4000</span><span class="token punctuation">,</span><span class="token string">'Jerry'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># 说明：没有进行赋值的hire_date 的值为 null</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> emp1<span class="token punctuation">(</span>id<span class="token punctuation">,</span>salary<span class="token punctuation">,</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4500</span><span class="token punctuation">,</span><span class="token string">'shk'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># ③ 同时插入多条记录 （推荐）</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> emp1<span class="token punctuation">(</span>id<span class="token punctuation">,</span>NAME<span class="token punctuation">,</span>salary<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span>
<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">'Jim'</span><span class="token punctuation">,</span><span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">'张俊杰'</span><span class="token punctuation">,</span><span class="token number">5500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#方式2：将查询结果插入到表中</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp1<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> emp1<span class="token punctuation">(</span>id<span class="token punctuation">,</span>NAME<span class="token punctuation">,</span>salary<span class="token punctuation">,</span>hire_date<span class="token punctuation">)</span>
<span class="token comment">#查询语句</span>
<span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>salary<span class="token punctuation">,</span>hire_date  <span class="token comment"># 查询的字段一定要与添加到的表的字段一一对应</span>
<span class="token keyword">FROM</span> employees
<span class="token keyword">WHERE</span> department_id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">70</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DESC</span> emp1<span class="token punctuation">;</span>
<span class="token keyword">DESC</span> employees<span class="token punctuation">;</span>

<span class="token comment">#说明：emp1表中要添加数据的字段的长度不能低于employees表中查询的字段的长度。</span>
<span class="token comment"># 如果emp1表中要添加数据的字段的长度低于employees表中查询的字段的长度的话，就有添加不成功的风险。</span>

<span class="token comment">#2. 更新数据 （或修改数据）</span>
<span class="token comment"># UPDATE .... SET .... WHERE ...</span>
<span class="token comment"># 可以实现批量修改数据的。</span>

<span class="token keyword">UPDATE</span> emp1
<span class="token keyword">SET</span> hire_date <span class="token operator">=</span> CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp1<span class="token punctuation">;</span>

<span class="token comment">#同时修改一条数据的多个字段</span>
<span class="token keyword">UPDATE</span> emp1
<span class="token keyword">SET</span> hire_date <span class="token operator">=</span> CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>salary <span class="token operator">=</span> <span class="token number">6000</span>
<span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>

<span class="token comment">#题目：将表中姓名中包含字符a的提薪20%</span>
<span class="token keyword">UPDATE</span> emp1
<span class="token keyword">SET</span> salary <span class="token operator">=</span> salary <span class="token operator">*</span> <span class="token number">1.2</span>
<span class="token keyword">WHERE</span> NAME <span class="token operator">LIKE</span> <span class="token string">'%a%'</span><span class="token punctuation">;</span>

<span class="token comment">#修改数据时，是可能存在不成功的情况的。（可能是由于约束的影响造成的）</span>
<span class="token keyword">UPDATE</span> employees
<span class="token keyword">SET</span> department_id <span class="token operator">=</span> <span class="token number">10000</span>
<span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> <span class="token number">102</span><span class="token punctuation">;</span>

<span class="token comment">#3. 删除数据 DELETE FROM .... WHERE....</span>

<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> emp1
<span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">#在删除数据时，也有可能因为约束的影响，导致删除失败</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> departments
<span class="token keyword">WHERE</span> department_id <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>

<span class="token comment">#小结：DML操作默认情况下，执行完以后都会自动提交数据。</span>
<span class="token comment"># 如果希望执行完以后不自动提交数据，则需要使用 SET autocommit = FALSE.</span>

<span class="token comment">#4. MySQL8的新特性：计算列</span>
<span class="token keyword">USE</span> atguigudb<span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test1<span class="token punctuation">(</span>
a <span class="token keyword">INT</span><span class="token punctuation">,</span>
b <span class="token keyword">INT</span><span class="token punctuation">,</span>
c <span class="token keyword">INT</span> GENERATED ALWAYS <span class="token keyword">AS</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span> VIRTUAL  <span class="token comment">#字段c即为计算列</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test1<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> test1<span class="token punctuation">;</span>

<span class="token keyword">UPDATE</span> test1
<span class="token keyword">SET</span> a <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>

<span class="token comment">#5.综合案例</span>
<span class="token comment"># 1、创建数据库test01_library</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> test01_library <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token string">'utf8'</span><span class="token punctuation">;</span>

<span class="token keyword">USE</span> test01_library<span class="token punctuation">;</span>

<span class="token comment"># 2、创建表 books，表结构如下：</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> books<span class="token punctuation">(</span>
id <span class="token keyword">INT</span><span class="token punctuation">,</span>
<span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">`</span>authors<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
price <span class="token keyword">FLOAT</span><span class="token punctuation">,</span>
pubdate <span class="token keyword">YEAR</span><span class="token punctuation">,</span>
note <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
num <span class="token keyword">INT</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DESC</span> books<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> books<span class="token punctuation">;</span>
<span class="token comment"># 3、向books表中插入记录</span>

<span class="token comment"># 1）不指定字段名称，插入第一条记录</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> books
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'Tal of AAA'</span><span class="token punctuation">,</span><span class="token string">'Dickes'</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span><span class="token string">'1995'</span><span class="token punctuation">,</span><span class="token string">'novel'</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># 2）指定所有字段名称，插入第二记录</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> books<span class="token punctuation">(</span>id<span class="token punctuation">,</span>NAME<span class="token punctuation">,</span>AUTHORS<span class="token punctuation">,</span>price<span class="token punctuation">,</span>pubdate<span class="token punctuation">,</span>note<span class="token punctuation">,</span>num<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'EmmaT'</span><span class="token punctuation">,</span><span class="token string">'Jane lura'</span><span class="token punctuation">,</span><span class="token number">35</span><span class="token punctuation">,</span><span class="token string">'1993'</span><span class="token punctuation">,</span><span class="token string">'joke'</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># 3）同时插入多条记录（剩下的所有记录）</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> books<span class="token punctuation">(</span>id<span class="token punctuation">,</span>NAME<span class="token punctuation">,</span>AUTHORS<span class="token punctuation">,</span>price<span class="token punctuation">,</span>pubdate<span class="token punctuation">,</span>note<span class="token punctuation">,</span>num<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'Story of Jane'</span><span class="token punctuation">,</span><span class="token string">'Jane Tim'</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">2001</span><span class="token punctuation">,</span><span class="token string">'novel'</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">'Lovey Day'</span><span class="token punctuation">,</span><span class="token string">'George Byron'</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">2005</span><span class="token punctuation">,</span><span class="token string">'novel'</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">'Old land'</span><span class="token punctuation">,</span><span class="token string">'Honore Blade'</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">2010</span><span class="token punctuation">,</span><span class="token string">'Law'</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string">'The Battle'</span><span class="token punctuation">,</span><span class="token string">'Upton Sara'</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">1999</span><span class="token punctuation">,</span><span class="token string">'medicine'</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token string">'Rose Hood'</span><span class="token punctuation">,</span><span class="token string">'Richard haggard'</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">2008</span><span class="token punctuation">,</span><span class="token string">'cartoon'</span><span class="token punctuation">,</span><span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment"># 4、将小说类型(novel)的书的价格都增加5。</span>
<span class="token keyword">UPDATE</span> books
<span class="token keyword">SET</span> price <span class="token operator">=</span> price <span class="token operator">+</span> <span class="token number">5</span>
<span class="token keyword">WHERE</span> note <span class="token operator">=</span> <span class="token string">'novel'</span><span class="token punctuation">;</span>

<span class="token comment"># 5、将名称为EmmaT的书的价格改为40，并将说明改为drama。</span>
<span class="token keyword">UPDATE</span> books
<span class="token keyword">SET</span> price <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">,</span>note <span class="token operator">=</span> <span class="token string">'drama'</span>
<span class="token keyword">WHERE</span> NAME <span class="token operator">=</span> <span class="token string">'EmmaT'</span><span class="token punctuation">;</span>

<span class="token comment"># 6、删除库存为0的记录。</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> books
<span class="token keyword">WHERE</span> num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment"># 7、统计书名中包含a字母的书</span>
<span class="token keyword">SELECT</span> NAME
<span class="token keyword">FROM</span> books
<span class="token keyword">WHERE</span> NAME <span class="token operator">LIKE</span> <span class="token string">'%a%'</span><span class="token punctuation">;</span>

<span class="token comment"># 8、统计书名中包含a字母的书的数量和库存总量</span>
<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">SUM</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> books
<span class="token keyword">WHERE</span> NAME <span class="token operator">LIKE</span> <span class="token string">'%a%'</span><span class="token punctuation">;</span>

<span class="token comment"># 9、找出“novel”类型的书，按照价格降序排列</span>

<span class="token keyword">SELECT</span> NAME<span class="token punctuation">,</span>note<span class="token punctuation">,</span>price
<span class="token keyword">FROM</span> books
<span class="token keyword">WHERE</span> note <span class="token operator">=</span> <span class="token string">'novel'</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price <span class="token keyword">DESC</span><span class="token punctuation">;</span>

<span class="token comment"># 10、查询图书信息，按照库存量降序排列，如果库存量相同的按照note升序排列</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> books
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> num <span class="token keyword">DESC</span><span class="token punctuation">,</span>note <span class="token keyword">ASC</span><span class="token punctuation">;</span>


<span class="token comment"># 11、按照note分类统计书的数量</span>
<span class="token keyword">SELECT</span> note<span class="token punctuation">,</span><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token keyword">FROM</span> books
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> note<span class="token punctuation">;</span>

<span class="token comment"># 12、按照note分类统计书的库存量，显示库存量超过30本的</span>
<span class="token keyword">SELECT</span> note<span class="token punctuation">,</span><span class="token function">SUM</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> books
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> note
<span class="token keyword">HAVING</span> <span class="token function">SUM</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">30</span><span class="token punctuation">;</span>

<span class="token comment"># 13、查询所有图书，每页显示5本，显示第二页</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> books
<span class="token keyword">LIMIT</span> <span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">;</span>

<span class="token comment"># 14、按照note分类统计书的库存量，显示库存量最多的</span>
<span class="token keyword">SELECT</span> note<span class="token punctuation">,</span><span class="token function">SUM</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> sum_num
<span class="token keyword">FROM</span> books
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> note
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> sum_num <span class="token keyword">DESC</span>
<span class="token keyword">LIMIT</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment"># 15、查询书名达到10个字符的书，不包括里面的空格</span>
<span class="token keyword">SELECT</span> CHAR_LENGTH<span class="token punctuation">(</span><span class="token keyword">REPLACE</span><span class="token punctuation">(</span>NAME<span class="token punctuation">,</span><span class="token string">' '</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">FROM</span> books<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> NAME
<span class="token keyword">FROM</span> books
<span class="token keyword">WHERE</span> CHAR_LENGTH<span class="token punctuation">(</span><span class="token keyword">REPLACE</span><span class="token punctuation">(</span>NAME<span class="token punctuation">,</span><span class="token string">' '</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token comment"># 16、查询书名和类型，其中note值为novel显示小说，law显示法律，medicine显示医药，</span>
<span class="token comment">#cartoon显示卡通，joke显示笑话</span>
<span class="token keyword">SELECT</span> NAME <span class="token string">"书名"</span><span class="token punctuation">,</span>note<span class="token punctuation">,</span><span class="token keyword">CASE</span> note <span class="token keyword">WHEN</span> <span class="token string">'novel'</span> <span class="token keyword">THEN</span> <span class="token string">'小说'</span>
				  <span class="token keyword">WHEN</span> <span class="token string">'law'</span> <span class="token keyword">THEN</span> <span class="token string">'法律'</span>
				  <span class="token keyword">WHEN</span> <span class="token string">'medicine'</span> <span class="token keyword">THEN</span> <span class="token string">'医药'</span>
				  <span class="token keyword">WHEN</span> <span class="token string">'cartoon'</span> <span class="token keyword">THEN</span> <span class="token string">'卡通'</span>
				  <span class="token keyword">WHEN</span> <span class="token string">'joke'</span> <span class="token keyword">THEN</span> <span class="token string">'笑话'</span>
				  <span class="token keyword">ELSE</span> <span class="token string">'其他'</span>
				  <span class="token keyword">END</span> <span class="token string">"类型"</span>
<span class="token keyword">FROM</span> books<span class="token punctuation">;</span>


<span class="token comment"># 17、查询书名、库存，其中num值超过30本的，显示滞销，大于0并低于10的，</span>
<span class="token comment">#显示畅销，为0的显示需要无货</span>
<span class="token keyword">SELECT</span> NAME <span class="token keyword">AS</span> <span class="token string">"书名"</span><span class="token punctuation">,</span>num <span class="token keyword">AS</span> <span class="token string">"库存"</span><span class="token punctuation">,</span> <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> num <span class="token operator">&gt;</span> <span class="token number">30</span> <span class="token keyword">THEN</span> <span class="token string">'滞销'</span>
					  <span class="token keyword">WHEN</span> num <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">AND</span> num <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token keyword">THEN</span> <span class="token string">'畅销'</span>
					  <span class="token keyword">WHEN</span> num <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">THEN</span> <span class="token string">'无货'</span>
					  <span class="token keyword">ELSE</span> <span class="token string">'正常'</span>
					  <span class="token keyword">END</span> <span class="token string">"显示状态"</span>
<span class="token keyword">FROM</span> books<span class="token punctuation">;</span>

<span class="token comment"># 18、统计每一种note的库存量，并合计总量</span>
<span class="token keyword">SELECT</span> IFNULL<span class="token punctuation">(</span>note<span class="token punctuation">,</span><span class="token string">'合计库存总量'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> note<span class="token punctuation">,</span><span class="token function">SUM</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> books
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> note <span class="token keyword">WITH ROLLUP</span><span class="token punctuation">;</span>

<span class="token comment"># 19、统计每一种note的数量，并合计总量</span>
<span class="token keyword">SELECT</span> IFNULL<span class="token punctuation">(</span>note<span class="token punctuation">,</span><span class="token string">'合计总量'</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> note<span class="token punctuation">,</span><span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token keyword">FROM</span> books
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> note <span class="token keyword">WITH ROLLUP</span><span class="token punctuation">;</span>

<span class="token comment"># 20、统计库存量前三名的图书</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> books
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> num <span class="token keyword">DESC</span>
<span class="token keyword">LIMIT</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">;</span>

<span class="token comment"># 21、找出最早出版的一本书</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> books
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> pubdate <span class="token keyword">ASC</span>
<span class="token keyword">LIMIT</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment"># 22、找出novel中价格最高的一本书</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> books
<span class="token keyword">WHERE</span> note <span class="token operator">=</span> <span class="token string">'novel'</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price <span class="token keyword">DESC</span>
<span class="token keyword">LIMIT</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment"># 23、找出书名中字数最多的一本书，不含空格</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> books
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> CHAR_LENGTH<span class="token punctuation">(</span><span class="token keyword">REPLACE</span><span class="token punctuation">(</span>NAME<span class="token punctuation">,</span><span class="token string">' '</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">DESC</span>
<span class="token keyword">LIMIT</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="数据处理之增删改练习"><a href="#数据处理之增删改练习" class="headerlink" title="数据处理之增删改练习"></a>数据处理之增删改练习</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">

<span class="token comment">#练习1：</span>
<span class="token comment">#1. 创建数据库dbtest11</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> dbtest11 <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token string">'utf8'</span><span class="token punctuation">;</span>

<span class="token comment">#2. 运行以下脚本创建表my_employees</span>
<span class="token keyword">USE</span> dbtest11<span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> my_employees<span class="token punctuation">(</span>
	id <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	first_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	last_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	userid <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	salary <span class="token keyword">DOUBLE</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> users<span class="token punctuation">(</span>
	id <span class="token keyword">INT</span><span class="token punctuation">,</span>
	userid <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	department_id <span class="token keyword">INT</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">#3.显示表my_employees的结构</span>

<span class="token keyword">DESC</span> my_employees<span class="token punctuation">;</span>

<span class="token keyword">DESC</span> users<span class="token punctuation">;</span>

<span class="token comment">#4.向my_employees表中插入下列数据</span>
ID	FIRST_NAME	LAST_NAME	USERID		SALARY
<span class="token number">1</span>	patel		Ralph		Rpatel		<span class="token number">895</span>
<span class="token number">2</span>	Dancs		Betty		Bdancs		<span class="token number">860</span>
<span class="token number">3</span>	Biri		Ben		Bbiri		<span class="token number">1100</span>
<span class="token number">4</span>	Newman		Chad		Cnewman		<span class="token number">750</span>
<span class="token number">5</span>	Ropeburn	Audrey		Aropebur	<span class="token number">1550</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> my_employees
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'patel'</span><span class="token punctuation">,</span><span class="token string">'Ralph'</span><span class="token punctuation">,</span><span class="token string">'Rpatel'</span><span class="token punctuation">,</span><span class="token number">895</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> my_employees <span class="token keyword">VALUES</span>
<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'Dancs'</span><span class="token punctuation">,</span><span class="token string">'Betty'</span><span class="token punctuation">,</span><span class="token string">'Bdancs'</span><span class="token punctuation">,</span><span class="token number">860</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'Biri'</span><span class="token punctuation">,</span><span class="token string">'Ben'</span><span class="token punctuation">,</span><span class="token string">'Bbiri'</span><span class="token punctuation">,</span><span class="token number">1100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">'Newman'</span><span class="token punctuation">,</span><span class="token string">'Chad'</span><span class="token punctuation">,</span><span class="token string">'Cnewman'</span><span class="token punctuation">,</span><span class="token number">750</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">'Ropeburn'</span><span class="token punctuation">,</span><span class="token string">'Audrey'</span><span class="token punctuation">,</span><span class="token string">'Aropebur'</span><span class="token punctuation">,</span><span class="token number">1550</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> my_employees<span class="token punctuation">;</span>

<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> my_employees<span class="token punctuation">;</span>

<span class="token comment">#方式2：</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> my_employees
<span class="token keyword">SELECT</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'patel'</span><span class="token punctuation">,</span><span class="token string">'Ralph'</span><span class="token punctuation">,</span><span class="token string">'Rpatel'</span><span class="token punctuation">,</span><span class="token number">895</span> <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>
<span class="token keyword">SELECT</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'Dancs'</span><span class="token punctuation">,</span><span class="token string">'Betty'</span><span class="token punctuation">,</span><span class="token string">'Bdancs'</span><span class="token punctuation">,</span><span class="token number">860</span> <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>
<span class="token keyword">SELECT</span> <span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'Biri'</span><span class="token punctuation">,</span><span class="token string">'Ben'</span><span class="token punctuation">,</span><span class="token string">'Bbiri'</span><span class="token punctuation">,</span><span class="token number">1100</span> <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>
<span class="token keyword">SELECT</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token string">'Newman'</span><span class="token punctuation">,</span><span class="token string">'Chad'</span><span class="token punctuation">,</span><span class="token string">'Cnewman'</span><span class="token punctuation">,</span><span class="token number">750</span> <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>
<span class="token keyword">SELECT</span> <span class="token number">5</span><span class="token punctuation">,</span><span class="token string">'Ropeburn'</span><span class="token punctuation">,</span><span class="token string">'Audrey'</span><span class="token punctuation">,</span><span class="token string">'Aropebur'</span><span class="token punctuation">,</span><span class="token number">1550</span><span class="token punctuation">;</span>
			
<span class="token comment">#5.向users表中插入数据</span>
<span class="token number">1</span>	Rpatel		<span class="token number">10</span>
<span class="token number">2</span>	Bdancs		<span class="token number">10</span>
<span class="token number">3</span>	Bbiri		<span class="token number">20</span>
<span class="token number">4</span>	Cnewman		<span class="token number">30</span>
<span class="token number">5</span>	Aropebur	<span class="token number">40</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> users <span class="token keyword">VALUES</span>
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'Rpatel'</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'Bdancs'</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'Bbiri'</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">'Cnewman'</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">'Aropebur'</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">)</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users<span class="token punctuation">;</span>



<span class="token comment">#6. 将3号员工的last_name修改为“drelxer”</span>
<span class="token keyword">UPDATE</span> my_employees
<span class="token keyword">SET</span> last_name <span class="token operator">=</span> <span class="token string">'drelxer'</span>
<span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>

<span class="token comment">#7. 将所有工资少于900的员工的工资修改为1000</span>
<span class="token keyword">UPDATE</span> my_employees
<span class="token keyword">SET</span> salary <span class="token operator">=</span> <span class="token number">1000</span>
<span class="token keyword">WHERE</span> salary <span class="token operator">&lt;</span> <span class="token number">900</span><span class="token punctuation">;</span>

<span class="token comment">#8. 将userid为Bbiri的users表和my_employees表的记录全部删除</span>

<span class="token comment">#方式1：</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> my_employees
<span class="token keyword">WHERE</span> userid <span class="token operator">=</span> <span class="token string">'Bbiri'</span><span class="token punctuation">;</span>

<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> users
<span class="token keyword">WHERE</span> userid <span class="token operator">=</span> <span class="token string">'Bbiri'</span><span class="token punctuation">;</span>

<span class="token comment">#方式2：</span>

<span class="token keyword">DELETE</span> m<span class="token punctuation">,</span>u
<span class="token keyword">FROM</span> my_employees m
<span class="token keyword">JOIN</span> users u
<span class="token keyword">ON</span> m<span class="token punctuation">.</span>userid <span class="token operator">=</span> u<span class="token punctuation">.</span>userid
<span class="token keyword">WHERE</span> m<span class="token punctuation">.</span>userid <span class="token operator">=</span> <span class="token string">'Bbiri'</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> my_employees<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users<span class="token punctuation">;</span>

<span class="token comment">#9. 删除my_employees、users表所有数据</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> my_employees<span class="token punctuation">;</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> users<span class="token punctuation">;</span>

<span class="token comment">#10. 检查所作的修正</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> my_employees<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users<span class="token punctuation">;</span>

<span class="token comment">#11. 清空表my_employees</span>
<span class="token keyword">TRUNCATE</span> <span class="token keyword">TABLE</span> my_employees<span class="token punctuation">;</span>
<span class="token comment">##########################################</span>
<span class="token comment">#练习2：</span>
<span class="token comment"># 1. 使用现有数据库dbtest11</span>
<span class="token keyword">USE</span> dbtest11<span class="token punctuation">;</span>

<span class="token comment"># 2. 创建表格pet</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> pet<span class="token punctuation">(</span>
NAME <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
OWNER <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
species <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
sex <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
birth <span class="token keyword">YEAR</span><span class="token punctuation">,</span>
death <span class="token keyword">YEAR</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DESC</span> pet<span class="token punctuation">;</span>

<span class="token comment"># 3. 添加记录</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> pet <span class="token keyword">VALUES</span>
<span class="token punctuation">(</span><span class="token string">'Fluffy'</span><span class="token punctuation">,</span><span class="token string">'harold'</span><span class="token punctuation">,</span><span class="token string">'Cat'</span><span class="token punctuation">,</span><span class="token string">'f'</span><span class="token punctuation">,</span><span class="token string">'2003'</span><span class="token punctuation">,</span><span class="token string">'2010'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'Claws'</span><span class="token punctuation">,</span><span class="token string">'gwen'</span><span class="token punctuation">,</span><span class="token string">'Cat'</span><span class="token punctuation">,</span><span class="token string">'m'</span><span class="token punctuation">,</span><span class="token string">'2004'</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'Buffy'</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token string">'Dog'</span><span class="token punctuation">,</span><span class="token string">'f'</span><span class="token punctuation">,</span><span class="token string">'2009'</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'Fang'</span><span class="token punctuation">,</span><span class="token string">'benny'</span><span class="token punctuation">,</span><span class="token string">'Dog'</span><span class="token punctuation">,</span><span class="token string">'m'</span><span class="token punctuation">,</span><span class="token string">'2000'</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'bowser'</span><span class="token punctuation">,</span><span class="token string">'diane'</span><span class="token punctuation">,</span><span class="token string">'Dog'</span><span class="token punctuation">,</span><span class="token string">'m'</span><span class="token punctuation">,</span><span class="token string">'2003'</span><span class="token punctuation">,</span><span class="token string">'2009'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'Chirpy'</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token string">'Bird'</span><span class="token punctuation">,</span><span class="token string">'f'</span><span class="token punctuation">,</span><span class="token string">'2008'</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> pet<span class="token punctuation">;</span>

<span class="token comment"># 4. 添加字段:主人的生日owner_birth DATE类型。</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> pet
<span class="token keyword">ADD</span> owner_birth <span class="token keyword">DATE</span><span class="token punctuation">;</span>

<span class="token comment"># 5. 将名称为Claws的猫的主人改为kevin</span>
<span class="token keyword">UPDATE</span> pet
<span class="token keyword">SET</span> OWNER <span class="token operator">=</span> <span class="token string">'kevin'</span>
<span class="token keyword">WHERE</span> NAME <span class="token operator">=</span> <span class="token string">'Claws'</span> <span class="token operator">AND</span> species <span class="token operator">=</span> <span class="token string">'Cat'</span><span class="token punctuation">;</span>

<span class="token comment"># 6. 将没有死的狗的主人改为duck</span>
<span class="token keyword">UPDATE</span> pet
<span class="token keyword">SET</span> OWNER <span class="token operator">=</span> <span class="token string">'duck'</span>
<span class="token keyword">WHERE</span> death <span class="token operator">IS</span> <span class="token boolean">NULL</span> <span class="token operator">AND</span> species <span class="token operator">=</span> <span class="token string">'Dog'</span><span class="token punctuation">;</span>

<span class="token comment"># 7. 查询没有主人的宠物的名字；</span>
<span class="token keyword">SELECT</span> NAME
<span class="token keyword">FROM</span> pet
<span class="token keyword">WHERE</span> OWNER <span class="token operator">IS</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>

<span class="token comment"># 8. 查询已经死了的cat的姓名，主人，以及去世时间；</span>
<span class="token keyword">SELECT</span> NAME<span class="token punctuation">,</span>OWNER<span class="token punctuation">,</span>death
<span class="token keyword">FROM</span> pet
<span class="token keyword">WHERE</span> death <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>

<span class="token comment"># 9. 删除已经死亡的狗</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> pet
<span class="token keyword">WHERE</span> death <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> 
<span class="token operator">AND</span> species <span class="token operator">=</span> <span class="token string">'Dog'</span><span class="token punctuation">;</span>

<span class="token comment"># 10. 查询所有宠物信息</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> 
<span class="token keyword">FROM</span> pet<span class="token punctuation">;</span>

<span class="token comment">##################################</span>
<span class="token comment">#练习3：</span>
<span class="token comment"># 1. 使用已有的数据库dbtest11</span>
<span class="token keyword">USE</span> dbtest11<span class="token punctuation">;</span>
<span class="token comment"># 2. 创建表employee，并添加记录</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> employee<span class="token punctuation">(</span>
id <span class="token keyword">INT</span><span class="token punctuation">,</span>
NAME <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
sex <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
tel <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
addr <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
salary <span class="token keyword">DOUBLE</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> employee <span class="token keyword">VALUES</span>
<span class="token punctuation">(</span><span class="token number">10001</span><span class="token punctuation">,</span><span class="token string">'张一一'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token string">'13456789000'</span><span class="token punctuation">,</span><span class="token string">'山东青岛'</span><span class="token punctuation">,</span><span class="token number">1001.58</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">10002</span><span class="token punctuation">,</span><span class="token string">'刘小红'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">,</span><span class="token string">'13454319000'</span><span class="token punctuation">,</span><span class="token string">'河北保定'</span><span class="token punctuation">,</span><span class="token number">1201.21</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">10003</span><span class="token punctuation">,</span><span class="token string">'李四'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token string">'0751-1234567'</span><span class="token punctuation">,</span><span class="token string">'广东佛山'</span><span class="token punctuation">,</span><span class="token number">1004.11</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">10004</span><span class="token punctuation">,</span><span class="token string">'刘小强'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token string">'0755-5555555'</span><span class="token punctuation">,</span><span class="token string">'广东深圳'</span><span class="token punctuation">,</span><span class="token number">1501.23</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">10005</span><span class="token punctuation">,</span><span class="token string">'王艳'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token string">'020-1232133'</span><span class="token punctuation">,</span><span class="token string">'广东广州'</span><span class="token punctuation">,</span><span class="token number">1405.16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employee<span class="token punctuation">;</span>

<span class="token comment"># 3. 查询出薪资在1200~1300之间的员工信息。</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> employee
<span class="token keyword">WHERE</span> salary <span class="token operator">BETWEEN</span> <span class="token number">1200</span> <span class="token operator">AND</span> <span class="token number">1300</span><span class="token punctuation">;</span>

<span class="token comment"># 4. 查询出姓“刘”的员工的工号，姓名，家庭住址。</span>
<span class="token keyword">SELECT</span> id<span class="token punctuation">,</span>NAME<span class="token punctuation">,</span>addr
<span class="token keyword">FROM</span> employee
<span class="token keyword">WHERE</span> NAME <span class="token operator">LIKE</span> <span class="token string">'刘%'</span><span class="token punctuation">;</span>

<span class="token comment"># 5. 将“李四”的家庭住址改为“广东韶关”</span>
<span class="token keyword">UPDATE</span> employee
<span class="token keyword">SET</span> addr <span class="token operator">=</span> <span class="token string">'广东韶关'</span>
<span class="token keyword">WHERE</span> NAME <span class="token operator">=</span> <span class="token string">'李四'</span><span class="token punctuation">;</span>

<span class="token comment"># 6. 查询出名字中带“小”的员工</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> employee
<span class="token keyword">WHERE</span> NAME <span class="token operator">LIKE</span> <span class="token string">'%小%'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="MySQL数据类型"><a href="#MySQL数据类型" class="headerlink" title="MySQL数据类型"></a>MySQL数据类型</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">

<span class="token comment"># 建议使用 MySQL5.7进行测试。</span>

<span class="token comment">#1.关于属性：character set name</span>

<span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'character_%'</span><span class="token punctuation">;</span>

<span class="token comment">#创建数据库时指名字符集</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> dbtest12 <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token string">'utf8'</span><span class="token punctuation">;</span>

<span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> dbtest12<span class="token punctuation">;</span>

<span class="token comment">#创建表的时候，指名表的字符集</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">temp</span><span class="token punctuation">(</span>
id <span class="token keyword">INT</span>
<span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token string">'utf8'</span><span class="token punctuation">;</span>

<span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">temp</span><span class="token punctuation">;</span>

<span class="token comment">#创建表，指名表中的字段时，可以指定字段的字符集</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> temp1<span class="token punctuation">(</span>
id <span class="token keyword">INT</span><span class="token punctuation">,</span>
NAME <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token string">'gbk'</span>

<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> temp1<span class="token punctuation">;</span>

<span class="token comment">#2.整型数据类型</span>

<span class="token keyword">USE</span> dbtest12<span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test_int1<span class="token punctuation">(</span>
f1 <span class="token keyword">TINYINT</span><span class="token punctuation">,</span>
f2 <span class="token keyword">SMALLINT</span><span class="token punctuation">,</span>
f3 <span class="token keyword">MEDIUMINT</span><span class="token punctuation">,</span>
f4 <span class="token keyword">INTEGER</span><span class="token punctuation">,</span>
f5 <span class="token keyword">BIGINT</span>

<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DESC</span> test_int1<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_int1<span class="token punctuation">(</span>f1<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> test_int1<span class="token punctuation">;</span>

<span class="token comment">#Out of range value for column 'f1' at row 1</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_int1<span class="token punctuation">(</span>f1<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test_int2<span class="token punctuation">(</span>
f1 <span class="token keyword">INT</span><span class="token punctuation">,</span>
f2 <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
f3 <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> ZEROFILL  <span class="token comment">#① 显示宽度为5。当insert的值不足5位时，使用0填充。 ②当使用ZEROFILL时，自动会添加UNSIGNED</span>
<span class="token punctuation">)</span>
<span class="token comment">#M : 表示显示宽度，M的取值范围是(0, 255)。例如，int(5)：当数据宽度小于5位的时候在数字前面需要用</span>
<span class="token comment">#字符填满宽度。该项功能需要配合“ ZEROFILL ”使用，表示用“0”填满宽度，否则指定显示宽度无效。</span>
<span class="token comment">#如果设置了显示宽度，那么插入的数据宽度超过显示宽度限制，会不会截断或插入失败？</span>
<span class="token comment">#答案：不会对插入的数据有任何影响，还是按照类型的实际宽度进行保存，即 显示宽度与类型可以存储的</span>
<span class="token comment">#值范围无关 。从MySQL 8.0.17开始，整数数据类型不推荐使用显示宽度属性。</span>
<span class="token comment">#，int(M)，必须和UNSIGNED ZEROFILL一起使用才有意义。如果整</span>
<span class="token comment">#数值超过M位，就按照实际位数存储。只是无须再用字符 0 进行填充。</span>
<span class="token comment">#MySQL 存储浮点数的格式为： 符号(S) 、 尾数(M) 和 阶码(E) 。因此，无论有没有符号，MySQL 的浮</span>
<span class="token comment">#点数都会存储表示符号的部分。因此， 所谓的无符号数取值范围，其实就是有符号数取值范围大于等于零的部分。</span>
<span class="token comment">#在8.0之后就不用可以的加入关键字   unsigned   关键字了，以为有符号无符号占有的位数总是那些。</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_int2<span class="token punctuation">(</span>f1<span class="token punctuation">,</span>f2<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">123456</span><span class="token punctuation">,</span><span class="token number">123456</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> test_int2<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_int2<span class="token punctuation">(</span>f3<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">123456</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test_int2<span class="token punctuation">;</span>


<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test_int3<span class="token punctuation">(</span>
f1 <span class="token keyword">INT</span> <span class="token keyword">UNSIGNED</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DESC</span> test_int3<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_int3
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">2412321</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#Out of range value for column 'f1' at row 1</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_int3
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">4294967296</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#3.浮点类型</span>
<span class="token comment">#FLOAT和DOUBLE类型在不指定(M,D)时，默认会按照实际的精度（由实际的硬件和操作系统决定）来显示。</span>
<span class="token comment">#从MySQL 8.0.17开始，FLOAT(M,D) 和DOUBLE(M,D)用法在官方文档中已经明确不推荐使用，将来可</span>
<span class="token comment">#能被移除。另外，关于浮点型FLOAT和DOUBLE的UNSIGNED也不推荐使用了，将来也可能被移除。</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test_double1<span class="token punctuation">(</span>
f1 <span class="token keyword">FLOAT</span><span class="token punctuation">,</span>
f2 <span class="token keyword">FLOAT</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
f3 <span class="token keyword">DOUBLE</span><span class="token punctuation">,</span>
f4 <span class="token keyword">DOUBLE</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DESC</span> test_double1<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_double1<span class="token punctuation">(</span>f1<span class="token punctuation">,</span>f2<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">123.45</span><span class="token punctuation">,</span><span class="token number">123.45</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> test_double1<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_double1<span class="token punctuation">(</span>f3<span class="token punctuation">,</span>f4<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">123.45</span><span class="token punctuation">,</span><span class="token number">123.456</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">#存在四舍五入</span>

<span class="token comment">#Out of range value for column 'f4' at row 1</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_double1<span class="token punctuation">(</span>f3<span class="token punctuation">,</span>f4<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">123.45</span><span class="token punctuation">,</span><span class="token number">1234.456</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#Out of range value for column 'f4' at row 1</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_double1<span class="token punctuation">(</span>f3<span class="token punctuation">,</span>f4<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">123.45</span><span class="token punctuation">,</span><span class="token number">999.995</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#测试FLOAT和DOUBLE的精度问题</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test_double2<span class="token punctuation">(</span>
f1 <span class="token keyword">DOUBLE</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_double2
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">0.47</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0.44</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0.19</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#查询结果是 1.0999999999999999。</span>
<span class="token comment">#原因：如果小数尾数不是 0 或 5（比如 9.624），你就无法用一个二进制数来精确表达。进而，就只好在取值允许的范围内进行四舍五入。</span>
<span class="token comment">#因为浮点数是不准确的，所以我们要避免使用“=”来判断两个数是否相等。</span>
<span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>f1<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> test_double2<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>f1<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1.1</span><span class="token punctuation">,</span><span class="token number">1.1</span> <span class="token operator">=</span> <span class="token number">1.1</span>
<span class="token keyword">FROM</span> test_double2<span class="token punctuation">;</span>

<span class="token comment">#4. 定点数类型</span>
<span class="token comment">#MySQL 有没有精准的数据类型呢？当然有，这就是定点数类型： DECIMAL 。</span>
<span class="token comment">#DECIMAL(M,D)的最大取值范围与DOUBLE类型一样，但是有效的数据范围是由M和D决定的。</span>
<span class="token comment">#DECIMAL 的存储空间并不是固定的，由精度值M决定，总共占用的存储空间为M+2个字节。也就是说，在一些对精度要求不高的场景下，比起占用同样字节长度的定点数，浮点数表达的数值范围可以更大一些。</span>
<span class="token comment">#定点数在MySQL内部是以 字符串 的形式进行存储，这就决定了它一定是精准的。</span>
<span class="token comment">#当DECIMAL类型不指定精度和标度时，其默认为DECIMAL(10,0)。当数据的精度超出了定点数类型的精度范围时，则MySQL同样会进行四舍五入处理。</span>

<span class="token comment">#浮点数 vs 定点数</span>
<span class="token comment">#浮点数相对于定点数的优点是在长度一定的情况下，浮点类型取值范围大，但是不精准，适用于需要取值范围大，又可以容忍微小误差的科学计算场景（比如计算化学、分子建模、流体动力学等）</span>
<span class="token comment">#定点数类型取值范围相对小，但是精准，没有误差，适合于对精度要求极高的场景 （比如涉及金额计算的场景）</span>

<span class="token comment">#开发经验：</span>
<span class="token comment">#“由于 DECIMAL 数据类型的精准性，在我们的项目中，除了极少数（比如商品编号）用到整数类型外，其他的数值都用的是 DECIMAL，原因就是这个项目所处的零售行业，要求精准，一分钱也不能差。 ” ——来自某项目经理</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test_decimal1<span class="token punctuation">(</span>
f1 <span class="token keyword">DECIMAL</span><span class="token punctuation">,</span>
f2 <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DESC</span> test_decimal1<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_decimal1<span class="token punctuation">(</span>f1<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">123.45</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> test_decimal1<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_decimal1<span class="token punctuation">(</span>f2<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">999.99</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_decimal1<span class="token punctuation">(</span>f2<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">67.567</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#存在四色五入</span>

<span class="token comment">#Out of range value for column 'f2' at row 1</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_decimal1<span class="token punctuation">(</span>f2<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1267.567</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#Out of range value for column 'f2' at row 1</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_decimal1<span class="token punctuation">(</span>f2<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">999.995</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#演示DECIMAL替换DOUBLE，体现精度</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> test_double2
<span class="token keyword">MODIFY</span> f1 <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DESC</span> test_double2<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>f1<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> test_double2<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token function">SUM</span><span class="token punctuation">(</span>f1<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1.1</span><span class="token punctuation">,</span><span class="token number">1.1</span> <span class="token operator">=</span> <span class="token number">1.1</span>
<span class="token keyword">FROM</span> test_double2<span class="token punctuation">;</span>

<span class="token comment">#5. 位类型：BIT</span>
<span class="token comment">#BIT类型，如果没有指定(M)，默认是1位。这个1位，表示只能存1位的二进制值。这里(M)是表示二进制的位数，位数最小值为1，最大值为64。</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test_bit1<span class="token punctuation">(</span>
f1 <span class="token keyword">BIT</span><span class="token punctuation">,</span>
f2 <span class="token keyword">BIT</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
f3 <span class="token keyword">BIT</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DESC</span> test_bit1<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_bit1<span class="token punctuation">(</span>f1<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> test_bit1<span class="token punctuation">;</span>

<span class="token comment">#Data too long for column 'f1' at row 1</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_bit1<span class="token punctuation">(</span>f1<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_bit1<span class="token punctuation">(</span>f2<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#Data too long for column 'f2' at row 1</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_bit1<span class="token punctuation">(</span>f2<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#BIN查看2二进制数据，HEX查看16进制数据</span>
<span class="token keyword">SELECT</span> BIN<span class="token punctuation">(</span>f1<span class="token punctuation">)</span><span class="token punctuation">,</span>BIN<span class="token punctuation">(</span>f2<span class="token punctuation">)</span><span class="token punctuation">,</span>HEX<span class="token punctuation">(</span>f1<span class="token punctuation">)</span><span class="token punctuation">,</span>HEX<span class="token punctuation">(</span>f2<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> test_bit1<span class="token punctuation">;</span>

<span class="token comment">#此时+0以后，可以以十进制的方式显示数据</span>
<span class="token keyword">SELECT</span> f1 <span class="token operator">+</span> <span class="token number">0</span><span class="token punctuation">,</span> f2 <span class="token operator">+</span> <span class="token number">0</span>
<span class="token keyword">FROM</span> test_bit1<span class="token punctuation">;</span>

<span class="token comment">#6.1 YEAR类型</span>
<span class="token comment">#从MySQL5.5.27开始，2位格式的YEAR已经不推荐使用。YEAR默认格式就是“YYYY”，没必要写成YEAR(4)，</span>
<span class="token comment">#从MySQL 8.0.19开始，不推荐使用指定显示宽度的YEAR(4)数据类型。</span>
<span class="token comment">#DATE类型表示日期，没有时间部分，格式为 YYYY-MM-DD ，其中，YYYY表示年份，MM表示月份，DD表示日期。需要 3个字节 的存储空间。</span>
<span class="token comment">#使用 CURRENT_DATE() 或者 NOW() 函数，会插入当前系统的日期。</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test_year<span class="token punctuation">(</span>
f1 <span class="token keyword">YEAR</span><span class="token punctuation">,</span>
f2 <span class="token keyword">YEAR</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DESC</span> test_year<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_year<span class="token punctuation">(</span>f1<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'2021'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2022</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> test_year<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_year<span class="token punctuation">(</span>f1<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'2155'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#Out of range value for column 'f1' at row 1</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_year<span class="token punctuation">(</span>f1<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'2156'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_year<span class="token punctuation">(</span>f1<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'69'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'70'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_year<span class="token punctuation">(</span>f1<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#6.2 DATE类型</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test_date1<span class="token punctuation">(</span>
f1 <span class="token keyword">DATE</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DESC</span> test_date1<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_date1
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'2020-10-01'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'20201001'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">20201001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_date1
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'00-01-01'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'000101'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'69-10-01'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'691001'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'70-01-01'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'700101'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'99-01-01'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'990101'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_date1
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">000301</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">690301</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">700301</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">990301</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">#存在隐式转换</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_date1
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span>CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">CURRENT_DATE</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> test_date1<span class="token punctuation">;</span>

<span class="token comment">#6.3 TIME类型</span>
<span class="token comment">#可以使用带有冒号的字符串，比如' D HH:MM:SS' 、' HH:MM:SS '、'HH:MM '、' D HH:MM '、' D HH '或' SS '格式，都能被正确地插入TIME类型的字段中。其中D表示天，其最小值为0，最大值为34。如果使用带有D格式的字符串插入TIME类型的字段时，D会被转化为小时，计算格式为D*24+HH。当使用带有冒号并且不带D的字符串表示时间时，表示当天的时间，比如12:10表示12:10:00，而不是00:12:10。</span>
<span class="token comment">#使用 CURRENT_TIME() 或者 NOW() ，会插入当前系统的时间。</span>
<span class="token comment">#（2）可以使用不带有冒号的字符串或者数字，格式为' HHMMSS '或者HHMMSS 。如果插入一个不合法的字符串或者数字，MySQL在存储数据时，会将其自动转化为00:00:00进行存储。比如1210，MySQL会将最右边的两位解析成秒，表示00:12:10，而不是12:10:00。</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test_time1<span class="token punctuation">(</span>
f1 <span class="token keyword">TIME</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DESC</span> test_time1<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_time1
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'2 12:30:29'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'12:35:29'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'12:40'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'2 12:40'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'1 05'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'45'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_time1
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'123520'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">124011</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1210</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_time1
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">CURRENT_TIME</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>CURTIME<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> test_time1<span class="token punctuation">;</span>


<span class="token comment">#6.4 DATETIME类型</span>
<span class="token comment">#DATETIME类型在所有的日期时间类型中占用的存储空间最大，总共需要 8 个字节的存储空间。</span>
<span class="token comment">#使用函数 CURRENT_TIMESTAMP() 和 NOW() ，可以向DATETIME类型的字段插入系统的当前日期和时间。</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test_datetime1<span class="token punctuation">(</span>
dt <span class="token keyword">DATETIME</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_datetime1
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'2021-01-01 06:50:30'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'20210101065030'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_datetime1
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'99-01-01 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'990101000000'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'20-01-01 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'200101000000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_datetime1
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">20200101000000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">200101000000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">19990101000000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">990101000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_datetime1
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>SYSDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> test_datetime1<span class="token punctuation">;</span>

<span class="token comment">#6.5 TIMESTAMP类型</span>
<span class="token comment">#存储数据的时候需要对当前时间所在的时区进行转换，查询数据的时候再将时间转换回当前的时区。因此，使用TIMESTAMP存储的同一个时间值，在不同的时区查询时会显示不同的时间。</span>
<span class="token comment">#TIMESTAMP类型也可以表示日期时间，其显示格式与DATETIME类型相同，都是 YYYY-MM-DDHH:MM:SS ，需要4个字节的存储空间。但是TIMESTAMP存储的时间范围比DATETIME要小很多，只能存储“1970-01-01 00:00:01 UTC”到“2038-01-19 03:14:07 UTC”之间的时间。</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test_timestamp1<span class="token punctuation">(</span>
ts <span class="token keyword">TIMESTAMP</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_timestamp1
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'1999-01-01 03:04:50'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'19990101030405'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'99-01-01 03:04:05'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'990101030405'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_timestamp1
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'2020@01@01@00@00@00'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'20@01@01@00@00@00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_timestamp1
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token keyword">CURRENT_TIMESTAMP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#Incorrect datetime value</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_timestamp1
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'2038-01-20 03:14:07'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> test_timestamp1<span class="token punctuation">;</span>

<span class="token comment">#对比DATETIME 和 TIMESTAMP</span>
<span class="token comment">#TIMESTAMP和DATETIME的区别：</span>
<span class="token comment">#	TIMESTAMP存储空间比较小，表示的日期时间范围也比较小</span>
<span class="token comment">#	底层存储方式不同，TIMESTAMP底层存储的是毫秒值，距离1970-1-1 0:0:0 0毫秒的毫秒值。</span>
<span class="token comment">#	两个日期比较大小或日期计算时，TIMESTAMP更方便、更快。</span>
<span class="token comment">#	TIMESTAMP和时区有关。TIMESTAMP会根据用户的时区不同，显示不同的结果。而DATETIME则只能反映出插入时当地的时区，其他时区的人查看数据必然会有误差的。</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> temp_time<span class="token punctuation">(</span>
d1 <span class="token keyword">DATETIME</span><span class="token punctuation">,</span>
d2 <span class="token keyword">TIMESTAMP</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> temp_time <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'2021-9-2 14:45:52'</span><span class="token punctuation">,</span><span class="token string">'2021-9-2 14:45:52'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> temp_time <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> temp_time<span class="token punctuation">;</span>

<span class="token comment">#修改当前的时区</span>
<span class="token keyword">SET</span> time_zone <span class="token operator">=</span> <span class="token string">'+9:00'</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> temp_time<span class="token punctuation">;</span>


<span class="token comment">#在开发中用得最多的日期时间类型，就是 DATETIME</span>
<span class="token comment">#一般存注册时间、商品发布时间等，不建议使用DATETIME存储，而是使用 时间戳 ，因为DATETIME虽然直观，但不便于计算。</span>
<span class="token comment">#VARCHAR(M)   占用的存储空间   (实际长度 + 1) 个字节</span>
<span class="token comment">#CHAR(M)       固定长度       M个字节</span>
<span class="token comment">#7.1 CHAR类型</span>
<span class="token comment">#CHAR类型：</span>
<span class="token comment">#		CHAR(M) 类型一般需要预先定义字符串长度。如果不指定(M)，则表示长度默认是1个字符。</span>
<span class="token comment">#		如果保存时，数据的实际长度比CHAR类型声明的长度小，则会在 右侧填充 空格以达到指定的长度。当MySQL检索CHAR类型的数据时，CHAR类型的字段会去除尾部的空格。</span>
<span class="token comment">#		定义CHAR类型字段时，声明的字段长度即为CHAR类型字段所占的存储空间的字节数。</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test_char1<span class="token punctuation">(</span>
c1 <span class="token keyword">CHAR</span><span class="token punctuation">,</span>
c2 <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DESC</span> test_char1<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_char1<span class="token punctuation">(</span>c1<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#Data too long for column 'c1' at row 1</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_char1<span class="token punctuation">(</span>c1<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'ab'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_char1<span class="token punctuation">(</span>c2<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'ab'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_char1<span class="token punctuation">(</span>c2<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_char1<span class="token punctuation">(</span>c2<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'尚'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_char1<span class="token punctuation">(</span>c2<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'硅谷'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_char1<span class="token punctuation">(</span>c2<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'尚硅谷教育'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#Data too long for column 'c2' at row 1</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_char1<span class="token punctuation">(</span>c2<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'尚硅谷IT教育'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> test_char1<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> CONCAT<span class="token punctuation">(</span>c2<span class="token punctuation">,</span><span class="token string">'***'</span><span class="token punctuation">)</span>
<span class="token keyword">FROM</span> test_char1<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_char1<span class="token punctuation">(</span>c2<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'ab  '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> CHAR_LENGTH<span class="token punctuation">(</span>c2<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> test_char1<span class="token punctuation">;</span>

<span class="token comment">#7.2 VARCHAR类型</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test_varchar1<span class="token punctuation">(</span>
NAME <span class="token keyword">VARCHAR</span>  <span class="token comment">#错误</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#Column length too big for column 'name' (max = 21845); use BLOB or TEXT instead</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test_varchar2<span class="token punctuation">(</span>
NAME <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">65535</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test_varchar3<span class="token punctuation">(</span>
NAME <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_varchar3
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'尚硅谷'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'尚硅谷教育'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#Data too long for column 'NAME' at row 1</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_varchar3
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'尚硅谷IT教育'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>哪些情况使用 CHAR 或 VARCHAR 更好:</p>
<p><img src="/2022/03/21/mysql/1.jpg" alt="1"></p>
<p>情况1：存储很短的信息。比如门牌号码101，201……这样很短的信息应该用char，因为varchar还要占个 byte用于存储信息长度，本来打算节约存储的，结果得不偿失。</p>
<p>情况3：十分频繁改变的column。因为varchar每次存储都要有额外的计算，得到长度等工作，如果一个 非常频繁改变的，那就要有很多的精力用于计算，而这些对于char来说是不需要的。</p>
<p>情况4：具体存储引擎中的情况：</p>
<p>​        MyISAM 数据存储引擎和数据列：MyISAM数据表，最好使用固定长度(CHAR)的数据列代替可变长 度(VARCHAR)的数据列。这样使得整个表静态化，从而使 数据检索更快 ，用空间换时间。</p>
<p>​        MEMORY 存储引擎和数据列：MEMORY数据表目前都使用固定长度的数据行存储，因此无论使用 CHAR或VARCHAR列都没有关系，两者都是作为CHAR类型处理的。</p>
<p>​        InnoDB 存储引擎，建议使用VARCHAR类型。因为对于InnoDB数据表，内部的行存储格式并没有区 分固定长度和可变长度列（所有数据行都使用指向数据列值的头指针），而且主要影响性能的因素 是数据行使用的存储总量，由于char平均占用的空间多于varchar，所以除了简短并且固定长度的， 其他考虑varchar。这样节省空间，对磁盘I/O和数据存储总量比较好。</p>
<h4 id="7-3-TEXT类型"><a href="#7-3-TEXT类型" class="headerlink" title="7.3 TEXT类型"></a>7.3 TEXT类型</h4><p><img src="/2022/03/21/mysql/2.jpg" alt="2"></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">#7.3 TEXT类型</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test_text<span class="token punctuation">(</span>
tx <span class="token keyword">TEXT</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_text
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'atguigu   '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> CHAR_LENGTH<span class="token punctuation">(</span>tx<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> test_text<span class="token punctuation">;</span> <span class="token comment">#10</span>


<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>开发中经验：</strong> TEXT文本类型，可以存比较大的文本段，搜索速度稍慢，因此如果不是特别大的内容，建议使用CHAR， VARCHAR来代替。还有TEXT类型不用加默认值，加了也没用。而且text和blob类型的数据删除后容易导致 “空洞”，使得文件碎片比较多，所以频繁使用的表不建议包含TEXT类型字段，建议单独分出去，单独用 一个表。</p>
<h4 id="8-ENUM类型"><a href="#8-ENUM类型" class="headerlink" title="8.ENUM类型"></a>8.ENUM类型</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">#8. ENUM类型</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test_enum<span class="token punctuation">(</span>
season <span class="token keyword">ENUM</span><span class="token punctuation">(</span><span class="token string">'春'</span><span class="token punctuation">,</span><span class="token string">'夏'</span><span class="token punctuation">,</span><span class="token string">'秋'</span><span class="token punctuation">,</span><span class="token string">'冬'</span><span class="token punctuation">,</span><span class="token string">'unknow'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_enum
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'春'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'秋'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> test_enum<span class="token punctuation">;</span>

<span class="token comment">#Data truncated for column 'season' at row 1</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_enum
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'春,秋'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">#Data truncated for column 'season' at row 1</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_enum
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'人'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_enum
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'unknow'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#忽略大小写的</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_enum
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'UNKNOW'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#可以使用索引进行枚举元素的调用</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_enum
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 没有限制非空的情况下，可以添加null值</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_enum
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">#9. SET类型</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test_set<span class="token punctuation">(</span>
s <span class="token keyword">SET</span> <span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_set <span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'A,B'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#插入重复的SET类型成员时，MySQL会自动删除重复的成员</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_set <span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'A,B,C,A'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#向SET类型的字段插入SET成员中不存在的值时，MySQL会抛出错误。</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_set <span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'A,B,C,D'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> test_set<span class="token punctuation">;</span>


<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> temp_mul<span class="token punctuation">(</span>
gender <span class="token keyword">ENUM</span><span class="token punctuation">(</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
hobby <span class="token keyword">SET</span><span class="token punctuation">(</span><span class="token string">'吃饭'</span><span class="token punctuation">,</span><span class="token string">'睡觉'</span><span class="token punctuation">,</span><span class="token string">'打豆豆'</span><span class="token punctuation">,</span><span class="token string">'写代码'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> temp_mul
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token string">'睡觉,打豆豆'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> 
<span class="token keyword">FROM</span> temp_mul<span class="token punctuation">;</span>

<span class="token comment">#Data truncated for column 'gender' at row 1</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> temp_mul
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'男,女'</span><span class="token punctuation">,</span><span class="token string">'睡觉,打豆豆'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="10-BINARY-与-VARBINARY类型-Blob类型"><a href="#10-BINARY-与-VARBINARY类型-Blob类型" class="headerlink" title="10.BINARY 与 VARBINARY类型,Blob类型"></a>10.BINARY 与 VARBINARY类型,Blob类型</h4><p>BINARY与VARBINARY类型 </p>
<p>BINARY和VARBINARY类似于CHAR和VARCHAR，只是它们存储的是二进制字符串。 </p>
<p>BINARY (M)为固定长度的二进制字符串，M表示最多能存储的字节数，取值范围是0~255个字符。如果未 指定(M)，表示只能存储 1个字节 。例如BINARY (8)，表示最多能存储8个字节，如果字段值不足(M)个字 节，将在右边填充’\0’以补齐指定长度。</p>
<p>VARBINARY (M)为可变长度的二进制字符串，M表示最多能存储的字节数，总字节数不能超过行的字节长 度限制65535，另外还要考虑额外字节开销，VARBINARY类型的数据除了存储数据本身外，还需要1或2个 字节来存储数据的字节数。VARBINARY类型 必须指定(M) ，否则报错。</p>
<p><img src="/2022/03/21/mysql/3.jpg" alt="3"></p>
<p>BLOB是一个 二进制大对象 ，可以容纳可变数量的数据。 </p>
<p>MySQL中的BLOB类型包括TINYBLOB、BLOB、MEDIUMBLOB和LONGBLOB 4种类型，它们可容纳值的最大 长度不同。可以存储一个二进制的大对象，比如 图片 、 音频 和 视频 等。 </p>
<p>需要注意的是，在实际工作中，往往不会在MySQL数据库中使用BLOB类型存储大对象数据，通常会将图 片、音频和视频文件存储到 服务器的磁盘上 ，并将图片、音频和视频的访问路径存储到MySQL中。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">#10.1 BINARY 与 VARBINARY类型</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test_binary1<span class="token punctuation">(</span>
f1 <span class="token keyword">BINARY</span><span class="token punctuation">,</span>
f2 <span class="token keyword">BINARY</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token comment">#f3 VARBINARY,</span>
f4 <span class="token keyword">VARBINARY</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DESC</span> test_binary1<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_binary1<span class="token punctuation">(</span>f1<span class="token punctuation">,</span>f2<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'abc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> test_binary1<span class="token punctuation">;</span>

<span class="token comment">#Data too long for column 'f1' at row 1</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_binary1<span class="token punctuation">(</span>f1<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'ab'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_binary1<span class="token punctuation">(</span>f2<span class="token punctuation">,</span>f4<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'ab'</span><span class="token punctuation">,</span><span class="token string">'ab'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> LENGTH<span class="token punctuation">(</span>f2<span class="token punctuation">)</span><span class="token punctuation">,</span>LENGTH<span class="token punctuation">(</span>f4<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> test_binary1<span class="token punctuation">;</span>

<span class="token comment">#10.2 Blob类型</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test_blob1<span class="token punctuation">(</span>
id <span class="token keyword">INT</span><span class="token punctuation">,</span>
img <span class="token keyword">MEDIUMBLOB</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_blob1<span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> test_blob1<span class="token punctuation">;</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="11-JSON类型"><a href="#11-JSON类型" class="headerlink" title="11.JSON类型"></a>11.JSON类型</h4><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">#11. JSON类型</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test_json<span class="token punctuation">(</span>
js json

<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_json <span class="token punctuation">(</span>js<span class="token punctuation">)</span> 
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'{"name":"songhk", "age":18, "address":{"province":"beijing", "city":"beijing"}}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> test_json<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> js <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token string">'$.name'</span> <span class="token keyword">AS</span> NAME<span class="token punctuation">,</span>js <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token string">'$.age'</span> <span class="token keyword">AS</span> age <span class="token punctuation">,</span>js <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token string">'$.address.province'</span> <span class="token keyword">AS</span> province<span class="token punctuation">,</span> js <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token string">'$.address.city'</span> <span class="token keyword">AS</span> city
<span class="token keyword">FROM</span> test_json<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>阿里巴巴《Java开发手册》之MySQL数据库： </p>
<p>​        任何字段如果为非负数，必须是 UNSIGNED </p>
<p>​        【 强制 】小数类型为 DECIMAL，禁止使用 FLOAT 和 DOUBLE。 </p>
<p>​                说明：在存储的时候，FLOAT 和 DOUBLE 都存在精度损失的问题，很可能在比较值的时候，得 到不正确的结果。如果存储的数据范围超过 DECIMAL 的范围，建议将数据拆成整数和小数并 分开存储。         </p>
<p>​        【 强制 】如果存储的字符串长度几乎相等，使用 CHAR 定长字符串类型。 </p>
<p>​        【 强制 】VARCHAR 是可变长字符串，不预先分配存储空间，长度不要超过 5000。如果存储长度大 于此值，定义字段类型为 TEXT，独立出来一张表，用主键来对应，避免影响其它字段索引效率。</p>
<h3 id="约束"><a href="#约束" class="headerlink" title="约束"></a>约束</h3><p>为什么需要约束 </p>
<p>数据完整性（Data Integrity）是指数据的精确性（Accuracy）和可靠性（Reliability）。它是防止数据库中 存在不符合语义规定的数据和防止因错误信息的输入输出造成无效操作或错误信息而提出的。 </p>
<p>为了保证数据的完整性，SQL规范以约束的方式对表数据进行额外的条件限制。从以下四个方面考虑： </p>
<p>​        实体完整性（Entity Integrity） ：例如，同一个表中，不能存在两条完全相同无法区分的记录 </p>
<p>​        域完整性（Domain Integrity） ：例如：年龄范围0-120，性别范围“男/女” </p>
<p>​        引用完整性（Referential Integrity） ：例如：员工所在部门，在部门表中要能找到这个部门 </p>
<p>​        用户自定义完整性（User-defined Integrity） ：例如：用户名唯一、密码不能为空等，本部门经理的工资不得高于本部门职工的平均工资的5倍。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">#第13章_约束</span>

<span class="token comment">/*
1. 基础知识
1.1 为什么需要约束？ 为了保证数据的完整性！

1.2 什么叫约束？对表中字段的限制。

1.3 约束的分类：

角度1：约束的字段的个数
单列约束 vs 多列约束

角度2：约束的作用范围

列级约束：将此约束声明在对应字段的后面
表级约束：在表中所有字段都声明完，在所有字段的后面声明的约束

角度3：约束的作用（或功能）

① not null (非空约束)
② unique  (唯一性约束)
③ primary key (主键约束)
④ foreign key (外键约束)
⑤ check (检查约束)
⑥ default (默认值约束)

1.4 如何添加/删除约束？

CREATE TABLE时添加约束

ALTER TABLE 时增加约束、删除约束


*/</span>

<span class="token comment">#2. 如何查看表中的约束</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span>table_constraints 
<span class="token keyword">WHERE</span> table_name <span class="token operator">=</span> <span class="token string">'test1'</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> dbtest13<span class="token punctuation">;</span>
<span class="token keyword">USE</span> dbtest13<span class="token punctuation">;</span>
<span class="token comment">#3. not null (非空约束)</span>
<span class="token comment">#3.1 在CREATE TABLE时添加约束</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test1<span class="token punctuation">(</span>
id <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
last_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
email <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
salary <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DESC</span> test1<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test1<span class="token punctuation">(</span>id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>email<span class="token punctuation">,</span>salary<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'Tom'</span><span class="token punctuation">,</span><span class="token string">'tom@126.com'</span><span class="token punctuation">,</span><span class="token number">3400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#错误：Column 'last_name' cannot be null</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test1<span class="token punctuation">(</span>id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>email<span class="token punctuation">,</span>salary<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token string">'tom1@126.com'</span><span class="token punctuation">,</span><span class="token number">3400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#错误：Column 'id' cannot be null</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test1<span class="token punctuation">(</span>id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>email<span class="token punctuation">,</span>salary<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token string">'Jerry'</span><span class="token punctuation">,</span><span class="token string">'jerry@126.com'</span><span class="token punctuation">,</span><span class="token number">3400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test1<span class="token punctuation">(</span>id<span class="token punctuation">,</span>email<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'abc@126.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">UPDATE</span> test1
<span class="token keyword">SET</span> last_name <span class="token operator">=</span> <span class="token boolean">NULL</span>
<span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token keyword">UPDATE</span> test1
<span class="token keyword">SET</span> email <span class="token operator">=</span> <span class="token string">'tom@126.com'</span>
<span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">#3.2 在ALTER TABLE时添加约束</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> test1<span class="token punctuation">;</span>

<span class="token keyword">DESC</span> test1<span class="token punctuation">;</span>

<span class="token comment">#如果存在null不能添加 not null约束</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> test1
<span class="token keyword">MODIFY</span> email <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>

<span class="token comment">#3.3 在ALTER TABLE时删除约束</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> test1
<span class="token keyword">MODIFY</span> email <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>

<span class="token comment">#4. unique  (唯一性约束)</span>

<span class="token comment">#4.1 在CREATE TABLE时添加约束</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test2<span class="token punctuation">(</span>
id <span class="token keyword">INT</span> <span class="token keyword">UNIQUE</span><span class="token punctuation">,</span> <span class="token comment">#列级约束</span>
last_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>
email <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
salary <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token comment">#表级约束（会为约束起一个名字uk_test2_email）</span>
<span class="token keyword">CONSTRAINT</span> uk_test2_email <span class="token keyword">UNIQUE</span><span class="token punctuation">(</span>email<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DESC</span> test2<span class="token punctuation">;</span>


<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span>table_constraints 
<span class="token keyword">WHERE</span> table_name <span class="token operator">=</span> <span class="token string">'test2'</span><span class="token punctuation">;</span>

<span class="token comment">#在创建唯一约束的时候，如果不给唯一约束命名，就默认和列名相同。</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test2<span class="token punctuation">(</span>id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>email<span class="token punctuation">,</span>salary<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'Tom'</span><span class="token punctuation">,</span><span class="token string">'tom@126.com'</span><span class="token punctuation">,</span><span class="token number">4500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#错误：Duplicate entry '1' for key 'test2.id'</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test2<span class="token punctuation">(</span>id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>email<span class="token punctuation">,</span>salary<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'Tom1'</span><span class="token punctuation">,</span><span class="token string">'tom1@126.com'</span><span class="token punctuation">,</span><span class="token number">4600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#错误：Duplicate entry 'tom@126.com' for key 'test2.uk_test2_email'</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test2<span class="token punctuation">(</span>id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>email<span class="token punctuation">,</span>salary<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'Tom1'</span><span class="token punctuation">,</span><span class="token string">'tom@126.com'</span><span class="token punctuation">,</span><span class="token number">4600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#可以向声明为unique的字段上添加null值。而且可以多次添加null</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test2<span class="token punctuation">(</span>id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>email<span class="token punctuation">,</span>salary<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'Tom1'</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token number">4600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test2<span class="token punctuation">(</span>id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>email<span class="token punctuation">,</span>salary<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'Tom2'</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token number">4600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> test2<span class="token punctuation">;</span>

<span class="token comment">#4.2 在ALTER TABLE时添加约束</span>

<span class="token keyword">DESC</span> test2<span class="token punctuation">;</span>

<span class="token keyword">UPDATE</span> test2
<span class="token keyword">SET</span> salary <span class="token operator">=</span> <span class="token number">5000</span>
<span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token comment">#方式1：</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> test2
<span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> uk_test2_sal <span class="token keyword">UNIQUE</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">#方式2：</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> test2
<span class="token keyword">MODIFY</span> last_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span> <span class="token keyword">UNIQUE</span><span class="token punctuation">;</span>

<span class="token comment">#4.3 复合的唯一性约束</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">USER</span><span class="token punctuation">(</span>
id <span class="token keyword">INT</span><span class="token punctuation">,</span>
<span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">`</span>password<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

<span class="token comment">#表级约束</span>
<span class="token keyword">CONSTRAINT</span> uk_user_name_pwd <span class="token keyword">UNIQUE</span><span class="token punctuation">(</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>password<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token keyword">USER</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'Tom'</span><span class="token punctuation">,</span><span class="token string">'abc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">#可以成功的：</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token keyword">USER</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'Tom1'</span><span class="token punctuation">,</span><span class="token string">'abc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> <span class="token keyword">USER</span><span class="token punctuation">;</span>

<span class="token comment">#案例：复合的唯一性约束的案例</span>
<span class="token comment">#学生表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> student<span class="token punctuation">(</span>
    sid <span class="token keyword">INT</span><span class="token punctuation">,</span>	<span class="token comment">#学号</span>
    sname <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>	<span class="token comment">#姓名</span>
    tel <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>  <span class="token comment">#电话</span>
    cardid <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span> <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token comment">#身份证号</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#课程表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> course<span class="token punctuation">(</span>
    cid <span class="token keyword">INT</span><span class="token punctuation">,</span>  <span class="token comment">#课程编号</span>
    cname <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>     <span class="token comment">#课程名称</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#选课表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> student_course<span class="token punctuation">(</span>
    id <span class="token keyword">INT</span><span class="token punctuation">,</span>
    sid <span class="token keyword">INT</span><span class="token punctuation">,</span>  <span class="token comment">#学号</span>
    cid <span class="token keyword">INT</span><span class="token punctuation">,</span>  <span class="token comment">#课程编号</span>
    score <span class="token keyword">INT</span><span class="token punctuation">,</span>
    <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>sid<span class="token punctuation">,</span>cid<span class="token punctuation">)</span>  <span class="token comment">#复合唯一</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> student <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'张三'</span><span class="token punctuation">,</span><span class="token string">'13710011002'</span><span class="token punctuation">,</span><span class="token string">'101223199012015623'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#成功</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> student <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'李四'</span><span class="token punctuation">,</span><span class="token string">'13710011003'</span><span class="token punctuation">,</span><span class="token string">'101223199012015624'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#成功</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> course <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">,</span><span class="token string">'Java'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1002</span><span class="token punctuation">,</span><span class="token string">'MySQL'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#成功</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> course<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> student_course <span class="token keyword">VALUES</span>
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1001</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1002</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1001</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1002</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#成功</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> student_course<span class="token punctuation">;</span>

<span class="token comment">#错误：Duplicate entry '2-1002' for key 'student_course.sid'</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> student_course <span class="token keyword">VALUES</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1002</span><span class="token punctuation">,</span><span class="token number">67</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#4.4 删除唯一性约束</span>
<span class="token comment">-- 添加唯一性约束的列上也会自动创建唯一索引。</span>
<span class="token comment">-- 删除唯一约束只能通过删除唯一索引的方式删除。</span>
<span class="token comment">-- 删除时需要指定唯一索引名，唯一索引名就和唯一约束名一样。</span>
<span class="token comment">-- 如果创建唯一约束时未指定名称，如果是单列，就默认和列名相同；如果是组合列，那么默认和()中排在第一个的列名相同。也可以自定义唯一性约束名。</span>


<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span>table_constraints 
<span class="token keyword">WHERE</span> table_name <span class="token operator">=</span> <span class="token string">'student_course'</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span>table_constraints 
<span class="token keyword">WHERE</span> table_name <span class="token operator">=</span> <span class="token string">'test2'</span><span class="token punctuation">;</span>

<span class="token keyword">DESC</span> test2<span class="token punctuation">;</span>

<span class="token comment">#如何删除唯一性索引</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> test2
<span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> last_name<span class="token punctuation">;</span>

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> test2
<span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> uk_test2_sal<span class="token punctuation">;</span>

<span class="token comment">#5. primary key (主键约束)</span>
<span class="token comment">#5.1 在CREATE TABLE时添加约束</span>

<span class="token comment">#一个表中最多只能有一个主键约束。</span>

<span class="token comment">#错误：Multiple primary key defined</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test3<span class="token punctuation">(</span>
id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span> <span class="token comment">#列级约束</span>
last_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
salary <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
email <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 主键约束特征：非空且唯一，用于唯一的标识表中的一条记录。</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test4<span class="token punctuation">(</span>
id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span> <span class="token comment">#列级约束</span>
last_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
salary <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
email <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">#MySQL的主键名总是PRIMARY，就算自己命名了主键约束名也没用。</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test5<span class="token punctuation">(</span>
id <span class="token keyword">INT</span> <span class="token punctuation">,</span> 
last_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
salary <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
email <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token comment">#表级约束</span>
<span class="token keyword">CONSTRAINT</span> pk_test5_id <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>  <span class="token comment">#没有必要起名字。</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span>table_constraints 
<span class="token keyword">WHERE</span> table_name <span class="token operator">=</span> <span class="token string">'test5'</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test4<span class="token punctuation">(</span>id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>salary<span class="token punctuation">,</span>email<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'Tom'</span><span class="token punctuation">,</span><span class="token number">4500</span><span class="token punctuation">,</span><span class="token string">'tom@126.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#错误：Duplicate entry '1' for key 'test4.PRIMARY'</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test4<span class="token punctuation">(</span>id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>salary<span class="token punctuation">,</span>email<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'Tom'</span><span class="token punctuation">,</span><span class="token number">4500</span><span class="token punctuation">,</span><span class="token string">'tom@126.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#错误：Column 'id' cannot be null</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test4<span class="token punctuation">(</span>id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>salary<span class="token punctuation">,</span>email<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token string">'Tom'</span><span class="token punctuation">,</span><span class="token number">4500</span><span class="token punctuation">,</span><span class="token string">'tom@126.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> test4<span class="token punctuation">;</span>


<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> user1<span class="token punctuation">(</span>
id <span class="token keyword">INT</span><span class="token punctuation">,</span>
NAME <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
PASSWORD <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>NAME<span class="token punctuation">,</span>PASSWORD<span class="token punctuation">)</span>

<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#如果是多列组合的复合主键约束，那么这些列都不允许为空值，并且组合的值不允许重复。</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> user1
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'Tom'</span><span class="token punctuation">,</span><span class="token string">'abc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> user1
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'Tom1'</span><span class="token punctuation">,</span><span class="token string">'abc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">#错误：Column 'name' cannot be null</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> user1
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token string">'abc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> user1<span class="token punctuation">;</span>

<span class="token comment">#5.2 在ALTER TABLE时添加约束</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test6<span class="token punctuation">(</span>
id <span class="token keyword">INT</span> <span class="token punctuation">,</span>
last_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
salary <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
email <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DESC</span> test6<span class="token punctuation">;</span>

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> test6
<span class="token keyword">ADD</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#5.3 如何删除主键约束 (在实际开发中，不会去删除表中的主键约束！)</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> test6
<span class="token keyword">DROP</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">;</span>

<span class="token comment">#6. 自增长列:AUTO_INCREMENT</span>
<span class="token comment">#5.3 特点和要求</span>
<span class="token comment">#（1）一个表最多只能有一个自增长列</span>
<span class="token comment">#（2）当需要产生唯一标识符或顺序值时，可设置自增长</span>
<span class="token comment">#（3）自增长列约束的列必须是键列（主键列，唯一键列）</span>
<span class="token comment">#（4）自增约束的列的数据类型必须是整数类型</span>
<span class="token comment">#（5）如果自增列指定了 0 和 null，会在当前最大值的基础上自增；如果自增列手动指定了具体值，直接赋值为具体值。</span>

<span class="token comment"># 6.1 在CREATE TABLE时添加</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test7<span class="token punctuation">(</span>
id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
last_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span> 
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">#开发中，一旦主键作用的字段上声明有AUTO_INCREMENT，则我们在添加数据时，就不要给主键</span>
<span class="token comment">#对应的字段去赋值了。</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test7<span class="token punctuation">(</span>last_name<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'Tom'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> test7<span class="token punctuation">;</span>

<span class="token comment">#当我们向主键（含AUTO_INCREMENT）的字段上添加0 或 null时，实际上会自动的往上添加指定的字段的数值</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test7<span class="token punctuation">(</span>id<span class="token punctuation">,</span>last_name<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'Tom'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test7<span class="token punctuation">(</span>id<span class="token punctuation">,</span>last_name<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token string">'Tom'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test7<span class="token punctuation">(</span>id<span class="token punctuation">,</span>last_name<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">'Tom'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test7<span class="token punctuation">(</span>id<span class="token punctuation">,</span>last_name<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">'Tom'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#6.2 在ALTER TABLE 时添加</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test8<span class="token punctuation">(</span>
id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">,</span>
last_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span> 
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DESC</span> test8<span class="token punctuation">;</span>

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> test8
<span class="token keyword">MODIFY</span> id <span class="token keyword">INT</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">;</span>

<span class="token comment">#6.3 在ALTER TABLE 时删除</span>

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> test8
<span class="token keyword">MODIFY</span> id <span class="token keyword">INT</span> <span class="token punctuation">;</span>

<span class="token comment">#6.4 MySQL 8.0新特性—自增变量的持久化</span>
<span class="token comment">#在5.7中自增长变量在内存中维护，不重启mysql服务就一直累加，1，2，3，4</span>
<span class="token comment">#将3，4，删掉在添加是5，如果重启mysql服务，在添加是3</span>
<span class="token comment">#MySQL 8.0将自增主键的计数器持久化到 重做日志 中。每次计数器发生改变，都会将其写入重做日志中。如果数据库重启，InnoDB会根据重做日志中的信息来初始化计数器的内存值。</span>
<span class="token comment">#在MySQL 5.7中演示</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test9<span class="token punctuation">(</span>
id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test9
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> test9<span class="token punctuation">;</span>

<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> test9
<span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test9
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> test9
<span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

<span class="token comment">#重启服务器</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> test9<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test9
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">#在MySQL 8.0中演示</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test9<span class="token punctuation">(</span>
id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test9
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> test9<span class="token punctuation">;</span>

<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> test9
<span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test9
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> test9
<span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

<span class="token comment">#重启服务器</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> test9<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test9
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#7.foreign key (外键约束)</span>
<span class="token comment">#7.1 在CREATE TABLE 时添加</span>

<span class="token comment">#主表和从表；父表和子表</span>

<span class="token comment">#①先创建主表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> dept1<span class="token punctuation">(</span>
dept_id <span class="token keyword">INT</span><span class="token punctuation">,</span>
dept_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">#②再创建从表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> emp1<span class="token punctuation">(</span>
emp_id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
emp_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
department_id <span class="token keyword">INT</span><span class="token punctuation">,</span>

<span class="token comment">#表级约束</span>
<span class="token keyword">CONSTRAINT</span> fk_emp1_dept_id <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>department_id<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> dept1<span class="token punctuation">(</span>dept_id<span class="token punctuation">)</span>

<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#上述操作报错，因为主表中的dept_id上没有主键约束或唯一性约束。</span>
<span class="token comment">#③ 添加</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> dept1
<span class="token keyword">ADD</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>dept_id<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DESC</span> dept1<span class="token punctuation">;</span>

<span class="token comment">#④ 再创建从表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> emp1<span class="token punctuation">(</span>
emp_id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
emp_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
department_id <span class="token keyword">INT</span><span class="token punctuation">,</span>

<span class="token comment">#表级约束</span>
<span class="token keyword">CONSTRAINT</span> fk_emp1_dept_id <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>department_id<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> dept1<span class="token punctuation">(</span>dept_id<span class="token punctuation">)</span>

<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DESC</span> emp1<span class="token punctuation">;</span>


<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span>table_constraints 
<span class="token keyword">WHERE</span> table_name <span class="token operator">=</span> <span class="token string">'emp1'</span><span class="token punctuation">;</span>

<span class="token comment">#7.2 演示外键的效果</span>
<span class="token comment">#添加失败</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> emp1
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">,</span><span class="token string">'Tom'</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> dept1
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token string">'IT'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">#在主表dept1中添加了10号部门以后，我们就可以在从表中添加10号部门的员工</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> emp1
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">,</span><span class="token string">'Tom'</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#删除失败</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> dept1
<span class="token keyword">WHERE</span> dept_id <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token comment">#更新失败</span>
<span class="token keyword">UPDATE</span> dept1
<span class="token keyword">SET</span> dept_id <span class="token operator">=</span> <span class="token number">20</span>
<span class="token keyword">WHERE</span> dept_id <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

<span class="token comment">#7.3 在ALTER TABLE时添加外键约束</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> dept2<span class="token punctuation">(</span>
dept_id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
dept_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> emp2<span class="token punctuation">(</span>
emp_id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
emp_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
department_id <span class="token keyword">INT</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> emp2
<span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> fk_emp2_dept_id <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>department_id<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> dept2<span class="token punctuation">(</span>dept_id<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span>table_constraints 
<span class="token keyword">WHERE</span> table_name <span class="token operator">=</span> <span class="token string">'emp2'</span><span class="token punctuation">;</span>

<span class="token comment">#7.4 ###  约束等级</span>

<span class="token comment">-- `Cascade方式`：在父表上update/delete记录时，同步update/delete掉子表的匹配记录 </span>

<span class="token comment">-- `Set null方式`：在父表上update/delete记录时，将子表上匹配记录的列设为null，但是要注意子表的外键列不能为not null  </span>

<span class="token comment">-- `No action方式`：如果子表中有匹配的记录，则不允许对父表对应候选键进行update/delete操作  </span>

<span class="token comment">-- `Restrict方式`：同no action， 都是立即检查外键约束</span>

<span class="token comment">-- `Set default方式`（在可视化工具SQLyog中可能显示空白）：父表有变更时，子表将外键列设置成一个默认的值，但Innodb不能识别</span>

<span class="token comment">#演示：</span>
<span class="token comment"># on update cascade on delete set null</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> dept<span class="token punctuation">(</span>
    did <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>		<span class="token comment">#部门编号</span>
    dname <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>			<span class="token comment">#部门名称</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> emp<span class="token punctuation">(</span>
    eid <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>  <span class="token comment">#员工编号</span>
    ename <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>     <span class="token comment">#员工姓名</span>
    deptid <span class="token keyword">INT</span><span class="token punctuation">,</span>		  <span class="token comment">#员工所在的部门</span>
    <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>deptid<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> dept<span class="token punctuation">(</span>did<span class="token punctuation">)</span>  <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CASCADE</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">SET</span> <span class="token boolean">NULL</span>
    <span class="token comment">#把修改操作设置为级联修改等级，把删除操作设置为set null等级</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> dept <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">,</span><span class="token string">'教学部'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> dept <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1002</span><span class="token punctuation">,</span> <span class="token string">'财务部'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> dept <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1003</span><span class="token punctuation">,</span> <span class="token string">'咨询部'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> emp <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'张三'</span><span class="token punctuation">,</span><span class="token number">1001</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">#在添加这条记录时，要求部门表有1001部门</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> emp <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'李四'</span><span class="token punctuation">,</span><span class="token number">1001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> emp <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">'王五'</span><span class="token punctuation">,</span><span class="token number">1002</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">UPDATE</span> dept
<span class="token keyword">SET</span> did <span class="token operator">=</span> <span class="token number">1004</span>
<span class="token keyword">WHERE</span> did <span class="token operator">=</span> <span class="token number">1002</span><span class="token punctuation">;</span>

<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> dept
<span class="token keyword">WHERE</span> did <span class="token operator">=</span> <span class="token number">1004</span><span class="token punctuation">;</span>


<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> dept<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emp<span class="token punctuation">;</span>

<span class="token comment">#结论：对于外键约束，最好是采用: `ON UPDATE CASCADE ON DELETE RESTRICT` 的方式。</span>


<span class="token comment">#7.5 删除外键约束</span>

<span class="token comment">#一个表中可以声明有多个外键约束</span>
<span class="token keyword">USE</span> atguigudb<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span>table_constraints 
<span class="token keyword">WHERE</span> table_name <span class="token operator">=</span> <span class="token string">'employees'</span><span class="token punctuation">;</span>

<span class="token keyword">USE</span> dbtest13<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span>table_constraints 
<span class="token keyword">WHERE</span> table_name <span class="token operator">=</span> <span class="token string">'emp1'</span><span class="token punctuation">;</span>

<span class="token comment">#删除外键约束</span>

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> emp1
<span class="token keyword">DROP</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> fk_emp1_dept_id<span class="token punctuation">;</span>

<span class="token comment">#再手动的删除外键约束对应的普通索引</span>
<span class="token keyword">SHOW</span> <span class="token keyword">INDEX</span> <span class="token keyword">FROM</span> emp1<span class="token punctuation">;</span>

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> emp1
<span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> fk_emp1_dept_id<span class="token punctuation">;</span>

<span class="token comment">#6.10 阿里开发规范</span>
<span class="token comment">#【 强制 】不得使用外键与级联，一切外键概念必须在应用层解决。</span>
<span class="token comment">#说明：（概念解释）学生表中的 student_id 是主键，那么成绩表中的 student_id 则为外键。如果更新学生表中的 student_id，同时触发成绩表中的 student_id 更新，即为级联更新。外键与级联更新适用于 单机低并发 ，不适合 分布式 、 高并发集群 ；级联更新是强阻塞，存在数据库 更新风暴 的风险；外键影响数据库的 插入速度 。</span>




<span class="token comment">#MySQL5.7 可以使用check约束，但check约束对数据验证没有任何作用。添加数据时，没有任何错误或警告</span>
<span class="token comment">#但是MySQL 8.0中可以使用check约束了。</span>

<span class="token comment">#8. check 约束</span>
<span class="token comment"># MySQL5.7 不支持CHECK约束，MySQL8.0支持CHECK约束。</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test10<span class="token punctuation">(</span>
id <span class="token keyword">INT</span><span class="token punctuation">,</span>
last_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
salary <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">CHECK</span><span class="token punctuation">(</span>salary <span class="token operator">&gt;</span> <span class="token number">2000</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test10
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'Tom'</span><span class="token punctuation">,</span><span class="token number">2500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#添加失败</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test10
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'Tom1'</span><span class="token punctuation">,</span><span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> test10<span class="token punctuation">;</span>



<span class="token comment">#9.DEFAULT约束</span>
<span class="token comment">#9.1 在CREATE TABLE添加约束</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test11<span class="token punctuation">(</span>
id <span class="token keyword">INT</span><span class="token punctuation">,</span>
last_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
salary <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token number">2000</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DESC</span> test11<span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test11<span class="token punctuation">(</span>id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>salary<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'Tom'</span><span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test11<span class="token punctuation">(</span>id<span class="token punctuation">,</span>last_name<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'Tom1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> 
<span class="token keyword">FROM</span> test11<span class="token punctuation">;</span>

<span class="token comment">#9.2 在ALTER TABLE添加约束</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test12<span class="token punctuation">(</span>
id <span class="token keyword">INT</span><span class="token punctuation">,</span>
last_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
salary <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DESC</span> test12<span class="token punctuation">;</span>

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> test12
<span class="token keyword">MODIFY</span> salary <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token number">2500</span><span class="token punctuation">;</span>

<span class="token comment">#9.3 在ALTER TABLE删除约束</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> test12
<span class="token keyword">MODIFY</span> salary <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test12<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>面试1、为什么建表时，加 not null default ‘’ 或 default 0 </p>
<p>​        答：不想让表中出现null值。 </p>
<p>面试2、为什么不想要 null 的值 </p>
<p>​        答:</p>
<p>​            （1）不好比较。null是一种特殊值，比较时只能用专门的is null 和 is not null来比较。碰到运算符，通 常返回null。 </p>
<p>​            （2）效率不高。影响提高索引效果。因此，我们往往在建表时 not null default ‘’ 或 default 0 </p>
<p>面试3、带AUTO_INCREMENT约束的字段值是从1开始的吗？ </p>
<p>​            在MySQL中，默认AUTO_INCREMENT的初始 值是1，每新增一条记录，字段值自动加1。设置自增属性（AUTO_INCREMENT）的时候，还可以指定第 一条插入记录的自增字段的值，这样新插入的记录的自增字段值从初始值开始递增，如在表中插入第一 条记录，同时指定id值为5，则以后插入的记录的id值就会从6开始往上增加。添加主键约束时，往往需要 设置字段自动增加属性。 </p>
<p>面试4、并不是每个表都可以任意选择存储引擎？</p>
<p>​             外键约束（FOREIGN KEY）不能跨引擎使用。 MySQL支持多种存储引擎，每一个表都可以指定一个不同的存储引擎，需要注意的是：外键约束是用来 保证数据的参照完整性的，如果表之间需要关联外键，却指定了不同的存储引擎，那么这些表之间是不 能创建外键约束的。所以说，存储引擎的选择也不完全是随意的。</p>
<h3 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h3><p> 常见的数据库对象:</p>
<p><img src="/2022/03/21/mysql/4.jpg" alt="4"></p>
<p>视图可以历届为存储起来的select语句。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">
<span class="token comment">#第14章_视图(View)</span>

<span class="token comment">/*
1. 视图的理解

① 视图，可以看做是一个虚拟表，本身是不存储数据的。
  视图的本质，就可以看做是存储起来的SELECT语句
  
② 视图中SELECT语句中涉及到的表，称为基表

③ 针对视图做DML操作，会影响到对应的基表中的数据。反之亦然。

④ 视图本身的删除，不会导致基表中数据的删除。

⑤ 视图的应用场景：针对于小型项目，不推荐使用视图。针对于大型项目，可以考虑使用视图。

⑥ 视图的优点：简化查询; 控制数据的访问


*/</span>

<span class="token comment">#2. 如何创建视图</span>
<span class="token comment">#准备工作</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> dbtest14<span class="token punctuation">;</span>

<span class="token keyword">USE</span> dbtest14<span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> emps
<span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> atguigudb<span class="token punctuation">.</span><span class="token punctuation">`</span>employees<span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> depts
<span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> atguigudb<span class="token punctuation">.</span><span class="token punctuation">`</span>departments<span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> emps<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> depts<span class="token punctuation">;</span>

<span class="token keyword">DESC</span> emps<span class="token punctuation">;</span>

<span class="token keyword">DESC</span> atguigudb<span class="token punctuation">.</span>employees<span class="token punctuation">;</span>


<span class="token comment">#2.1 针对于单表</span>
<span class="token comment">#情况1：视图中的字段与基表的字段有对应关系</span>
<span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> vu_emp1
<span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>salary
<span class="token keyword">FROM</span> emps<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> vu_emp1<span class="token punctuation">;</span>

<span class="token comment">#确定视图中字段名的方式1：</span>
<span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> vu_emp2
<span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> employee_id emp_id<span class="token punctuation">,</span>last_name lname<span class="token punctuation">,</span>salary <span class="token comment">#查询语句中字段的别名会作为视图中字段的名称出现</span>
<span class="token keyword">FROM</span> emps
<span class="token keyword">WHERE</span> salary <span class="token operator">&gt;</span> <span class="token number">8000</span><span class="token punctuation">;</span>

<span class="token comment">#确定视图中字段名的方式2：</span>
<span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> vu_emp3<span class="token punctuation">(</span>emp_id<span class="token punctuation">,</span>NAME<span class="token punctuation">,</span>monthly_sal<span class="token punctuation">)</span> <span class="token comment">#小括号内字段个数与SELECT中字段个数相同</span>
<span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>salary 
<span class="token keyword">FROM</span> emps
<span class="token keyword">WHERE</span> salary <span class="token operator">&gt;</span> <span class="token number">8000</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> vu_emp3<span class="token punctuation">;</span>

<span class="token comment">#情况2：视图中的字段在基表中可能没有对应的字段</span>
<span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> vu_emp_sal
<span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> department_id<span class="token punctuation">,</span><span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> avg_sal
<span class="token keyword">FROM</span> emps
<span class="token keyword">WHERE</span> department_id <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> department_id<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> vu_emp_sal<span class="token punctuation">;</span>

<span class="token comment">#2.2 针对于多表</span>

<span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> vu_emp_dept
<span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> e<span class="token punctuation">.</span>employee_id<span class="token punctuation">,</span>e<span class="token punctuation">.</span>department_id<span class="token punctuation">,</span>d<span class="token punctuation">.</span>department_name
<span class="token keyword">FROM</span> emps e <span class="token keyword">JOIN</span> depts d
<span class="token keyword">ON</span> e<span class="token punctuation">.</span><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span> <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> vu_emp_dept<span class="token punctuation">;</span>

<span class="token comment">#利用视图对数据进行格式化</span>

<span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> vu_emp_dept1
<span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> CONCAT<span class="token punctuation">(</span>e<span class="token punctuation">.</span>last_name<span class="token punctuation">,</span><span class="token string">'('</span><span class="token punctuation">,</span>d<span class="token punctuation">.</span>department_name<span class="token punctuation">,</span><span class="token string">')'</span><span class="token punctuation">)</span> emp_info
<span class="token keyword">FROM</span> emps e <span class="token keyword">JOIN</span> depts d
<span class="token keyword">ON</span> e<span class="token punctuation">.</span><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span> <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token punctuation">`</span>department_id<span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> vu_emp_dept1<span class="token punctuation">;</span>

<span class="token comment">#2.3 基于视图创建视图</span>

<span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> vu_emp4
<span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name
<span class="token keyword">FROM</span> vu_emp1<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> vu_emp4<span class="token punctuation">;</span> 


<span class="token comment">#3. 查看视图</span>
<span class="token comment"># 语法1：查看数据库的表对象、视图对象</span>
<span class="token keyword">SHOW</span> <span class="token keyword">TABLES</span><span class="token punctuation">;</span>

<span class="token comment">#语法2：查看视图的结构</span>
<span class="token keyword">DESCRIBE</span> vu_emp1<span class="token punctuation">;</span>

<span class="token comment">#语法3：查看视图的属性信息</span>
<span class="token keyword">SHOW</span> <span class="token keyword">TABLE</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">'vu_emp1'</span><span class="token punctuation">;</span>

<span class="token comment">#语法4：查看视图的详细定义信息</span>
<span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> vu_emp1<span class="token punctuation">;</span>

<span class="token comment">#4."更新"视图中的数据</span>
<span class="token comment">#4.1 一般情况，可以更新视图的数据</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> vu_emp1<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>salary
<span class="token keyword">FROM</span> emps<span class="token punctuation">;</span>
<span class="token comment">#更新视图的数据，会导致基表中数据的修改</span>
<span class="token keyword">UPDATE</span> vu_emp1
<span class="token keyword">SET</span> salary <span class="token operator">=</span> <span class="token number">20000</span>
<span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> <span class="token number">101</span><span class="token punctuation">;</span>

<span class="token comment">#同理，更新表中的数据，也会导致视图中的数据的修改</span>
<span class="token keyword">UPDATE</span> emps
<span class="token keyword">SET</span> salary <span class="token operator">=</span> <span class="token number">10000</span>
<span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> <span class="token number">101</span><span class="token punctuation">;</span>

<span class="token comment">#删除视图中的数据，也会导致表中的数据的删除</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> vu_emp1
<span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> <span class="token number">101</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>salary
<span class="token keyword">FROM</span> emps
<span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> <span class="token number">101</span><span class="token punctuation">;</span>

<span class="token comment">#4.2 不能更新视图中的数据</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> vu_emp_sal<span class="token punctuation">;</span>

<span class="token comment">#更新失败</span>
<span class="token keyword">UPDATE</span> vu_emp_sal
<span class="token keyword">SET</span> avg_sal <span class="token operator">=</span> <span class="token number">5000</span>
<span class="token keyword">WHERE</span> department_id <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>

<span class="token comment">#删除失败</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> vu_emp_sal
<span class="token keyword">WHERE</span> department_id <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>

<span class="token comment">#5. 修改视图</span>

<span class="token keyword">DESC</span> vu_emp1<span class="token punctuation">;</span>

<span class="token comment">#方式1</span>
<span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">VIEW</span> vu_emp1
<span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>salary<span class="token punctuation">,</span>email
<span class="token keyword">FROM</span> emps
<span class="token keyword">WHERE</span> salary <span class="token operator">&gt;</span> <span class="token number">7000</span><span class="token punctuation">;</span>

<span class="token comment">#方式2</span>
<span class="token keyword">ALTER</span> <span class="token keyword">VIEW</span> vu_emp1
<span class="token keyword">AS</span> 
<span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>salary<span class="token punctuation">,</span>email<span class="token punctuation">,</span>hire_date
<span class="token keyword">FROM</span> emps<span class="token punctuation">;</span>

<span class="token comment">#6. 删除视图</span>
<span class="token keyword">SHOW</span> <span class="token keyword">TABLES</span><span class="token punctuation">;</span>

<span class="token keyword">DROP</span> <span class="token keyword">VIEW</span> vu_emp4<span class="token punctuation">;</span>

<span class="token keyword">DROP</span> <span class="token keyword">VIEW</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> vu_emp2<span class="token punctuation">,</span>vu_emp3<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>视图优点 </p>
<ol>
<li><p>操作简单 </p>
<p>​        将经常使用的查询操作定义为视图，可以使开发人员不需要关心视图对应的数据表的结构、表与表之间 的关联关系，也不需要关心数据表之间的业务逻辑和查询条件，而只需要简单地操作视图即可，极大简 化了开发人员对数据库的操作。 </p>
</li>
<li><p>减少数据冗余 </p>
<p>​        视图跟实际数据表不一样，它存储的是查询语句。所以，在使用的时候，我们要通过定义视图的查询语 句来获取结果集。而视图本身不存储数据，不占用数据存储的资源，减少了数据冗余。</p>
</li>
<li><p>数据安全 </p>
<p>​        MySQL将用户对数据的 访问限制 在某些数据的结果集上，而这些数据的结果集可以使用视图来实现。用 户不必直接查询或操作数据表。这也可以理解为视图具有 隔离性 。视图相当于在用户和实际的数据表之 间加了一层虚拟表。同时，MySQL可以根据权限将用户对数据的访问限制在某些视图上，用户不需要查询数据表，可以直接 通过视图获取数据表中的信息。这在一定程度上保障了数据表中数据的安全性。</p>
</li>
<li><p>适应灵活多变的需求 </p>
<p>​        当业务系统的需求发生变化后，如果需要改动数据表的结构，则工作量相对较 大，可以使用视图来减少改动的工作量。这种方式在实际工作中使用得比较多。</p>
</li>
<li><p>能够分解复杂的查询逻辑 </p>
<p>​        数据库中如果存在复杂的查询逻辑，则可以将问题进行分解，创建多个视图 获取数据，再将创建的多个视图结合起来，完成复杂的查询逻辑。</p>
</li>
</ol>
<p>视图的不足：</p>
<ol>
<li>如果实际数据表变更了，需要对视图进行维护</li>
<li>实际项目中，如果视图过多，会导致数据库维护成本的问题。</li>
</ol>
<h3 id="存储过程与存储函数"><a href="#存储过程与存储函数" class="headerlink" title="存储过程与存储函数"></a>存储过程与存储函数</h3><p>含义：存储过程的英文是 Stored Procedure 。它的思想很简单，就是一组经过 预先编译 的 SQL 语句 的封装。 </p>
<p>执行过程：存储过程预先存储在 MySQL 服务器上，需要执行的时候，客户端只需要向服务器端发出调用 存储过程的命令，服务器端就可以把预先存储好的这一系列 SQL 语句全部执行。 </p>
<p>好处： </p>
<p>1、简化操作，提高了sql语句的重用性，减少了开发程序员的压力 </p>
<p>2、减少操作过程中的失误，提高效率 </p>
<p>3、减少网络传输量（客户端不需要把所有的 SQL 语句通过网络发给服务器） </p>
<p>4、减少了 SQL 语句暴露在 网上的风险，也提高了数据查询的安全性 </p>
<p>和视图、函数的对比： </p>
<p>它和视图有着同样的优点，清晰、安全，还可以减少网络传输量。不过它和视图不同，视图是 虚拟表 ， 通常不对底层数据表直接操作，而存储过程是程序化的 SQL，可以 直接操作底层数据表 ，相比于面向集 合的操作方式，能够实现一些更复杂的数据处理。 </p>
<p>一旦存储过程被创建出来，使用它就像使用函数一样简单，我们直接通过调用存储过程名即可。相较于 函数，存储过程是 没有返回值 的。</p>
<p> 分类:</p>
<p>存储过程的参数类型可以是IN、OUT和INOUT。根据这点分类如下： </p>
<p>1、没有参数（无参数无返回） </p>
<p>2、仅仅带 IN 类型（有参数无返回） </p>
<p>3、仅仅带 OUT 类型（无参数有返 回） </p>
<p>4、既带 IN 又带 OUT（有参数有返回） </p>
<p>5、带 INOUT（有参数有返回） </p>
<p>注意：IN、OUT、INOUT 都可以在一个存储过程中带多个。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">#第15章_存储过程与存储函数</span>

<span class="token comment">#0.准备工作</span>

<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> dbtest15<span class="token punctuation">;</span>

<span class="token keyword">USE</span> dbtest15<span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> employees
<span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> 
<span class="token keyword">FROM</span> atguigudb<span class="token punctuation">.</span><span class="token punctuation">`</span>employees<span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> departments
<span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> atguigudb<span class="token punctuation">.</span><span class="token punctuation">`</span>departments<span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> departments<span class="token punctuation">;</span>

<span class="token comment">#1. 创建存储过程</span>

<span class="token comment">#类型1：无参数无返回值</span>

<span class="token comment">#举例1：创建存储过程select_all_data()，查看 employees 表的所有数据</span>

<span class="token keyword">DELIMITER</span> $

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> select_all_data<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
<span class="token keyword">END</span> $

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#2. 存储过程的调用</span>

<span class="token keyword">CALL</span> select_all_data<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#举例2：创建存储过程avg_employee_salary()，返回所有员工的平均工资</span>

<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> avg_employee_salary<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span> 
	<span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
	
<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用</span>
<span class="token keyword">CALL</span> avg_employee_salary<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">#举例3：创建存储过程show_max_salary()，用来查看“emps”表的最高薪资值。</span>

<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> show_max_salary<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span>
	<span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用</span>
<span class="token keyword">CALL</span> show_max_salary<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#类型2：带 OUT</span>
<span class="token comment">#举例4：创建存储过程show_min_salary()，查看“emps”表的最低薪资值。并将最低薪资</span>
<span class="token comment">#通过OUT参数“ms”输出</span>

<span class="token keyword">DESC</span> employees<span class="token punctuation">;</span>

<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> show_min_salary<span class="token punctuation">(</span><span class="token keyword">OUT</span> ms <span class="token keyword">DOUBLE</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">INTO</span> ms
	<span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用</span>

<span class="token keyword">CALL</span> show_min_salary<span class="token punctuation">(</span><span class="token variable">@ms</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#查看变量值</span>
<span class="token keyword">SELECT</span> <span class="token variable">@ms</span><span class="token punctuation">;</span>

<span class="token comment">#类型3：带 IN</span>
<span class="token comment">#举例5：创建存储过程show_someone_salary()，查看“emps”表的某个员工的薪资，</span>
<span class="token comment">#并用IN参数empname输入员工姓名。</span>

<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> show_someone_salary<span class="token punctuation">(</span><span class="token operator">IN</span> empname <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">SELECT</span> salary <span class="token keyword">FROM</span> employees
	<span class="token keyword">WHERE</span> last_name <span class="token operator">=</span> empname<span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用方式1</span>
<span class="token keyword">CALL</span> show_someone_salary<span class="token punctuation">(</span><span class="token string">'Abel'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">#调用方式2</span>
<span class="token keyword">SET</span> <span class="token variable">@empname</span> :<span class="token operator">=</span> <span class="token string">'Abel'</span><span class="token punctuation">;</span>
<span class="token keyword">CALL</span> show_someone_salary<span class="token punctuation">(</span><span class="token variable">@empname</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> last_name <span class="token operator">=</span> <span class="token string">'Abel'</span><span class="token punctuation">;</span>

<span class="token comment">#类型4：带 IN 和 OUT</span>
<span class="token comment">#举例6：创建存储过程show_someone_salary2()，查看“emps”表的某个员工的薪资，</span>
<span class="token comment">#并用IN参数empname输入员工姓名，用OUT参数empsalary输出员工薪资。</span>

<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> show_someone_salary2<span class="token punctuation">(</span><span class="token operator">IN</span> empname <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">OUT</span> empsalary <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">SELECT</span> salary <span class="token keyword">INTO</span> empsalary
	<span class="token keyword">FROM</span> employees
	<span class="token keyword">WHERE</span> last_name <span class="token operator">=</span> empname<span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用</span>
<span class="token keyword">SET</span> <span class="token variable">@empname</span> <span class="token operator">=</span> <span class="token string">'Abel'</span><span class="token punctuation">;</span>
<span class="token keyword">CALL</span> show_someone_salary2<span class="token punctuation">(</span><span class="token variable">@empname</span><span class="token punctuation">,</span><span class="token variable">@empsalary</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token variable">@empsalary</span><span class="token punctuation">;</span>


<span class="token comment">#类型5：带 INOUT</span>
<span class="token comment">#举例7：创建存储过程show_mgr_name()，查询某个员工领导的姓名，并用INOUT参数“empname”输入员工姓名，</span>
<span class="token comment">#输出领导的姓名。</span>

<span class="token keyword">DESC</span> employees<span class="token punctuation">;</span>

<span class="token keyword">DELIMITER</span> $

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> show_mgr_name<span class="token punctuation">(</span><span class="token keyword">INOUT</span> empname <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>

	<span class="token keyword">SELECT</span> last_name <span class="token keyword">INTO</span> empname
	<span class="token keyword">FROM</span> employees
	<span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> <span class="token punctuation">(</span>
				<span class="token keyword">SELECT</span> manager_id
				<span class="token keyword">FROM</span> employees
				<span class="token keyword">WHERE</span> last_name <span class="token operator">=</span> empname
				<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
<span class="token keyword">END</span> $

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用</span>
<span class="token keyword">SET</span> <span class="token variable">@empname</span> :<span class="token operator">=</span> <span class="token string">'Abel'</span><span class="token punctuation">;</span>
<span class="token keyword">CALL</span> show_mgr_name<span class="token punctuation">(</span><span class="token variable">@empname</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token variable">@empname</span><span class="token punctuation">;</span>

<span class="token comment">#2.存储函数</span>

<span class="token comment"># 举例1：创建存储函数，名称为email_by_name()，参数定义为空，</span>
<span class="token comment">#该函数查询Abel的email，并返回，数据类型为字符串型。</span>
<span class="token comment">#若在创建存储函数中报错“ you might want to use the less safe</span>
log_bin_trust_function_creators variable ”，有两种处理方法：

<span class="token comment">#方式1：加上必要的函数特性“[NOT] DETERMINISTIC”和“{CONTAINS SQL | NO SQL | READS SQL DATA |MODIFIES SQL DATA}”</span>
<span class="token comment">#方式2： SET GLOBAL log_bin_trust_function_creators = 1;</span>


<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> email_by_name<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">RETURNS</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span>
	<span class="token keyword">DETERMINISTIC</span>
	<span class="token keyword">CONTAINS</span> <span class="token keyword">SQL</span>
	<span class="token keyword">READS</span> <span class="token keyword">SQL</span> <span class="token keyword">DATA</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">RETURN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> email <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> last_name <span class="token operator">=</span> <span class="token string">'Abel'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用</span>
<span class="token keyword">SELECT</span> email_by_name<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> email<span class="token punctuation">,</span>last_name <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> last_name <span class="token operator">=</span> <span class="token string">'Abel'</span><span class="token punctuation">;</span>

<span class="token comment">#举例2：创建存储函数，名称为email_by_id()，参数传入emp_id，该函数查询emp_id的email，</span>
<span class="token comment">#并返回，数据类型为字符串型。</span>

<span class="token comment">#创建函数前执行此语句，保证函数的创建会成功</span>
<span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> log_bin_trust_function_creators <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">#声明函数</span>

<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> email_by_id<span class="token punctuation">(</span>emp_id <span class="token keyword">INT</span><span class="token punctuation">)</span>
<span class="token keyword">RETURNS</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span>

<span class="token keyword">BEGIN</span>
	<span class="token keyword">RETURN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> email <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> emp_id<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>


<span class="token comment">#调用</span>
<span class="token keyword">SELECT</span> email_by_id<span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SET</span> <span class="token variable">@emp_id</span> :<span class="token operator">=</span> <span class="token number">102</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> email_by_id<span class="token punctuation">(</span><span class="token variable">@emp_id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">#举例3：创建存储函数count_by_id()，参数传入dept_id，该函数查询dept_id部门的</span>
<span class="token comment">#员工人数，并返回，数据类型为整型。</span>

<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> count_by_id<span class="token punctuation">(</span>dept_id <span class="token keyword">INT</span><span class="token punctuation">)</span>
<span class="token keyword">RETURNS</span> <span class="token keyword">INT</span>

<span class="token keyword">BEGIN</span>
	<span class="token keyword">RETURN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> department_id <span class="token operator">=</span> dept_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用</span>
<span class="token keyword">SET</span> <span class="token variable">@dept_id</span> :<span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> count_by_id<span class="token punctuation">(</span><span class="token variable">@dept_id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">#3. 存储过程、存储函数的查看</span>

<span class="token comment">#方式1. 使用SHOW CREATE语句查看存储过程和函数的创建信息</span>

<span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> show_mgr_name<span class="token punctuation">;</span>

<span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> count_by_id<span class="token punctuation">;</span>

<span class="token comment">#方式2. 使用SHOW STATUS语句查看存储过程和函数的状态信息</span>

<span class="token keyword">SHOW</span> <span class="token keyword">PROCEDURE</span> <span class="token keyword">STATUS</span><span class="token punctuation">;</span>

<span class="token keyword">SHOW</span> <span class="token keyword">PROCEDURE</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">'show_max_salary'</span><span class="token punctuation">;</span>

<span class="token keyword">SHOW</span> <span class="token keyword">FUNCTION</span> <span class="token keyword">STATUS</span> <span class="token operator">LIKE</span> <span class="token string">'email_by_id'</span><span class="token punctuation">;</span>

<span class="token comment">#方式3.从information_schema.Routines表中查看存储过程和函数的信息</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span>Routines
<span class="token keyword">WHERE</span> ROUTINE_NAME<span class="token operator">=</span><span class="token string">'email_by_id'</span> <span class="token operator">AND</span> ROUTINE_TYPE <span class="token operator">=</span> <span class="token string">'FUNCTION'</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span>Routines
<span class="token keyword">WHERE</span> ROUTINE_NAME<span class="token operator">=</span><span class="token string">'show_min_salary'</span> <span class="token operator">AND</span> ROUTINE_TYPE <span class="token operator">=</span> <span class="token string">'PROCEDURE'</span><span class="token punctuation">;</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>修改存储过程或函数，不影响存储过程或函数功能，只是修改相关特性。使用ALTER语句实现。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> {<span class="token keyword">PROCEDURE</span> <span class="token operator">|</span> <span class="token keyword">FUNCTION</span>} 存储过程或函数的名 <span class="token punctuation">[</span>characteristic <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>其中，characteristic指定存储过程或函数的特性，其取值信息与创建存储过程、函数时的取值信息略有 不同。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">{ <span class="token keyword">CONTAINS</span> <span class="token keyword">SQL</span> <span class="token operator">|</span> <span class="token keyword">NO</span> <span class="token keyword">SQL</span> <span class="token operator">|</span> <span class="token keyword">READS</span> <span class="token keyword">SQL</span> <span class="token keyword">DATA</span> <span class="token operator">|</span> <span class="token keyword">MODIFIES</span> <span class="token keyword">SQL</span> <span class="token keyword">DATA</span> }
<span class="token operator">|</span> <span class="token keyword">SQL</span> SECURITY { <span class="token keyword">DEFINER</span> <span class="token operator">|</span> <span class="token keyword">INVOKER</span> }
<span class="token operator">|</span> <span class="token keyword">COMMENT</span> <span class="token string">'string'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>CONTAINS SQL ，表示子程序包含SQL语句，但不包含读或写数据的语句。 </p>
<p>NO SQL ，表示子程序中不包含SQL语句。 </p>
<p>READS SQL DATA ，表示子程序中包含读数据的语句。 </p>
<p>MODIFIES SQL DATA ，表示子程序中包含写数据的语句。 </p>
<p>SQL SECURITY { DEFINER | INVOKER } ，指明谁有权限来执行。 </p>
<p>DEFINER ，表示只有定义者自己才能够执行。 </p>
<p>INVOKER ，表示调用者可以执行。 </p>
<p>COMMENT ‘string’ ，表示注释信息</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">#4.存储过程、函数的修改</span>
<span class="token keyword">ALTER</span> <span class="token keyword">PROCEDURE</span> show_max_salary
<span class="token keyword">SQL</span> SECURITY <span class="token keyword">INVOKER</span>
<span class="token keyword">COMMENT</span> <span class="token string">'查询最高工资'</span><span class="token punctuation">;</span>

<span class="token comment">#5. 存储过程、函数的删除</span>

<span class="token keyword">DROP</span> <span class="token keyword">FUNCTION</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> count_by_id<span class="token punctuation">;</span>

<span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> show_min_salary<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>存储函数和存储过程对比：</p>
<p><img src="/2022/03/21/mysql/5.jpg" alt="5"></p>
<p>此外，存储函数可以放在查询语句中使用，存储过程不行。反之，存储过程的功能更加强大，包括能够 执行对表的操作（比如创建表，删除表等）和事务操作，这些功能是存储函数不具备的。</p>
<p>存储过程优点</p>
<p>1、存储过程可以一次编译多次使用。存储过程只在创建时进行编译，之后的使用都不需要重新编译， 这就提升了 SQL 的执行效率。 </p>
<p>2、可以减少开发工作量。将代码 封装 成模块，实际上是编程的核心思想之一，这样可以把复杂的问题 拆解成不同的模块，然后模块之间可以 重复使用 ，在减少开发工作量的同时，还能保证代码的结构清 晰。 </p>
<p>3、存储过程的安全性强。我们在设定存储过程的时候可以 设置对用户的使用权限 ，这样就和视图一样具 有较强的安全性。</p>
<p>4、可以减少网络传输量。因为代码封装到存储过程中，每次使用只需要调用存储过程即可，这样就减 少了网络传输量。 </p>
<p>5、良好的封装性。在进行相对复杂的数据库操作时，原本需要使用一条一条的 SQL 语句，可能要连接 多次数据库才能完成的操作，现在变成了一次存储过程，只需要 连接一次即可 。</p>
<p>缺点：</p>
<p>基于上面这些优点，不少大公司都要求大型项目使用存储过程，比如微软、IBM 等公司。但是国内的阿 里并不推荐开发人员使用存储过程，这是为什么呢？</p>
<p>阿里开发规范 </p>
<p>【强制】禁止使用存储过程，存储过程难以调试和扩展，更没有移植性。</p>
<p>1、可移植性差。存储过程不能跨数据库移植，比如在 MySQL、Oracle 和 SQL Server 里编写的存储过 程，在换成其他数据库时都需要重新编写。 </p>
<p>2、调试困难。只有少数 DBMS 支持存储过程的调试。对于复杂的存储过程来说，开发和维护都不容 易。虽然也有一些第三方工具可以对存储过程进行调试，但要收费。 </p>
<p>3、存储过程的版本管理很困难。比如数据表索引发生变化了，可能会导致存储过程失效。我们在开发 软件的时候往往需要进行版本管理，但是存储过程本身没有版本控制，版本迭代更新的时候很麻烦。 </p>
<p>4、它不适合高并发的场景。高并发的场景需要减少数据库的压力，有时数据库会采用分库分表的方 式，而且对可扩展性要求很高，在这种情况下，存储过程会变得难以维护， 增加数据库的压力 ，显然就不适用了。</p>
<h3 id="变量、流程控制与游标"><a href="#变量、流程控制与游标" class="headerlink" title="变量、流程控制与游标"></a>变量、流程控制与游标</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">#第16章_变量、流程控制与游标</span>

<span class="token comment">#1. 变量</span>
<span class="token comment">#1.1 变量： 系统变量（全局系统变量、会话系统变量）  vs 用户自定义变量</span>

<span class="token comment">#1.2 查看系统变量</span>
<span class="token comment">#查询全局系统变量</span>
<span class="token keyword">SHOW</span> <span class="token keyword">GLOBAL</span> VARIABLES<span class="token punctuation">;</span> <span class="token comment">#617</span>
<span class="token comment">#查询会话系统变量</span>
<span class="token keyword">SHOW</span> <span class="token keyword">SESSION</span> VARIABLES<span class="token punctuation">;</span> <span class="token comment">#640</span>

<span class="token keyword">SHOW</span> VARIABLES<span class="token punctuation">;</span> <span class="token comment">#默认查询的是会话系统变量</span>

<span class="token comment">#查询部分系统变量</span>

<span class="token keyword">SHOW</span> <span class="token keyword">GLOBAL</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'admin_%'</span><span class="token punctuation">;</span>

<span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'character_%'</span><span class="token punctuation">;</span>

<span class="token comment">#1.3 查看指定系统变量</span>

<span class="token keyword">SELECT</span> @<span class="token variable">@global.max_connections</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> @<span class="token variable">@global.character_set_client</span><span class="token punctuation">;</span>

<span class="token comment">#错误：</span>
<span class="token keyword">SELECT</span> @<span class="token variable">@global.pseudo_thread_id</span><span class="token punctuation">;</span>

<span class="token comment">#错误：</span>
<span class="token keyword">SELECT</span> @<span class="token variable">@session.max_connections</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> @<span class="token variable">@session.character_set_client</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> @<span class="token variable">@session.pseudo_thread_id</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> @<span class="token variable">@character_set_client</span><span class="token punctuation">;</span> <span class="token comment">#先查询会话系统变量，再查询全局系统变量</span>

<span class="token comment">#1.4 修改系统变量的值</span>
<span class="token comment">#全局系统变量：</span>
<span class="token comment">#方式1：</span>
<span class="token keyword">SET</span> @<span class="token variable">@global.max_connections</span> <span class="token operator">=</span> <span class="token number">161</span><span class="token punctuation">;</span>
<span class="token comment">#方式2：</span>
<span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> max_connections <span class="token operator">=</span> <span class="token number">171</span><span class="token punctuation">;</span>

<span class="token comment">#针对于当前的数据库实例是有效的，一旦重启mysql服务，就失效了。</span>


<span class="token comment">#会话系统变量：</span>
<span class="token comment">#方式1：</span>
<span class="token keyword">SET</span> @<span class="token variable">@session.character_set_client</span> <span class="token operator">=</span> <span class="token string">'gbk'</span><span class="token punctuation">;</span>
<span class="token comment">#方式2：</span>
<span class="token keyword">SET</span> <span class="token keyword">SESSION</span> character_set_client <span class="token operator">=</span> <span class="token string">'gbk'</span><span class="token punctuation">;</span>

<span class="token comment">#针对于当前会话是有效的，一旦结束会话，重新建立起新的会话，就失效了。</span>

<span class="token comment">#1.5 用户变量</span>
<span class="token comment">/*
① 用户变量 ： 会话用户变量 vs 局部变量

② 会话用户变量：使用"@"开头，作用域为当前会话。

③ 局部变量：只能使用在存储过程和存储函数中的。

*/</span>

<span class="token comment">#1.6 会话用户变量</span>
<span class="token comment">/*
① 变量的声明和赋值：
#方式1：“=”或“:=”
SET @用户变量 = 值;
SET @用户变量 := 值;

#方式2：“:=” 或 INTO关键字
SELECT @用户变量 := 表达式 [FROM 等子句];
SELECT 表达式 INTO @用户变量  [FROM 等子句];

② 使用
SELECT @变量名

*/</span>
<span class="token comment">#准备工作</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> dbtest16<span class="token punctuation">;</span>

<span class="token keyword">USE</span> dbtest16<span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> employees
<span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> atguigudb<span class="token punctuation">.</span><span class="token punctuation">`</span>employees<span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> departments
<span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> atguigudb<span class="token punctuation">.</span><span class="token punctuation">`</span>departments<span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> departments<span class="token punctuation">;</span>

<span class="token comment">#测试：</span>
<span class="token comment">#方式1：</span>
<span class="token keyword">SET</span> <span class="token variable">@m1</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> <span class="token variable">@m2</span> :<span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> <span class="token variable">@sum</span> :<span class="token operator">=</span> <span class="token variable">@m1</span> <span class="token operator">+</span> <span class="token variable">@m2</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token variable">@sum</span><span class="token punctuation">;</span>

<span class="token comment">#方式2：</span>
<span class="token keyword">SELECT</span> <span class="token variable">@count</span> :<span class="token operator">=</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token variable">@count</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">INTO</span> <span class="token variable">@avg_sal</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token variable">@avg_sal</span><span class="token punctuation">;</span>

<span class="token comment">#1.7 局部变量</span>
<span class="token comment">/*
1、局部变量必须满足：
① 使用DECLARE声明 
② 声明并使用在BEGIN ... END 中 （使用在存储过程、函数中）
③ DECLARE的方式声明的局部变量必须声明在BEGIN中的首行的位置。

2、声明格式：
DECLARE 变量名 类型 [default 值];  # 如果没有DEFAULT子句，初始值为NULL

3、赋值：
方式1：
SET 变量名=值;
SET 变量名:=值;

方式2：
SELECT 字段名或表达式 INTO 变量名 FROM 表;

4、使用
SELECT 局部变量名;
*/</span>

<span class="token comment">#举例：</span>
<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> test_var<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">BEGIN</span>
	<span class="token comment">#1、声明局部变量</span>
	<span class="token keyword">DECLARE</span> a <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">DECLARE</span> b <span class="token keyword">INT</span> <span class="token punctuation">;</span>
	<span class="token comment">#DECLARE a,b INT DEFAULT 0;</span>
	<span class="token keyword">DECLARE</span> emp_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">#2、赋值</span>
	<span class="token keyword">SET</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">SET</span> b :<span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	
	<span class="token keyword">SELECT</span> last_name <span class="token keyword">INTO</span> emp_name <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> <span class="token number">101</span><span class="token punctuation">;</span>
	
	<span class="token comment">#3、使用</span>
	<span class="token keyword">SELECT</span> a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>emp_name<span class="token punctuation">;</span>	
<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用存储过程</span>
<span class="token keyword">CALL</span> test_var<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#举例1：声明局部变量，并分别赋值为employees表中employee_id为102的last_name和salary</span>

<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> test_pro<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token comment">#声明</span>
	<span class="token keyword">DECLARE</span> emp_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">DECLARE</span> sal <span class="token keyword">DOUBLE</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
	<span class="token comment">#赋值</span>
	<span class="token keyword">SELECT</span> last_name<span class="token punctuation">,</span>salary <span class="token keyword">INTO</span> emp_name<span class="token punctuation">,</span>sal
	<span class="token keyword">FROM</span> employees
	<span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> <span class="token number">102</span><span class="token punctuation">;</span>
	<span class="token comment">#使用</span>
	<span class="token keyword">SELECT</span> emp_name<span class="token punctuation">,</span>sal<span class="token punctuation">;</span>
	
<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用存储过程</span>

<span class="token keyword">CALL</span> test_pro<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> last_name<span class="token punctuation">,</span>salary <span class="token keyword">FROM</span> employees
<span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> <span class="token number">102</span><span class="token punctuation">;</span>

<span class="token comment">#举例2：声明两个变量，求和并打印 （分别使用会话用户变量、局部变量的方式实现）</span>

<span class="token comment">#方式1：使用会话用户变量</span>
<span class="token keyword">SET</span> <span class="token variable">@v1</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> <span class="token variable">@v2</span> :<span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> <span class="token variable">@result</span> :<span class="token operator">=</span> <span class="token variable">@v1</span> <span class="token operator">+</span> <span class="token variable">@v2</span><span class="token punctuation">;</span>

<span class="token comment">#查看</span>
<span class="token keyword">SELECT</span> <span class="token variable">@result</span><span class="token punctuation">;</span>

<span class="token comment">#方式2：使用局部变量</span>
<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> add_value<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token comment">#声明</span>
	<span class="token keyword">DECLARE</span> value1<span class="token punctuation">,</span>value2<span class="token punctuation">,</span>sum_val <span class="token keyword">INT</span><span class="token punctuation">;</span>
	
	<span class="token comment">#赋值</span>
	<span class="token keyword">SET</span> value1 <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	<span class="token keyword">SET</span> value2 :<span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
	
	<span class="token keyword">SET</span> sum_val <span class="token operator">=</span> value1 <span class="token operator">+</span> value2<span class="token punctuation">;</span>
	<span class="token comment">#使用</span>
	<span class="token keyword">SELECT</span> sum_val<span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用存储过程</span>
<span class="token keyword">CALL</span> add_value<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#举例3：创建存储过程“different_salary”查询某员工和他领导的薪资差距，并用IN参数emp_id接收员工id，</span>
<span class="token comment">#用OUT参数dif_salary输出薪资差距结果。</span>

<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> different_salary<span class="token punctuation">(</span><span class="token operator">IN</span> emp_id <span class="token keyword">INT</span><span class="token punctuation">,</span><span class="token keyword">OUT</span> dif_salary <span class="token keyword">DOUBLE</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token comment">#分析：查询出emp_id员工的工资;查询出emp_id员工的管理者的id;查询管理者id的工资;计算两个工资的差值</span>
	
	<span class="token comment">#声明变量</span>
	<span class="token keyword">DECLARE</span> emp_sal <span class="token keyword">DOUBLE</span> <span class="token keyword">DEFAULT</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">#记录员工的工资</span>
	<span class="token keyword">DECLARE</span> mgr_sal <span class="token keyword">DOUBLE</span> <span class="token keyword">DEFAULT</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">#记录管理者的工资</span>
	
	<span class="token keyword">DECLARE</span> mgr_id <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">#记录管理者的id</span>
	
	
	<span class="token comment">#赋值</span>
	<span class="token keyword">SELECT</span> salary <span class="token keyword">INTO</span> emp_sal <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> emp_id<span class="token punctuation">;</span>
	
	<span class="token keyword">SELECT</span> manager_id <span class="token keyword">INTO</span> mgr_id <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> emp_id<span class="token punctuation">;</span>
	<span class="token keyword">SELECT</span> salary <span class="token keyword">INTO</span> mgr_sal <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> mgr_id<span class="token punctuation">;</span>
	
	<span class="token keyword">SET</span> dif_salary <span class="token operator">=</span> mgr_sal <span class="token operator">-</span> emp_sal<span class="token punctuation">;</span>

<span class="token keyword">END</span> <span class="token comment">//</span>
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用存储过程</span>
<span class="token keyword">SET</span> <span class="token variable">@emp_id</span> :<span class="token operator">=</span> <span class="token number">103</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> <span class="token variable">@dif_sal</span> :<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">CALL</span> different_salary<span class="token punctuation">(</span><span class="token variable">@emp_id</span><span class="token punctuation">,</span><span class="token variable">@dif_sal</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token variable">@dif_sal</span><span class="token punctuation">;</span>


<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>


<span class="token comment">#2. 定义条件和处理程序</span>

<span class="token comment">#2.1 错误演示：</span>

<span class="token comment">#错误代码： 1364</span>
<span class="token comment">#Field 'email' doesnt have a default value</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> employees<span class="token punctuation">(</span>last_name<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'Tom'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DESC</span> employees<span class="token punctuation">;</span>

<span class="token comment">#错误演示：</span>
<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> UpdateDataNoCondition<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">BEGIN</span>
		<span class="token keyword">SET</span> <span class="token variable">@x</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> email <span class="token operator">=</span> <span class="token boolean">NULL</span> <span class="token keyword">WHERE</span> last_name <span class="token operator">=</span> <span class="token string">'Abel'</span><span class="token punctuation">;</span>
		<span class="token keyword">SET</span> <span class="token variable">@x</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
		<span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> email <span class="token operator">=</span> <span class="token string">'aabbel'</span> <span class="token keyword">WHERE</span> last_name <span class="token operator">=</span> <span class="token string">'Abel'</span><span class="token punctuation">;</span>
		<span class="token keyword">SET</span> <span class="token variable">@x</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
	<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用存储过程</span>
<span class="token comment">#错误代码： 1048</span>
<span class="token comment">#Column 'email' cannot be null</span>
<span class="token keyword">CALL</span> UpdateDataNoCondition<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token variable">@x</span><span class="token punctuation">;</span>




<span class="token comment">#错误处理</span>
<span class="token comment">#处理方式：处理方式有3个取值：CONTINUE、EXIT、UNDO。</span>
<span class="token comment">#CONTINUE ：表示遇到错误不处理，继续执行。</span>
<span class="token comment">#EXIT ：表示遇到错误马上退出。</span>
<span class="token comment">#UNDO ：表示遇到错误后撤回之前的操作。MySQL中暂时不支持这样的操作。错误类型（即条件）可以有如下取值：</span>
<span class="token comment">#SQLSTATE '字符串错误码' ：表示长度为5的sqlstate_value类型的错误代码；</span>
<span class="token comment">#MySQL_error_code ：匹配数值类型错误代码；</span>
<span class="token comment">#错误名称 ：表示DECLARE ... CONDITION定义的错误条件名称。</span>
<span class="token comment">#SQLWARNING ：匹配所有以01开头的SQLSTATE错误代码；</span>
<span class="token comment">#NOT FOUND ：匹配所有以02开头的SQLSTATE错误代码；</span>
<span class="token comment">#SQLEXCEPTION ：匹配所有没有被SQLWARNING或NOT FOUND捕获的SQLSTATE错误代码；</span>
<span class="token comment">#处理语句：如果出现上述条件之一，则采用对应的处理方式，并执行指定的处理语句。语句可以是</span>
<span class="token comment">#像“ SET 变量 = 值 ”这样的简单语句，也可以是使用 BEGIN ... END 编写的复合语句。</span>

<span class="token comment">#2.2 定义条件</span>
<span class="token comment">#格式：DECLARE 错误名称 CONDITION FOR 错误码（或错误条件）</span>

<span class="token comment">#举例1：定义“Field_Not_Be_NULL”错误名与MySQL中违反非空约束的错误类型</span>
<span class="token comment">#是“ERROR 1048 (23000)”对应。</span>
<span class="token comment">#方式1：使用MySQL_error_code</span>
<span class="token keyword">DECLARE</span> Field_Not_Be_NULL CONDITION <span class="token keyword">FOR</span> <span class="token number">1048</span><span class="token punctuation">;</span>

<span class="token comment">#方式2：使用sqlstate_value</span>
<span class="token keyword">DECLARE</span> Field_Not_Be_NULL CONDITION <span class="token keyword">FOR</span> SQLSTATE <span class="token string">'23000'</span><span class="token punctuation">;</span>

<span class="token comment">#举例2：定义"ERROR 1148(42000)"错误，名称为command_not_allowed。</span>
<span class="token comment">#方式1：使用MySQL_error_code</span>
<span class="token keyword">DECLARE</span> command_not_allowed CONDITION <span class="token keyword">FOR</span> <span class="token number">1148</span><span class="token punctuation">;</span>

<span class="token comment">#方式2：使用sqlstate_value</span>
<span class="token keyword">DECLARE</span> command_not_allowed CONDITION <span class="token keyword">FOR</span> SQLSTATE <span class="token string">'42000'</span><span class="token punctuation">;</span>

<span class="token comment">#2.3 定义处理程序</span>
<span class="token comment">#格式：DECLARE 处理方式 HANDLER FOR 错误类型 处理语句</span>

<span class="token comment">#举例：</span>
<span class="token comment">#方法1：捕获sqlstate_value</span>
<span class="token keyword">DECLARE</span> <span class="token keyword">CONTINUE</span> <span class="token keyword">HANDLER</span> <span class="token keyword">FOR</span> SQLSTATE <span class="token string">'42S02'</span> <span class="token keyword">SET</span> <span class="token variable">@info</span> <span class="token operator">=</span> <span class="token string">'NO_SUCH_TABLE'</span><span class="token punctuation">;</span>

<span class="token comment">#方法2：捕获mysql_error_value</span>
<span class="token keyword">DECLARE</span> <span class="token keyword">CONTINUE</span> <span class="token keyword">HANDLER</span> <span class="token keyword">FOR</span> <span class="token number">1146</span> <span class="token keyword">SET</span> <span class="token variable">@info</span> <span class="token operator">=</span> <span class="token string">'NO_SUCH_TABLE'</span><span class="token punctuation">;</span>

<span class="token comment">#方法3：先定义条件，再调用</span>
<span class="token keyword">DECLARE</span> no_such_table CONDITION <span class="token keyword">FOR</span> <span class="token number">1146</span><span class="token punctuation">;</span>
<span class="token keyword">DECLARE</span> <span class="token keyword">CONTINUE</span> <span class="token keyword">HANDLER</span> <span class="token keyword">FOR</span> no_such_table <span class="token keyword">SET</span> <span class="token variable">@info</span> <span class="token operator">=</span> <span class="token string">'NO_SUCH_TABLE'</span><span class="token punctuation">;</span>

<span class="token comment">#方法4：使用SQLWARNING</span>
<span class="token keyword">DECLARE</span> <span class="token keyword">EXIT</span> <span class="token keyword">HANDLER</span> <span class="token keyword">FOR</span> SQLWARNING <span class="token keyword">SET</span> <span class="token variable">@info</span> <span class="token operator">=</span> <span class="token string">'ERROR'</span><span class="token punctuation">;</span>

<span class="token comment">#方法5：使用NOT FOUND</span>
<span class="token keyword">DECLARE</span> <span class="token keyword">EXIT</span> <span class="token keyword">HANDLER</span> <span class="token keyword">FOR</span> <span class="token operator">NOT</span> FOUND <span class="token keyword">SET</span> <span class="token variable">@info</span> <span class="token operator">=</span> <span class="token string">'NO_SUCH_TABLE'</span><span class="token punctuation">;</span>

<span class="token comment">#方法6：使用SQLEXCEPTION</span>
<span class="token keyword">DECLARE</span> <span class="token keyword">EXIT</span> <span class="token keyword">HANDLER</span> <span class="token keyword">FOR</span> SQLEXCEPTION <span class="token keyword">SET</span> <span class="token variable">@info</span> <span class="token operator">=</span> <span class="token string">'ERROR'</span><span class="token punctuation">;</span>

<span class="token comment">#2.4 案例的处理</span>

<span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> UpdateDataNoCondition<span class="token punctuation">;</span>

<span class="token comment">#重新定义存储过程，体现错误的处理程序</span>
<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> UpdateDataNoCondition<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">BEGIN</span>
		<span class="token comment">#声明处理程序</span>
		<span class="token comment">#处理方式1：</span>
		<span class="token keyword">DECLARE</span> <span class="token keyword">CONTINUE</span> <span class="token keyword">HANDLER</span> <span class="token keyword">FOR</span> <span class="token number">1048</span> <span class="token keyword">SET</span> <span class="token variable">@prc_value</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token comment">#处理方式2：</span>
		<span class="token comment">#DECLARE CONTINUE HANDLER FOR sqlstate '23000' SET @prc_value = -1;</span>
		
		<span class="token keyword">SET</span> <span class="token variable">@x</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> email <span class="token operator">=</span> <span class="token boolean">NULL</span> <span class="token keyword">WHERE</span> last_name <span class="token operator">=</span> <span class="token string">'Abel'</span><span class="token punctuation">;</span>
		<span class="token keyword">SET</span> <span class="token variable">@x</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
		<span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> email <span class="token operator">=</span> <span class="token string">'aabbel'</span> <span class="token keyword">WHERE</span> last_name <span class="token operator">=</span> <span class="token string">'Abel'</span><span class="token punctuation">;</span>
		<span class="token keyword">SET</span> <span class="token variable">@x</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
	<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用存储过程：</span>
<span class="token keyword">CALL</span> UpdateDataNoCondition<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#查看变量：</span>
<span class="token keyword">SELECT</span> <span class="token variable">@x</span><span class="token punctuation">,</span><span class="token variable">@prc_value</span><span class="token punctuation">;</span>

<span class="token comment">#2.5 再举一个例子：</span>
<span class="token comment">#创建一个名称为“InsertDataWithCondition”的存储过程</span>

<span class="token comment">#① 准备工作</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> departments
<span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> atguigudb<span class="token punctuation">.</span><span class="token punctuation">`</span>departments<span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token keyword">DESC</span> departments<span class="token punctuation">;</span>

<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> departments
<span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> uk_dept_name <span class="token keyword">UNIQUE</span><span class="token punctuation">(</span>department_id<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#② 定义存储过程：</span>
<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> InsertDataWithCondition<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">BEGIN</span>		
		<span class="token keyword">SET</span> <span class="token variable">@x</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> departments<span class="token punctuation">(</span>department_name<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'测试'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">SET</span> <span class="token variable">@x</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
		<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> departments<span class="token punctuation">(</span>department_name<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'测试'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">SET</span> <span class="token variable">@x</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
	<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#③ 调用</span>
<span class="token keyword">CALL</span> InsertDataWithCondition<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token variable">@x</span><span class="token punctuation">;</span>  <span class="token comment">#2</span>

<span class="token comment">#④ 删除此存储过程</span>
<span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> InsertDataWithCondition<span class="token punctuation">;</span>

<span class="token comment">#⑤ 重新定义存储过程（考虑到错误的处理程序）</span>

<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> InsertDataWithCondition<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">BEGIN</span>		
		
		<span class="token comment">#处理程序</span>
		<span class="token comment">#方式1：</span>
		<span class="token comment">#declare exit handler for 1062 set @pro_value = -1;</span>
		<span class="token comment">#方式2：</span>
		<span class="token comment">#declare exit handler for sqlstate '23000' set @pro_value = -1;</span>
		<span class="token comment">#方式3：</span>
		<span class="token comment">#定义条件</span>
		<span class="token keyword">DECLARE</span> duplicate_entry CONDITION <span class="token keyword">FOR</span> <span class="token number">1062</span><span class="token punctuation">;</span>
		<span class="token keyword">DECLARE</span> <span class="token keyword">EXIT</span> <span class="token keyword">HANDLER</span> <span class="token keyword">FOR</span> duplicate_entry <span class="token keyword">SET</span> <span class="token variable">@pro_value</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
		
		<span class="token keyword">SET</span> <span class="token variable">@x</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> departments<span class="token punctuation">(</span>department_name<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'测试'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">SET</span> <span class="token variable">@x</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
		<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> departments<span class="token punctuation">(</span>department_name<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'测试'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">SET</span> <span class="token variable">@x</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
	<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用</span>
<span class="token keyword">CALL</span> InsertDataWithCondition<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token variable">@x</span><span class="token punctuation">,</span><span class="token variable">@pro_value</span><span class="token punctuation">;</span>

<span class="token comment">#3. 流程控制</span>
<span class="token comment">#3.1 分支结构之 IF</span>

<span class="token comment">#举例1</span>

<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> test_if<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">BEGIN</span>	
	<span class="token comment">#情况1：</span>
	<span class="token comment">#声明局部变量</span>
	<span class="token comment">#declare stu_name varchar(15);</span>
	
	<span class="token comment">#if stu_name is null </span>
	<span class="token comment">#	then select 'stu_name is null';</span>
	<span class="token comment">#end if;</span>
	
	<span class="token comment">#情况2：二选一</span>
	<span class="token comment">#declare email varchar(25) default 'aaa';</span>
	
	<span class="token comment">#if email is null</span>
	<span class="token comment">#	then select 'email is null';</span>
	<span class="token comment">#else</span>
	<span class="token comment">#	select 'email is not null';</span>
	<span class="token comment">#end if;</span>
	
	<span class="token comment">#情况3：多选一</span>
	<span class="token keyword">DECLARE</span> age <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">20</span><span class="token punctuation">;</span>
	
	<span class="token keyword">IF</span> age <span class="token operator">&gt;</span> <span class="token number">40</span>
		<span class="token keyword">THEN</span> <span class="token keyword">SELECT</span> <span class="token string">'中老年'</span><span class="token punctuation">;</span>
	<span class="token keyword">ELSEIF</span> age <span class="token operator">&gt;</span> <span class="token number">18</span>
		<span class="token keyword">THEN</span> <span class="token keyword">SELECT</span> <span class="token string">'青壮年'</span><span class="token punctuation">;</span>
	<span class="token keyword">ELSEIF</span> age <span class="token operator">&gt;</span> <span class="token number">8</span>
		<span class="token keyword">THEN</span> <span class="token keyword">SELECT</span> <span class="token string">'青少年'</span><span class="token punctuation">;</span>
	<span class="token keyword">ELSE</span>
		<span class="token keyword">SELECT</span> <span class="token string">'婴幼儿'</span><span class="token punctuation">;</span>
	<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
	

<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用</span>
<span class="token keyword">CALL</span> test_if<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> test_if<span class="token punctuation">;</span>

<span class="token comment">#举例2：声明存储过程“update_salary_by_eid1”，定义IN参数emp_id，输入员工编号。</span>
<span class="token comment">#判断该员工薪资如果低于8000元并且入职时间超过5年，就涨薪500元；否则就不变。</span>

<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> update_salary_by_eid1<span class="token punctuation">(</span><span class="token operator">IN</span> emp_id <span class="token keyword">INT</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token comment">#声明局部变量</span>
	<span class="token keyword">DECLARE</span> emp_sal <span class="token keyword">DOUBLE</span><span class="token punctuation">;</span> <span class="token comment">#记录员工的工资</span>
	<span class="token keyword">DECLARE</span> hire_year <span class="token keyword">DOUBLE</span><span class="token punctuation">;</span> <span class="token comment">#记录员工入职公司的年头</span>
	
	
	<span class="token comment">#赋值</span>
	<span class="token keyword">SELECT</span> salary <span class="token keyword">INTO</span> emp_sal <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> emp_id<span class="token punctuation">;</span>
	
	<span class="token keyword">SELECT</span> DATEDIFF<span class="token punctuation">(</span>CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>hire_date<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">365</span> <span class="token keyword">INTO</span> hire_year <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> emp_id<span class="token punctuation">;</span>
	
	<span class="token comment">#判断</span>
	<span class="token keyword">IF</span> emp_sal <span class="token operator">&lt;</span> <span class="token number">8000</span> <span class="token operator">AND</span> hire_year <span class="token operator">&gt;=</span> <span class="token number">5</span>
		<span class="token keyword">THEN</span> <span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> salary <span class="token operator">=</span> salary <span class="token operator">+</span> <span class="token number">500</span> <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> emp_id<span class="token punctuation">;</span>
	<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用存储过程</span>
<span class="token keyword">CALL</span> update_salary_by_eid1<span class="token punctuation">(</span><span class="token number">104</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> DATEDIFF<span class="token punctuation">(</span>CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>hire_date<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">365</span><span class="token punctuation">,</span> employee_id<span class="token punctuation">,</span>salary
<span class="token keyword">FROM</span> employees
<span class="token keyword">WHERE</span> salary <span class="token operator">&lt;</span> <span class="token number">8000</span> <span class="token operator">AND</span> DATEDIFF<span class="token punctuation">(</span>CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>hire_date<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">365</span> <span class="token operator">&gt;=</span> <span class="token number">5</span><span class="token punctuation">;</span>

<span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> update_salary_by_eid1<span class="token punctuation">;</span>


<span class="token comment">#举例3：声明存储过程“update_salary_by_eid2”，定义IN参数emp_id，输入员工编号。</span>
<span class="token comment">#判断该员工薪资如果低于9000元并且入职时间超过5年，就涨薪500元；否则就涨薪100元。</span>

<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> update_salary_by_eid2<span class="token punctuation">(</span><span class="token operator">IN</span> emp_id <span class="token keyword">INT</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token comment">#声明局部变量</span>
	<span class="token keyword">DECLARE</span> emp_sal <span class="token keyword">DOUBLE</span><span class="token punctuation">;</span> <span class="token comment">#记录员工的工资</span>
	<span class="token keyword">DECLARE</span> hire_year <span class="token keyword">DOUBLE</span><span class="token punctuation">;</span> <span class="token comment">#记录员工入职公司的年头</span>
	
	
	<span class="token comment">#赋值</span>
	<span class="token keyword">SELECT</span> salary <span class="token keyword">INTO</span> emp_sal <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> emp_id<span class="token punctuation">;</span>
	
	<span class="token keyword">SELECT</span> DATEDIFF<span class="token punctuation">(</span>CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>hire_date<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">365</span> <span class="token keyword">INTO</span> hire_year <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> emp_id<span class="token punctuation">;</span>
	
	<span class="token comment">#判断</span>
	<span class="token keyword">IF</span> emp_sal <span class="token operator">&lt;</span> <span class="token number">9000</span> <span class="token operator">AND</span> hire_year <span class="token operator">&gt;=</span> <span class="token number">5</span>
		<span class="token keyword">THEN</span> <span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> salary <span class="token operator">=</span> salary <span class="token operator">+</span> <span class="token number">500</span> <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> emp_id<span class="token punctuation">;</span>
	<span class="token keyword">ELSE</span>
		<span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> salary <span class="token operator">=</span> salary <span class="token operator">+</span> <span class="token number">100</span> <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> emp_id<span class="token punctuation">;</span>
	<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用</span>
<span class="token keyword">CALL</span> update_salary_by_eid2<span class="token punctuation">(</span><span class="token number">103</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">CALL</span> update_salary_by_eid2<span class="token punctuation">(</span><span class="token number">104</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees
<span class="token keyword">WHERE</span> employee_id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">103</span><span class="token punctuation">,</span><span class="token number">104</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">#举例4：声明存储过程“update_salary_by_eid3”，定义IN参数emp_id，输入员工编号。</span>
<span class="token comment">#判断该员工薪资如果低于9000元，就更新薪资为9000元；薪资如果大于等于9000元且</span>
<span class="token comment">#低于10000的，但是奖金比例为NULL的，就更新奖金比例为0.01；其他的涨薪100元。</span>

<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> update_salary_by_eid3<span class="token punctuation">(</span><span class="token operator">IN</span> emp_id <span class="token keyword">INT</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token comment">#声明变量</span>
	<span class="token keyword">DECLARE</span> emp_sal <span class="token keyword">DOUBLE</span><span class="token punctuation">;</span> <span class="token comment">#记录员工工资</span>
	<span class="token keyword">DECLARE</span> bonus <span class="token keyword">DOUBLE</span><span class="token punctuation">;</span> <span class="token comment">#记录员工的奖金率</span>
	
	<span class="token comment">#赋值</span>
	<span class="token keyword">SELECT</span> salary <span class="token keyword">INTO</span> emp_sal <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> emp_id<span class="token punctuation">;</span>
	<span class="token keyword">SELECT</span> commission_pct <span class="token keyword">INTO</span> bonus <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> emp_id<span class="token punctuation">;</span>
	
	
	<span class="token comment">#判断</span>
	<span class="token keyword">IF</span> emp_sal <span class="token operator">&lt;</span> <span class="token number">9000</span> 
		<span class="token keyword">THEN</span> <span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> salary <span class="token operator">=</span> <span class="token number">9000</span> <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> emp_id<span class="token punctuation">;</span>
	<span class="token keyword">ELSEIF</span> emp_sal <span class="token operator">&lt;</span> <span class="token number">10000</span> <span class="token operator">AND</span> bonus <span class="token operator">IS</span> <span class="token boolean">NULL</span>
		<span class="token keyword">THEN</span> <span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> commission_pct <span class="token operator">=</span> <span class="token number">0.01</span> <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> emp_id<span class="token punctuation">;</span>
	<span class="token keyword">ELSE</span> 
		<span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> salary <span class="token operator">=</span> salary <span class="token operator">+</span> <span class="token number">100</span> <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> emp_id<span class="token punctuation">;</span>
	<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>

<span class="token keyword">END</span> <span class="token comment">//</span>


<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用</span>
<span class="token keyword">CALL</span> update_salary_by_eid3<span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">CALL</span> update_salary_by_eid3<span class="token punctuation">(</span><span class="token number">103</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">CALL</span> update_salary_by_eid3<span class="token punctuation">(</span><span class="token number">104</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> employees
<span class="token keyword">WHERE</span> employee_id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token number">103</span><span class="token punctuation">,</span><span class="token number">104</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">##3.2 分支结构之case</span>

<span class="token comment">#举例1:基本使用</span>
<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> test_case<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token comment">#演示1：case ... when ...then ...</span>
	<span class="token comment">/*
	declare var int default 2;
	
	case var
		when 1 then select 'var = 1';
		when 2 then select 'var = 2';
		when 3 then select 'var = 3';
		else select 'other value';
	end case;
	*/</span>
	<span class="token comment">#演示2：case when ... then ....</span>
	<span class="token keyword">DECLARE</span> var1 <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">10</span><span class="token punctuation">;</span>
	<span class="token keyword">CASE</span> 
	<span class="token keyword">WHEN</span> var1 <span class="token operator">&gt;=</span> <span class="token number">100</span> <span class="token keyword">THEN</span> <span class="token keyword">SELECT</span> <span class="token string">'三位数'</span><span class="token punctuation">;</span>
	<span class="token keyword">WHEN</span> var1 <span class="token operator">&gt;=</span> <span class="token number">10</span> <span class="token keyword">THEN</span> <span class="token keyword">SELECT</span> <span class="token string">'两位数'</span><span class="token punctuation">;</span>
	<span class="token keyword">ELSE</span> <span class="token keyword">SELECT</span> <span class="token string">'个数位'</span><span class="token punctuation">;</span>
	<span class="token keyword">END</span> <span class="token keyword">CASE</span><span class="token punctuation">;</span>

<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用</span>
<span class="token keyword">CALL</span> test_case<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> test_case<span class="token punctuation">;</span>

<span class="token comment">#举例2：声明存储过程“update_salary_by_eid4”，定义IN参数emp_id，输入员工编号。</span>
<span class="token comment">#判断该员工薪资如果低于9000元，就更新薪资为9000元；薪资大于等于9000元且低于10000的，</span>
<span class="token comment">#但是奖金比例为NULL的，就更新奖金比例为0.01；其他的涨薪100元。</span>

<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> update_salary_by_eid4<span class="token punctuation">(</span><span class="token operator">IN</span> emp_id <span class="token keyword">INT</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token comment">#局部变量的声明</span>
	<span class="token keyword">DECLARE</span> emp_sal <span class="token keyword">DOUBLE</span><span class="token punctuation">;</span> <span class="token comment">#记录员工的工资</span>
	<span class="token keyword">DECLARE</span> bonus <span class="token keyword">DOUBLE</span><span class="token punctuation">;</span> <span class="token comment">#记录员工的奖金率</span>
	
	<span class="token comment">#局部变量的赋值</span>
	<span class="token keyword">SELECT</span> salary <span class="token keyword">INTO</span> emp_sal <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> emp_id<span class="token punctuation">;</span>
	<span class="token keyword">SELECT</span> commission_pct <span class="token keyword">INTO</span> bonus <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> emp_id<span class="token punctuation">;</span>
	
	<span class="token keyword">CASE</span>
	<span class="token keyword">WHEN</span> emp_sal <span class="token operator">&lt;</span> <span class="token number">9000</span> <span class="token keyword">THEN</span> <span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> salary <span class="token operator">=</span> <span class="token number">9000</span> <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> emp_id<span class="token punctuation">;</span>
	<span class="token keyword">WHEN</span> emp_sal <span class="token operator">&lt;</span> <span class="token number">10000</span> <span class="token operator">AND</span> bonus <span class="token operator">IS</span> <span class="token boolean">NULL</span> <span class="token keyword">THEN</span> <span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> commission_pct <span class="token operator">=</span> <span class="token number">0.01</span> 
						    <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> emp_id<span class="token punctuation">;</span>
	<span class="token keyword">ELSE</span> <span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> salary <span class="token operator">=</span> salary <span class="token operator">+</span> <span class="token number">100</span> <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> emp_id<span class="token punctuation">;</span>
	<span class="token keyword">END</span> <span class="token keyword">CASE</span><span class="token punctuation">;</span>
	

<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用</span>
<span class="token keyword">CALL</span> update_salary_by_eid4<span class="token punctuation">(</span><span class="token number">103</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">CALL</span> update_salary_by_eid4<span class="token punctuation">(</span><span class="token number">104</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">CALL</span> update_salary_by_eid4<span class="token punctuation">(</span><span class="token number">105</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> employees
<span class="token keyword">WHERE</span> employee_id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">103</span><span class="token punctuation">,</span><span class="token number">104</span><span class="token punctuation">,</span><span class="token number">105</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#举例3：声明存储过程update_salary_by_eid5，定义IN参数emp_id，输入员工编号。</span>
<span class="token comment">#判断该员工的入职年限，如果是0年，薪资涨50；如果是1年，薪资涨100；</span>
<span class="token comment">#如果是2年，薪资涨200；如果是3年，薪资涨300；如果是4年，薪资涨400；其他的涨薪500。</span>

<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> update_salary_by_eid5<span class="token punctuation">(</span><span class="token operator">IN</span> emp_id <span class="token keyword">INT</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token comment">#声明局部变量</span>
	<span class="token keyword">DECLARE</span> hire_year <span class="token keyword">INT</span><span class="token punctuation">;</span> <span class="token comment">#记录员工入职公司的总时间（单位：年）</span>
	
	<span class="token comment">#赋值</span>
	<span class="token keyword">SELECT</span> <span class="token function">ROUND</span><span class="token punctuation">(</span>DATEDIFF<span class="token punctuation">(</span>CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>hire_date<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">365</span><span class="token punctuation">)</span> <span class="token keyword">INTO</span> hire_year 
	<span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> emp_id<span class="token punctuation">;</span>
	
	<span class="token comment">#判断</span>
	<span class="token keyword">CASE</span> hire_year
		<span class="token keyword">WHEN</span> <span class="token number">0</span> <span class="token keyword">THEN</span> <span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> salary <span class="token operator">=</span> salary <span class="token operator">+</span> <span class="token number">50</span> <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> emp_id<span class="token punctuation">;</span>
		<span class="token keyword">WHEN</span> <span class="token number">1</span> <span class="token keyword">THEN</span> <span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> salary <span class="token operator">=</span> salary <span class="token operator">+</span> <span class="token number">100</span> <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> emp_id<span class="token punctuation">;</span>
		<span class="token keyword">WHEN</span> <span class="token number">2</span> <span class="token keyword">THEN</span> <span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> salary <span class="token operator">=</span> salary <span class="token operator">+</span> <span class="token number">200</span> <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> emp_id<span class="token punctuation">;</span>
		<span class="token keyword">WHEN</span> <span class="token number">3</span> <span class="token keyword">THEN</span> <span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> salary <span class="token operator">=</span> salary <span class="token operator">+</span> <span class="token number">300</span> <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> emp_id<span class="token punctuation">;</span>
		<span class="token keyword">WHEN</span> <span class="token number">4</span> <span class="token keyword">THEN</span> <span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> salary <span class="token operator">=</span> salary <span class="token operator">+</span> <span class="token number">400</span> <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> emp_id<span class="token punctuation">;</span>
		<span class="token keyword">ELSE</span> <span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> salary <span class="token operator">=</span> salary <span class="token operator">+</span> <span class="token number">500</span> <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> emp_id<span class="token punctuation">;</span>
	<span class="token keyword">END</span> <span class="token keyword">CASE</span><span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用</span>
<span class="token keyword">CALL</span> update_salary_by_eid5<span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> employees

<span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> update_salary_by_eid5<span class="token punctuation">;</span>


<span class="token comment">#4.1 循环结构之LOOP</span>
<span class="token comment">/*
[loop_label:] LOOP
	循环执行的语句
END LOOP [loop_label]


*/</span>
<span class="token comment">#举例1：</span>

<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> test_loop<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token comment">#声明局部变量</span>
	<span class="token keyword">DECLARE</span> num <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">1</span><span class="token punctuation">;</span>
	
	loop_label:<span class="token keyword">LOOP</span>
		<span class="token comment">#重新赋值</span>
		<span class="token keyword">SET</span> num <span class="token operator">=</span> num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
		
		<span class="token comment">#可以考虑某个代码程序反复执行。（略）</span>
		
		<span class="token keyword">IF</span> num <span class="token operator">&gt;=</span> <span class="token number">10</span> <span class="token keyword">THEN</span> <span class="token keyword">LEAVE</span> loop_label<span class="token punctuation">;</span>
		<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
	<span class="token keyword">END</span> <span class="token keyword">LOOP</span> loop_label<span class="token punctuation">;</span>
	
	<span class="token comment">#查看num</span>
	<span class="token keyword">SELECT</span> num<span class="token punctuation">;</span>

<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用</span>
<span class="token keyword">CALL</span> test_loop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">#举例2：当市场环境变好时，公司为了奖励大家，决定给大家涨工资。</span>
<span class="token comment">#声明存储过程“update_salary_loop()”，声明OUT参数num，输出循环次数。</span>
<span class="token comment">#存储过程中实现循环给大家涨薪，薪资涨为原来的1.1倍。直到全公司的平</span>
<span class="token comment">#均薪资达到12000结束。并统计循环次数。</span>


<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> update_salary_loop<span class="token punctuation">(</span><span class="token keyword">OUT</span> num <span class="token keyword">INT</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token comment">#声明变量</span>
	<span class="token keyword">DECLARE</span> avg_sal <span class="token keyword">DOUBLE</span> <span class="token punctuation">;</span> <span class="token comment">#记录员工的平均工资</span>
	
	<span class="token keyword">DECLARE</span> loop_count <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">#记录循环的次数</span>
	
	<span class="token comment">#① 初始化条件</span>
	<span class="token comment">#获取员工的平均工资</span>
	<span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">INTO</span> avg_sal <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
	
	loop_lab:<span class="token keyword">LOOP</span>
		<span class="token comment">#② 循环条件</span>
		<span class="token comment">#结束循环的条件</span>
		<span class="token keyword">IF</span> avg_sal <span class="token operator">&gt;=</span> <span class="token number">12000</span>
			<span class="token keyword">THEN</span> <span class="token keyword">LEAVE</span> loop_lab<span class="token punctuation">;</span>
		<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
		
		<span class="token comment">#③ 循环体</span>
		<span class="token comment">#如果低于12000，更新员工的工资</span>
		<span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> salary <span class="token operator">=</span> salary <span class="token operator">*</span> <span class="token number">1.1</span><span class="token punctuation">;</span>
		
		<span class="token comment">#④ 迭代条件</span>
		<span class="token comment">#更新avg_sal变量的值</span>
		<span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">INTO</span> avg_sal <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
		
		<span class="token comment">#记录循环次数</span>
		<span class="token keyword">SET</span> loop_count <span class="token operator">=</span> loop_count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
		
	<span class="token keyword">END</span> <span class="token keyword">LOOP</span> loop_lab<span class="token punctuation">;</span>
			
	<span class="token comment">#给num赋值</span>
	<span class="token keyword">SET</span> num <span class="token operator">=</span> loop_count<span class="token punctuation">;</span>	

<span class="token keyword">END</span> <span class="token comment">//</span>


<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>

<span class="token keyword">CALL</span> update_salary_loop<span class="token punctuation">(</span><span class="token variable">@num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token variable">@num</span><span class="token punctuation">;</span>


<span class="token comment">#4.2 循环结构之WHILE</span>
<span class="token comment">/*
[while_label:] WHILE 循环条件  DO
	循环体
END WHILE [while_label];

*/</span>
<span class="token comment">#举例1：</span>
<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> test_while<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">BEGIN</span>	
	<span class="token comment">#初始化条件</span>
	<span class="token keyword">DECLARE</span> num <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token comment">#循环条件</span>
	<span class="token keyword">WHILE</span> num <span class="token operator">&lt;=</span> <span class="token number">10</span> <span class="token keyword">DO</span>
		<span class="token comment">#循环体（略）</span>
		
		<span class="token comment">#迭代条件</span>
		<span class="token keyword">SET</span> num <span class="token operator">=</span> num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">END</span> <span class="token keyword">WHILE</span><span class="token punctuation">;</span>
	
	<span class="token comment">#查询</span>
	<span class="token keyword">SELECT</span> num<span class="token punctuation">;</span>

<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用</span>
<span class="token keyword">CALL</span> test_while<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#举例2：市场环境不好时，公司为了渡过难关，决定暂时降低大家的薪资。</span>
<span class="token comment">#声明存储过程“update_salary_while()”，声明OUT参数num，输出循环次数。</span>
<span class="token comment">#存储过程中实现循环给大家降薪，薪资降为原来的90%。直到全公司的平均薪资</span>
<span class="token comment">#达到5000结束。并统计循环次数。</span>

<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> update_salary_while<span class="token punctuation">(</span><span class="token keyword">OUT</span> num <span class="token keyword">INT</span><span class="token punctuation">)</span>

<span class="token keyword">BEGIN</span>
	<span class="token comment">#声明变量</span>
	<span class="token keyword">DECLARE</span> avg_sal <span class="token keyword">DOUBLE</span> <span class="token punctuation">;</span> <span class="token comment">#记录平均工资</span>
	<span class="token keyword">DECLARE</span> while_count <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">#记录循环次数</span>
	
	<span class="token comment">#赋值</span>
	<span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">INTO</span> avg_sal <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
	
	<span class="token keyword">WHILE</span> avg_sal <span class="token operator">&gt;</span> <span class="token number">5000</span> <span class="token keyword">DO</span>
		<span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> salary <span class="token operator">=</span> salary <span class="token operator">*</span> <span class="token number">0.9</span> <span class="token punctuation">;</span>
		<span class="token keyword">SET</span> while_count <span class="token operator">=</span> while_count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
		
		<span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">INTO</span> avg_sal <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
		
	<span class="token keyword">END</span> <span class="token keyword">WHILE</span><span class="token punctuation">;</span>
	
	<span class="token comment">#给num赋值</span>
	<span class="token keyword">SET</span> num <span class="token operator">=</span> while_count<span class="token punctuation">;</span>		
		

<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用</span>
<span class="token keyword">CALL</span> update_salary_while<span class="token punctuation">(</span><span class="token variable">@num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token variable">@num</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>

<span class="token comment">#4.3 循环结构之REPEAT</span>

<span class="token comment">/*
[repeat_label:] REPEAT
　　　　循环体的语句
UNTIL 结束循环的条件表达式
END REPEAT [repeat_label]

*/</span>

<span class="token comment">#举例1：</span>

<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> test_repeat<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
	<span class="token comment">#声明变量</span>
	<span class="token keyword">DECLARE</span> num <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">1</span><span class="token punctuation">;</span>
	
	<span class="token keyword">REPEAT</span>
		<span class="token keyword">SET</span> num <span class="token operator">=</span> num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
		UNTIL num <span class="token operator">&gt;=</span> <span class="token number">10</span>
	<span class="token keyword">END</span> <span class="token keyword">REPEAT</span><span class="token punctuation">;</span>
	
	<span class="token comment">#查看</span>
	<span class="token keyword">SELECT</span> num<span class="token punctuation">;</span>

<span class="token keyword">END</span> <span class="token comment">//</span>


<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用</span>
<span class="token keyword">CALL</span> test_repeat<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#举例2：当市场环境变好时，公司为了奖励大家，决定给大家涨工资。</span>
<span class="token comment">#声明存储过程“update_salary_repeat()”，声明OUT参数num，输出循环次数。</span>
<span class="token comment">#存储过程中实现循环给大家涨薪，薪资涨为原来的1.15倍。直到全公司的平均</span>
<span class="token comment">#薪资达到13000结束。并统计循环次数。</span>


<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> update_salary_repeat<span class="token punctuation">(</span><span class="token keyword">OUT</span> num <span class="token keyword">INT</span><span class="token punctuation">)</span>

<span class="token keyword">BEGIN</span>
	<span class="token comment">#声明变量</span>
	<span class="token keyword">DECLARE</span> avg_sal <span class="token keyword">DOUBLE</span> <span class="token punctuation">;</span> <span class="token comment">#记录平均工资</span>
	<span class="token keyword">DECLARE</span> repeat_count <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">#记录循环次数</span>
	
	<span class="token comment">#赋值</span>
	<span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">INTO</span> avg_sal <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
	
	<span class="token keyword">REPEAT</span>
		<span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> salary <span class="token operator">=</span> salary <span class="token operator">*</span> <span class="token number">1.15</span><span class="token punctuation">;</span>
		<span class="token keyword">SET</span> repeat_count <span class="token operator">=</span> repeat_count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
		
		<span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">INTO</span> avg_sal <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
		
		UNTIL avg_sal <span class="token operator">&gt;=</span> <span class="token number">13000</span>
	
	<span class="token keyword">END</span> <span class="token keyword">REPEAT</span><span class="token punctuation">;</span>
	
	<span class="token comment">#给num赋值</span>
	<span class="token keyword">SET</span> num <span class="token operator">=</span> repeat_count<span class="token punctuation">;</span>		
		

<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用</span>
<span class="token keyword">CALL</span> update_salary_repeat<span class="token punctuation">(</span><span class="token variable">@num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token variable">@num</span><span class="token punctuation">;</span>


<span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>


<span class="token comment">/*
凡是循环结构，一定具备4个要素：
1. 初始化条件
2. 循环条件
3. 循环体
4. 迭代条件

*/</span>

<span class="token comment">#5.1 LEAVE的使用</span>
<span class="token comment">/*
**举例1：**创建存储过程 “leave_begin()”，声明INT类型的IN参数num。给BEGIN...END加标记名，
并在BEGIN...END中使用IF语句判断num参数的值。

- 如果num&lt;=0，则使用LEAVE语句退出BEGIN...END；
- 如果num=1，则查询“employees”表的平均薪资；
- 如果num=2，则查询“employees”表的最低薪资；
- 如果num&gt;2，则查询“employees”表的最高薪资。

IF语句结束后查询“employees”表的总人数。

*/</span>

<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> leave_begin<span class="token punctuation">(</span><span class="token operator">IN</span> num <span class="token keyword">INT</span><span class="token punctuation">)</span>

begin_label:<span class="token keyword">BEGIN</span>
	<span class="token keyword">IF</span> num <span class="token operator">&lt;=</span> <span class="token number">0</span>
		<span class="token keyword">THEN</span> <span class="token keyword">LEAVE</span> begin_label<span class="token punctuation">;</span>
	<span class="token keyword">ELSEIF</span> num <span class="token operator">=</span> <span class="token number">1</span>
		<span class="token keyword">THEN</span> <span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
	<span class="token keyword">ELSEIF</span> num <span class="token operator">=</span> <span class="token number">2</span>
		<span class="token keyword">THEN</span> <span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
	<span class="token keyword">ELSE</span> 
		<span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
	<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
	
	<span class="token comment">#查询总人数</span>
	<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>

<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用</span>
<span class="token keyword">CALL</span> leave_begin<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">#举例2：当市场环境不好时，公司为了渡过难关，决定暂时降低大家的薪资。</span>
<span class="token comment">#声明存储过程“leave_while()”，声明OUT参数num，输出循环次数，存储过程中使用WHILE</span>
<span class="token comment">#循环给大家降低薪资为原来薪资的90%，直到全公司的平均薪资小于等于10000，并统计循环次数。</span>

<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> leave_while<span class="token punctuation">(</span><span class="token keyword">OUT</span> num <span class="token keyword">INT</span><span class="token punctuation">)</span>

<span class="token keyword">BEGIN</span> 
	<span class="token comment">#</span>
	<span class="token keyword">DECLARE</span> avg_sal <span class="token keyword">DOUBLE</span><span class="token punctuation">;</span><span class="token comment">#记录平均工资</span>
	<span class="token keyword">DECLARE</span> while_count <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">#记录循环次数</span>
	
	<span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">INTO</span> avg_sal <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span> <span class="token comment">#① 初始化条件</span>
	
	while_label:<span class="token keyword">WHILE</span> <span class="token boolean">TRUE</span> <span class="token keyword">DO</span>  <span class="token comment">#② 循环条件</span>
		
		<span class="token comment">#③ 循环体</span>
		<span class="token keyword">IF</span> avg_sal <span class="token operator">&lt;=</span> <span class="token number">10000</span> <span class="token keyword">THEN</span>
			<span class="token keyword">LEAVE</span> while_label<span class="token punctuation">;</span>
		<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
		
		<span class="token keyword">UPDATE</span> employees <span class="token keyword">SET</span> salary  <span class="token operator">=</span> salary <span class="token operator">*</span> <span class="token number">0.9</span><span class="token punctuation">;</span>
		<span class="token keyword">SET</span> while_count <span class="token operator">=</span> while_count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
		
		<span class="token comment">#④ 迭代条件</span>
		<span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">INTO</span> avg_sal <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
	
	<span class="token keyword">END</span> <span class="token keyword">WHILE</span><span class="token punctuation">;</span>
	
	<span class="token comment">#赋值</span>
	<span class="token keyword">SET</span> num <span class="token operator">=</span> while_count<span class="token punctuation">;</span>

<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用</span>
<span class="token keyword">CALL</span> leave_while<span class="token punctuation">(</span><span class="token variable">@num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token variable">@num</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>


<span class="token comment">#5.2 ITERATE的使用</span>
<span class="token comment">/*
举例： 定义局部变量num，初始值为0。循环结构中执行num + 1操作。

- 如果num &lt; 10，则继续执行循环；
- 如果num &gt; 15，则退出循环结构；

*/</span>

<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> test_iterate<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">BEGIN</span>
	<span class="token keyword">DECLARE</span> num <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span>
	
	loop_label:<span class="token keyword">LOOP</span>
		<span class="token comment">#赋值</span>
		<span class="token keyword">SET</span> num <span class="token operator">=</span> num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
		
		<span class="token keyword">IF</span> num  <span class="token operator">&lt;</span> <span class="token number">10</span>
			<span class="token keyword">THEN</span> <span class="token keyword">ITERATE</span> loop_label<span class="token punctuation">;</span>
		<span class="token keyword">ELSEIF</span> num <span class="token operator">&gt;</span> <span class="token number">15</span>
			<span class="token keyword">THEN</span> <span class="token keyword">LEAVE</span> loop_label<span class="token punctuation">;</span>
		<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
		
		<span class="token keyword">SELECT</span> <span class="token string">'啦啦啦啦啦啦！'</span><span class="token punctuation">;</span>
	
	<span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span>

<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token keyword">CALL</span> test_iterate<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>

<span class="token comment">#6. 游标的使用</span>
<span class="token comment">/*
游标使用的步骤：
① 声明游标
② 打开游标
③ 使用游标（从游标中获取数据）
④ 关闭游标


*/</span>

<span class="token comment">#举例：创建存储过程“get_count_by_limit_total_salary()”，声明IN参数 limit_total_salary，</span>
<span class="token comment">#DOUBLE类型；声明OUT参数total_count，INT类型。函数的功能可以实现累加薪资最高的几个员工的薪资值，</span>
<span class="token comment">#直到薪资总和达到limit_total_salary参数的值，返回累加的人数给total_count。</span>

<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> get_count_by_limit_total_salary<span class="token punctuation">(</span><span class="token operator">IN</span> limit_total_salary <span class="token keyword">DOUBLE</span><span class="token punctuation">,</span><span class="token keyword">OUT</span> total_count <span class="token keyword">INT</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>

	<span class="token comment">#声明局部变量</span>
	<span class="token keyword">DECLARE</span> sum_sal <span class="token keyword">DOUBLE</span> <span class="token keyword">DEFAULT</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">#记录累加的工资总额</span>
	<span class="token keyword">DECLARE</span> emp_sal <span class="token keyword">DOUBLE</span><span class="token punctuation">;</span> <span class="token comment">#记录每一个员工的工资</span>
	<span class="token keyword">DECLARE</span> emp_count <span class="token keyword">INT</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">#记录累加的人数</span>
	
	
	<span class="token comment">#1.声明游标</span>
	<span class="token keyword">DECLARE</span> emp_cursor <span class="token keyword">CURSOR</span> <span class="token keyword">FOR</span> <span class="token keyword">SELECT</span> salary <span class="token keyword">FROM</span> employees <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> salary <span class="token keyword">DESC</span><span class="token punctuation">;</span>
	
	<span class="token comment">#2.打开游标</span>
	<span class="token keyword">OPEN</span> emp_cursor<span class="token punctuation">;</span>
	
	<span class="token keyword">REPEAT</span>
		
		<span class="token comment">#3.使用游标</span>
		<span class="token keyword">FETCH</span> emp_cursor <span class="token keyword">INTO</span> emp_sal<span class="token punctuation">;</span>
		
		<span class="token keyword">SET</span> sum_sal <span class="token operator">=</span> sum_sal <span class="token operator">+</span> emp_sal<span class="token punctuation">;</span>
		<span class="token keyword">SET</span> emp_count <span class="token operator">=</span> emp_count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
		UNTIL sum_sal <span class="token operator">&gt;=</span> limit_total_salary
	<span class="token keyword">END</span> <span class="token keyword">REPEAT</span><span class="token punctuation">;</span>
	
	<span class="token keyword">SET</span> total_count <span class="token operator">=</span> emp_count<span class="token punctuation">;</span>
	
	<span class="token comment">#4.关闭游标</span>
	<span class="token keyword">CLOSE</span> emp_cursor<span class="token punctuation">;</span>
	
<span class="token keyword">END</span> <span class="token comment">//</span>


<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#调用</span>
<span class="token keyword">CALL</span> get_count_by_limit_total_salary<span class="token punctuation">(</span><span class="token number">200000</span><span class="token punctuation">,</span><span class="token variable">@total_count</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token variable">@total_count</span><span class="token punctuation">;</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在MySQL数据库中，全局变量可以通过SET GLOBAL语句来设置。例如，设置服务器语句超时的限制，可 以通过设置系统变量max_execution_time来实现： </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> MAX_EXECUTION_TIME<span class="token operator">=</span><span class="token number">2000</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>使用SET GLOBAL语句设置的变量值只会 临时生效 。 数据库重启 后，服务器又会从MySQL配置文件中读取 变量的默认值。 MySQL 8.0版本新增了 SET PERSIST 命令。例如，设置服务器的最大连接数为1000： </p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SET</span> PERSIST <span class="token keyword">global</span> max_connections <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>MySQL会将该命令的配置保存到数据目录下的 mysqld-auto.cnf 文件中，下次启动时会读取该文件，用 其中的配置来覆盖默认的配置文件。</p>
<p>查看全局变量max_connections的值</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'%max_connections%'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>设置全局变量max_connections的值：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">set</span> persist max_connections<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>重启MySQL服务器 ，再次查询max_connections的值：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'%max_connections%'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h3 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">
<span class="token comment">#0.准备工作</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> dbtest17<span class="token punctuation">;</span>

<span class="token keyword">USE</span> dbtest17<span class="token punctuation">;</span>

<span class="token comment">#1. 创建触发器</span>

<span class="token comment">#举例1：</span>
<span class="token comment">#① 创建数据表</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test_trigger <span class="token punctuation">(</span>
id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
t_note <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test_trigger_log <span class="token punctuation">(</span>
id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
t_log <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#② 查看表数据</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> test_trigger<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> test_trigger_log<span class="token punctuation">;</span>

<span class="token comment">#③ 创建触发器</span>
<span class="token comment">#创建名称为before_insert_test_tri的触发器，向test_trigger数据表插入数据之前，</span>
<span class="token comment">#向test_trigger_log数据表中插入before_insert的日志信息。</span>

<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> before_insert_test_tri
BEFORE <span class="token keyword">INSERT</span> <span class="token keyword">ON</span> test_trigger
<span class="token keyword">FOR EACH ROW</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_trigger_log<span class="token punctuation">(</span>t_log<span class="token punctuation">)</span>
	<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'before insert...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#④ 测试</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_trigger<span class="token punctuation">(</span>t_note<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'Tom...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> test_trigger<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> test_trigger_log<span class="token punctuation">;</span>


<span class="token comment">#举例2：</span>
<span class="token comment">#创建名称为after_insert_test_tri的触发器，向test_trigger数据表插入数据之后，</span>
<span class="token comment">#向test_trigger_log数据表中插入after_insert的日志信息。</span>

<span class="token keyword">DELIMITER</span> $

<span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> after_insert_test_tri
<span class="token keyword">AFTER</span> <span class="token keyword">INSERT</span> <span class="token keyword">ON</span> test_trigger
<span class="token keyword">FOR EACH ROW</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_trigger_log<span class="token punctuation">(</span>t_log<span class="token punctuation">)</span>
	<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'after insert...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span> $

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#测试</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> test_trigger<span class="token punctuation">(</span>t_note<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'Jerry2...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> test_trigger<span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> test_trigger_log<span class="token punctuation">;</span>

<span class="token comment">#举例3：</span>
<span class="token comment">#定义触发器“salary_check_trigger”，基于员工表“employees”的INSERT事件，</span>
<span class="token comment">#在INSERT之前检查将要添加的新员工薪资是否大于他领导的薪资，如果大于领导薪资，</span>
<span class="token comment">#则报sqlstate_value为'HY000'的错误，从而使得添加失败。</span>

<span class="token comment">#准备工作</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> employees
<span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> atguigudb<span class="token punctuation">.</span><span class="token punctuation">`</span>employees<span class="token punctuation">`</span><span class="token punctuation">;</span>


<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> departments
<span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> atguigudb<span class="token punctuation">.</span><span class="token punctuation">`</span>departments<span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token keyword">DESC</span> employees<span class="token punctuation">;</span>

<span class="token comment">#创建触发器</span>
<span class="token keyword">DELIMITER</span> <span class="token comment">//</span>

<span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> salary_check_trigger
BEFORE <span class="token keyword">INSERT</span> <span class="token keyword">ON</span> employees
<span class="token keyword">FOR EACH ROW</span>
<span class="token keyword">BEGIN</span>
	<span class="token comment">#查询到要添加的数据的manager的薪资</span>
	<span class="token keyword">DECLARE</span> mgr_sal <span class="token keyword">DOUBLE</span><span class="token punctuation">;</span>
	
	<span class="token keyword">SELECT</span> salary <span class="token keyword">INTO</span> mgr_sal <span class="token keyword">FROM</span> employees 
	<span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> NEW<span class="token punctuation">.</span>manager_id<span class="token punctuation">;</span>
	
	<span class="token keyword">IF</span> NEW<span class="token punctuation">.</span>salary <span class="token operator">&gt;</span> mgr_sal
		<span class="token keyword">THEN</span> SIGNAL SQLSTATE <span class="token string">'HY000'</span> <span class="token keyword">SET</span> MESSAGE_TEXT <span class="token operator">=</span> <span class="token string">'薪资高于领导薪资错误'</span><span class="token punctuation">;</span>
	<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>

<span class="token keyword">END</span> <span class="token comment">//</span>

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token comment">#测试</span>
<span class="token keyword">DESC</span> employees<span class="token punctuation">;</span>

<span class="token comment">#添加成功：依然触发了触发器salary_check_trigger的执行</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> employees<span class="token punctuation">(</span>employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>email<span class="token punctuation">,</span>hire_date<span class="token punctuation">,</span>job_id<span class="token punctuation">,</span>salary<span class="token punctuation">,</span>manager_id<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token string">'Tom'</span><span class="token punctuation">,</span><span class="token string">'tom@126.com'</span><span class="token punctuation">,</span>CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'AD_VP'</span><span class="token punctuation">,</span><span class="token number">8000</span><span class="token punctuation">,</span><span class="token number">103</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#添加失败</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> employees<span class="token punctuation">(</span>employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>email<span class="token punctuation">,</span>hire_date<span class="token punctuation">,</span>job_id<span class="token punctuation">,</span>salary<span class="token punctuation">,</span>manager_id<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">301</span><span class="token punctuation">,</span><span class="token string">'Tom1'</span><span class="token punctuation">,</span><span class="token string">'tom1@126.com'</span><span class="token punctuation">,</span>CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'AD_VP'</span><span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">,</span><span class="token number">103</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>


<span class="token comment">#2. 查看触发器</span>
<span class="token comment">#① 查看当前数据库的所有触发器的定义</span>
<span class="token keyword">SHOW</span> TRIGGERS<span class="token punctuation">;</span>

<span class="token comment">#② 方式2：查看当前数据库中某个触发器的定义</span>
<span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> salary_check_trigger<span class="token punctuation">;</span>

<span class="token comment">#③ 方式3：从系统库information_schema的TRIGGERS表中查询“salary_check_trigger”触发器的信息。</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span>TRIGGERS<span class="token punctuation">;</span>


<span class="token comment">#3. 删除触发器</span>
<span class="token keyword">DROP</span> <span class="token keyword">TRIGGER</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> after_insert_test_tri<span class="token punctuation">;</span>


<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="Mysql8新特性"><a href="#Mysql8新特性" class="headerlink" title="Mysql8新特性"></a>Mysql8新特性</h3><h4 id="新特性1：窗口函数"><a href="#新特性1：窗口函数" class="headerlink" title="新特性1：窗口函数"></a>新特性1：窗口函数</h4><p><img src="/2022/03/21/mysql/6.jpg" alt="6"></p>
<p>窗口函数的语法结构是：</p>
<pre class="line-numbers language-none"><code class="language-none">函数 OVER（[PARTITION BY 字段名 ORDER BY 字段名 ASC|DESC]）<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>或者是：</p>
<pre class="line-numbers language-none"><code class="language-none">函数 OVER 窗口名 … WINDOW 窗口名 AS （[PARTITION BY 字段名 ORDER BY 字段名 ASC|DESC]）<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>OVER 关键字指定函数窗口的范围。 </p>
<p>​        如果省略后面括号中的内容，则窗口会包含满足WHERE条件的所有记录，窗口函数会基于所 有满足WHERE条件的记录进行计算。 </p>
<p>​        如果OVER关键字后面的括号不为空，则可以使用如下语法设置窗口。 </p>
<p>窗口名：为窗口设置一个别名，用来标识窗口。 </p>
<p>PARTITION BY子句：指定窗口函数按照哪些字段进行分组。分组后，窗口函数可以在每个分组中分 别执行。 </p>
<p>ORDER BY子句：指定窗口函数按照哪些字段进行排序。执行排序操作使窗口函数按照排序后的数据 记录的顺序进行编号。 </p>
<p>FRAME子句：为分区中的某个子集定义规则，可以用来作为滑动窗口使用。</p>
<h4 id="序号函数"><a href="#序号函数" class="headerlink" title="序号函数"></a>序号函数</h4><h5 id="1．ROW-NUMBER-函数"><a href="#1．ROW-NUMBER-函数" class="headerlink" title="1．ROW_NUMBER()函数"></a>1．ROW_NUMBER()函数</h5><p>ROW_NUMBER()函数能够对数据中的序号进行顺序显示。 </p>
<p>举例：查询 goods 数据表中每个商品分类下价格降序排列的各个商品信息。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> category_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price <span class="token keyword">DESC</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> row_num<span class="token punctuation">,</span>id<span class="token punctuation">,</span> category_id<span class="token punctuation">,</span> category<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> price<span class="token punctuation">,</span> stockFROM goods<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>举例：查询 goods 数据表中每个商品分类下价格最高的3种商品信息。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> category_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price <span class="token keyword">DESC</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> row_num<span class="token punctuation">,</span>id<span class="token punctuation">,</span> category_id<span class="token punctuation">,</span> category<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> price<span class="token punctuation">,</span> stock <span class="token keyword">FROM</span> goods<span class="token punctuation">)</span> t <span class="token keyword">WHERE</span> row_num <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="2．RANK-函数"><a href="#2．RANK-函数" class="headerlink" title="2．RANK()函数"></a>2．RANK()函数</h5><p>使用RANK()函数能够对序号进行并列排序，并且会跳过重复的序号，比如序号为1、1、3。 </p>
<p>举例：使用RANK()函数获取 goods 数据表中各类别的价格从高到低排序的各商品信息。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> RANK<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> category_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price <span class="token keyword">DESC</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> row_num<span class="token punctuation">,</span>id<span class="token punctuation">,</span> category_id<span class="token punctuation">,</span> category<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> price<span class="token punctuation">,</span> stock <span class="token keyword">FROM</span> goods<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>举例：使用RANK()函数获取 goods 数据表中类别为“女装/女士精品”的价格最高的4款商品信息。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> RANK<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> category_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price <span class="token keyword">DESC</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> row_num<span class="token punctuation">,</span>id<span class="token punctuation">,</span> category_id<span class="token punctuation">,</span> category<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> price<span class="token punctuation">,</span> stock <span class="token keyword">FROM</span> goods<span class="token punctuation">)</span> t <span class="token keyword">WHERE</span> category_id <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">AND</span> row_num <span class="token operator">&lt;=</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="3．DENSE-RANK-函数"><a href="#3．DENSE-RANK-函数" class="headerlink" title="3．DENSE_RANK()函数"></a>3．DENSE_RANK()函数</h5><p>DENSE_RANK()函数对序号进行并列排序，并且不会跳过重复的序号，比如序号为1、1、2。 </p>
<p>举例：使用DENSE_RANK()函数获取 goods 数据表中各类别的价格从高到低排序的各商品信息。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> DENSE_RANK<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> category_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price <span class="token keyword">DESC</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> row_num<span class="token punctuation">,</span>id<span class="token punctuation">,</span> category_id<span class="token punctuation">,</span> category<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span>price<span class="token punctuation">,</span> stock <span class="token keyword">FROM</span> goods<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>举例：使用DENSE_RANK()函数获取 goods 数据表中类别为“女装/女士精品”的价格最高的4款商品信息。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span><span class="token punctuation">(</span> <span class="token keyword">SELECT</span> DENSE_RANK<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> category_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price <span class="token keyword">DESC</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> row_num<span class="token punctuation">,</span>id<span class="token punctuation">,</span> category_id<span class="token punctuation">,</span> category<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> price<span class="token punctuation">,</span> stock <span class="token keyword">FROM</span> goods<span class="token punctuation">)</span> t <span class="token keyword">WHERE</span> category_id <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">AND</span> row_num <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="2-分布函数"><a href="#2-分布函数" class="headerlink" title="2. 分布函数"></a>2. 分布函数</h4><h5 id="1．PERCENT-RANK-函数"><a href="#1．PERCENT-RANK-函数" class="headerlink" title="1．PERCENT_RANK()函数"></a>1．PERCENT_RANK()函数</h5><p>PERCENT_RANK()函数是等级值百分比函数。按照如下方式进行计算。</p>
<pre class="line-numbers language-none"><code class="language-none">(rank - 1) / (rows - 1)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>其中，rank的值为使用RANK()函数产生的序号，rows的值为当前窗口的总记录数。 </p>
<p>举例：计算 goods 数据表中名称为“女装/女士精品”的类别下的商品的PERCENT_RANK值。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">#写法一：</span>
<span class="token keyword">SELECT</span> RANK<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> category_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price <span class="token keyword">DESC</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> r<span class="token punctuation">,</span>PERCENT_RANK<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> category_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price <span class="token keyword">DESC</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> pr<span class="token punctuation">,</span>id<span class="token punctuation">,</span> category_id<span class="token punctuation">,</span> category<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> price<span class="token punctuation">,</span> stock <span class="token keyword">FROM</span> goods <span class="token keyword">WHERE</span> category_id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">#写法二：</span>
<span class="token keyword">SELECT</span> RANK<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> w <span class="token keyword">AS</span> r<span class="token punctuation">,</span> PERCENT_RANK<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> w <span class="token keyword">AS</span> pr<span class="token punctuation">,</span> id<span class="token punctuation">,</span> category_id<span class="token punctuation">,</span> category<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> price<span class="token punctuation">,</span> stock <span class="token keyword">FROM</span> goods  <span class="token keyword">WHERE</span> category_id <span class="token operator">=</span> <span class="token number">1</span> WINDOW w <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> category_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price <span class="token keyword">DESC</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="2．CUME-DIST-函数"><a href="#2．CUME-DIST-函数" class="headerlink" title="2．CUME_DIST()函数"></a>2．CUME_DIST()函数</h5><p>CUME_DIST()函数主要用于查询小于或等于某个值的比例。 </p>
<p>举例：查询goods数据表中小于或等于当前价格的比例。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> CUME_DIST<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> category_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price <span class="token keyword">ASC</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> cd<span class="token punctuation">,</span>id<span class="token punctuation">,</span> category<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> price <span class="token keyword">FROM</span> goods<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="3-前后函数"><a href="#3-前后函数" class="headerlink" title="3. 前后函数"></a>3. 前后函数</h4><h5 id="1．LAG-expr-n-函数"><a href="#1．LAG-expr-n-函数" class="headerlink" title="1．LAG(expr,n)函数"></a>1．LAG(expr,n)函数</h5><p>LAG(expr,n)函数返回当前行的前n行的expr的值。 </p>
<p>举例：查询goods数据表中前一个商品价格与当前商品价格的差值。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> category<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> price<span class="token punctuation">,</span> pre_price<span class="token punctuation">,</span> price <span class="token operator">-</span> re_price <span class="token keyword">AS</span> diff_price <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> category<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> price<span class="token punctuation">,</span>LAG<span class="token punctuation">(</span>price<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> w <span class="token keyword">AS</span> pre_price <span class="token keyword">FROM</span> goods WINDOW w <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> category_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price<span class="token punctuation">)</span><span class="token punctuation">)</span> t<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="2．LEAD-expr-n-函数"><a href="#2．LEAD-expr-n-函数" class="headerlink" title="2．LEAD(expr,n)函数"></a>2．LEAD(expr,n)函数</h5><p>LEAD(expr,n)函数返回当前行的后n行的expr的值。 </p>
<p>举例：查询goods数据表中后一个商品价格与当前商品价格的差值。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> category<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> behind_price<span class="token punctuation">,</span> price<span class="token punctuation">,</span>behind_price <span class="token operator">-</span> price <span class="token keyword">AS</span> diff_price  <span class="token keyword">FROM</span><span class="token punctuation">(</span> <span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> category<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> price<span class="token punctuation">,</span>LEAD<span class="token punctuation">(</span>price<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> w <span class="token keyword">AS</span> behind_price <span class="token keyword">FROM</span> goods WINDOW w <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> category_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price<span class="token punctuation">)</span><span class="token punctuation">)</span> t<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="4-首尾函数"><a href="#4-首尾函数" class="headerlink" title="4. 首尾函数"></a>4. 首尾函数</h4><h5 id="1．FIRST-VALUE-expr-函数"><a href="#1．FIRST-VALUE-expr-函数" class="headerlink" title="1．FIRST_VALUE(expr)函数"></a>1．FIRST_VALUE(expr)函数</h5><p>FIRST_VALUE(expr)函数返回第一个expr的值。 </p>
<p>举例：按照价格排序，查询第1个商品的价格信息。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> category<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> price<span class="token punctuation">,</span> stock<span class="token punctuation">,</span>FIRST_VALUE<span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">OVER</span> w <span class="token keyword">AS</span> first_price <span class="token keyword">FROM</span> goods WINDOW w <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> category_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="2．LAST-VALUE-expr-函数"><a href="#2．LAST-VALUE-expr-函数" class="headerlink" title="2．LAST_VALUE(expr)函数"></a>2．LAST_VALUE(expr)函数</h5><p>LAST_VALUE(expr)函数返回最后一个expr的值。 </p>
<p>举例：按照价格排序，查询最后一个商品的价格信息。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> category<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> price<span class="token punctuation">,</span> stock<span class="token punctuation">,</span>LAST_VALUE<span class="token punctuation">(</span>price<span class="token punctuation">)</span> <span class="token keyword">OVER</span> w <span class="token keyword">AS</span> last_price <span class="token keyword">FROM</span> goods WINDOW w <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> category_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="5-其他函数"><a href="#5-其他函数" class="headerlink" title="5. 其他函数"></a>5. 其他函数</h4><h5 id="1-NTH-VALUE-expr-n-函数"><a href="#1-NTH-VALUE-expr-n-函数" class="headerlink" title="1.  NTH_VALUE(expr,n)函数"></a>1.  NTH_VALUE(expr,n)函数</h5><p>NTH_VALUE(expr,n)函数返回第n个expr的值。 </p>
<p>举例：查询goods数据表中排名第2和第3的价格信息。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> category<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> price<span class="token punctuation">,</span>NTH_VALUE<span class="token punctuation">(</span>price<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> w <span class="token keyword">AS</span> second_price<span class="token punctuation">,</span> NTH_VALUE<span class="token punctuation">(</span>price<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> w <span class="token keyword">AS</span> third_price <span class="token keyword">FROM</span> goods WINDOW w <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> category_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h5 id="2．NTILE-n-函数"><a href="#2．NTILE-n-函数" class="headerlink" title="2．NTILE(n)函数"></a>2．NTILE(n)函数</h5><p>NTILE(n)函数将分区中的有序数据分为n个桶，记录桶编号。 </p>
<p>举例：将goods表中的商品按照价格分为3组。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> NTILE<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> w <span class="token keyword">AS</span> nt<span class="token punctuation">,</span>id<span class="token punctuation">,</span> category<span class="token punctuation">,</span> NAME<span class="token punctuation">,</span> price <span class="token keyword">FROM</span> goods WINDOW w <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> category_id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="新特性2：公用表表达式"><a href="#新特性2：公用表表达式" class="headerlink" title="新特性2：公用表表达式"></a>新特性2：公用表表达式</h4><h4 id="1-普通公用表表达式"><a href="#1-普通公用表表达式" class="headerlink" title="1 普通公用表表达式"></a>1 普通公用表表达式</h4><p>普通公用表表达式的语法结构是：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">WITH</span> CTE名称
<span class="token keyword">AS</span> （子查询）
<span class="token keyword">SELECT</span><span class="token operator">|</span><span class="token keyword">DELETE</span><span class="token operator">|</span><span class="token keyword">UPDATE</span> 语句<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>普通公用表表达式类似于子查询，不过，跟子查询不同的是，它可以被多次引用，而且可以被其他的普 通公用表表达式所引用。</p>
<p>举例：查询员工所在的部门的详细信息。</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> departments <span class="token keyword">WHERE</span> department_id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> department_id <span class="token keyword">FROM</span> employees <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">WITH</span> emp_dept_id <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> department_id <span class="token keyword">FROM</span> employees<span class="token punctuation">)</span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> departments d <span class="token keyword">JOIN</span> emp_dept_id e <span class="token keyword">ON</span> d<span class="token punctuation">.</span>department_id <span class="token operator">=</span> e<span class="token punctuation">.</span>department_id<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="2-递归公用表表达式"><a href="#2-递归公用表表达式" class="headerlink" title="2 递归公用表表达式"></a>2 递归公用表表达式</h4><p>递归公用表表达式也是一种公用表表达式，只不过，除了普通公用表表达式的特点以外，它还有自己的 特点，就是可以调用自己。它的语法结构是：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">WITH</span> RECURSIVE
CTE名称 <span class="token keyword">AS</span> （子查询）
<span class="token keyword">SELECT</span><span class="token operator">|</span><span class="token keyword">DELETE</span><span class="token operator">|</span><span class="token keyword">UPDATE</span> 语句<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>递归公用表表达式由 2 部分组成，分别是种子查询和递归查询，中间通过关键字 UNION [ALL]进行连接。 这里的种子查询，意思就是获得递归的初始值。这个查询只会运行一次，以创建初始数据集，之后递归 查询会一直执行，直到没有任何新的查询数据产生，递归返回。</p>
<p>案例：针对于我们常用的employees表，包含employee_id，last_name和manager_id三个字段。如果a是b 的管理者，那么，我们可以把b叫做a的下属，如果同时b又是c的管理者，那么c就是b的下属，是a的下下 属。</p>
<p>代码实现：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">WITH</span> RECURSIVE cte
<span class="token keyword">AS</span>
<span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name<span class="token punctuation">,</span>manager_id<span class="token punctuation">,</span><span class="token number">1</span> <span class="token keyword">AS</span> n <span class="token keyword">FROM</span> employees <span class="token keyword">WHERE</span> employee_id <span class="token operator">=</span> <span class="token number">100</span>
    <span class="token comment">-- 种子查询，找到第一代领导</span>
    <span class="token keyword">UNION</span> <span class="token keyword">ALL</span>
    <span class="token keyword">SELECT</span> a<span class="token punctuation">.</span>employee_id<span class="token punctuation">,</span>a<span class="token punctuation">.</span>last_name<span class="token punctuation">,</span>a<span class="token punctuation">.</span>manager_id<span class="token punctuation">,</span>n<span class="token operator">+</span><span class="token number">1</span> <span class="token keyword">FROM</span> employees <span class="token keyword">AS</span> a <span class="token keyword">JOIN</span> cte
    <span class="token keyword">ON</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>manager_id <span class="token operator">=</span> cte<span class="token punctuation">.</span>employee_id<span class="token punctuation">)</span> <span class="token comment">-- 递归查询，找出以递归公用表表达式的人为领导的人</span>
<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>last_name <span class="token keyword">FROM</span> cte <span class="token keyword">WHERE</span> n <span class="token operator">&gt;=</span> <span class="token number">3</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>




















































































































































































































































































































































































































































































































































































































































































































































































































































































































































                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">HuXiao</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://huxiaozz.github.io/2022/03/21/mysql/">https://huxiaozz.github.io/2022/03/21/mysql/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">HuXiao</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/MySQL/">
                                    <span class="chip bg-color">MySQL</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">客官看的高兴随缘打赏</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'iMvLV3Qw2jpPR6Y6Iw5BIKcx-gzGzoHsz',
        appKey: 'CwcP1VifF1dqIn0ggewqE8k7',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: 'just go go'
    });
</script>

<!--酷Q推送-->


    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2022/03/24/jdbc/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/11.jpg" class="responsive-img" alt="JDBC">
                        
                        <span class="card-title">JDBC</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2022-03-24
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            HuXiao
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/java/">
                        <span class="chip bg-color">java</span>
                    </a>
                    
                    <a href="/tags/jdbc/">
                        <span class="chip bg-color">jdbc</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/03/18/json-and-ajax/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/9.jpg" class="responsive-img" alt="json_and_ajax">
                        
                        <span class="card-title">json_and_ajax</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-03-18
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            HuXiao
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Java/">
                        <span class="chip bg-color">Java</span>
                    </a>
                    
                    <a href="/tags/Json/">
                        <span class="chip bg-color">Json</span>
                    </a>
                    
                    <a href="/tags/Ajax/">
                        <span class="chip bg-color">Ajax</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE' || selection.getRangeAt(0).commonAncestorContainer.nodeName === 'CODE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 晓晓屋<br />'
            + '文章作者: HuXiao<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        font-size: 15px;
        color: #42b983;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="tencent"
                   type="playlist"
                   id="8166411555"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.4'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Good&nbsp;&copy;
            
                <span id="year">2021-2022</span>
            
            
            <a href="/about" target="_blank">HuXiao</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/HuXiaozz" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:hujiming10086@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1851574845" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1851574845" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>






</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,255,0" opacity='0.2'
        zIndex="-1" count="99"
        src="/libs/background/canvas-nest.js"></script>
    

    
    
    <script type="text/javascript" size="90" alpha='0.2'
        zIndex="-1" src="/libs/background/ribbon.min.js" async="async"></script>
    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
